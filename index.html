<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Top Player">
<meta name="theme-color" content="#080810">
<meta name="mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23080810'/><text y='.9em' font-size='80' x='10'>ğŸ®</text></svg>">
<link rel="manifest" href="data:application/manifest+json,{
  %22name%22: %22Top Player Blueprint%22,
  %22short_name%22: %22Top Player%22,
  %22description%22: %2260-Day competitive gaming training system%22,
  %22start_url%22: %22.%22,
  %22display%22: %22standalone%22,
  %22background_color%22: %22%23080810%22,
  %22theme_color%22: %22%23080810%22,
  %22orientation%22: %22portrait%22,
  %22icons%22: [
    { %22src%22: %22data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='80' fill='%23080810'/%3E%3Ctext y='.85em' font-size='380' x='66'%3E%F0%9F%8E%AE%3C/text%3E%3C/svg%3E%22, %22sizes%22: %22512x512%22, %22type%22: %22image/svg+xml%22, %22purpose%22: %22any maskable%22 }
  ]
}">
<title>Top Player Blueprint â€” 60-Day Quest System</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500;600&family=Crimson+Pro:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">


<!-- Firebase SDK â€” loaded lazily when squad feature is activated -->
<script>
function loadFirebase(callback) {
  if (window.firebase) { if (callback) callback(); return; }
  var s1 = document.createElement('script');
  s1.src = 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js';
  s1.onload = function() {
    var s2 = document.createElement('script');
    s2.src = 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js';
    s2.onload = function() { if (callback) callback(); };
    s2.onerror = function() { console.warn('Firebase database SDK failed to load'); };
    document.head.appendChild(s2);
  };
  s1.onerror = function() { console.warn('Firebase app SDK failed to load'); };
  document.head.appendChild(s1);
}
</script>

<!-- Chart.js for VOD stats visualization -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

<style>
:root {
  --bg: #080810;
  --panel: #0e0e1a;
  --card: #111120;
  --card2: #14142a;
  --border: #1c1c30;
  --border2: #242438;
  --accent: #ff3c3c;
  --accent-dim: rgba(255,60,60,0.1);
  --gold: #f5c842;
  --gold-dim: rgba(245,200,66,0.1);
  --blue: #3c8dff;
  --blue-dim: rgba(60,141,255,0.1);
  --green: #2dcc70;
  --green-dim: rgba(45,204,112,0.1);
  --purple: #a855f7;
  --purple-dim: rgba(168,85,247,0.1);
  --text: #e8e8f0;
  --text2: #8888a8;
  --text3: #3a3a50;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Mono', monospace;
  min-height: 100vh;
  overflow-x: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ONBOARDING SCREENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#onboardScreen {
  position: fixed;
  inset: 0;
  z-index: 1000;
  background: radial-gradient(ellipse at 30% 20%, #1a0a1a 0%, var(--bg) 60%);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
  padding-top: calc(24px + env(safe-area-inset-top));
}
#onboardScreen.hidden { display: none; }

.ob-card {
  background: var(--panel);
  border: 1px solid var(--border2);
  border-radius: 12px;
  padding: 48px;
  max-width: 640px;
  width: 100%;
  box-shadow: 0 32px 80px rgba(0,0,0,0.6);
  animation: obIn 0.5s ease;
}
@keyframes obIn {
  from { opacity: 0; transform: translateY(40px); }
  to { opacity: 1; transform: translateY(0); }
}

.ob-logo {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2.6rem;
  letter-spacing: 0.12em;
  line-height: 1;
  margin-bottom: 8px;
}
.ob-logo span { color: var(--accent); }

.ob-subtitle {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--text2);
  font-size: 1rem;
  margin-bottom: 36px;
  line-height: 1.6;
}

.ob-step { display: none; }
.ob-step.active { display: block; animation: obIn 0.35s ease; }

.ob-q {
  font-size: 0.8rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--gold);
  margin-bottom: 16px;
}

.ob-options { display: grid; gap: 10px; }
.ob-options.cols2 { grid-template-columns: 1fr 1fr; }

.ob-opt {
  background: var(--card);
  border: 2px solid var(--border2);
  color: var(--text2);
  padding: 14px 18px;
  border-radius: 8px;
  cursor: pointer;
  font-family: 'DM Mono', monospace;
  font-size: 0.72rem;
  letter-spacing: 0.04em;
  text-align: left;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 10px;
}
.ob-opt:hover { border-color: var(--accent); background: var(--accent-dim); color: var(--text); }
.ob-opt.selected { border-color: var(--accent); background: var(--accent-dim); color: var(--accent); }
.ob-opt .em { font-size: 1.3rem; }

.ob-input {
  background: var(--card);
  border: 2px solid var(--border2);
  color: var(--text);
  padding: 14px 16px;
  border-radius: 8px;
  font-family: 'DM Mono', monospace;
  font-size: 0.75rem;
  width: 100%;
  outline: none;
  transition: border-color 0.2s;
}
.ob-input:focus { border-color: var(--accent); }
.ob-input::placeholder { color: var(--text3); }

.ob-btn {
  margin-top: 28px;
  background: var(--accent);
  border: none;
  color: #fff;
  padding: 16px 32px;
  border-radius: 8px;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
  letter-spacing: 0.15em;
  cursor: pointer;
  width: 100%;
  transition: all 0.2s;
}
.ob-btn:hover { background: #ff5555; transform: translateY(-1px); }

.ob-progress-dots {
  display: flex;
  gap: 8px;
  justify-content: center;
  margin-bottom: 32px;
}
.ob-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: var(--border2);
  transition: all 0.2s;
}
.ob-dot.active { background: var(--accent); transform: scale(1.25); }
.ob-dot.done { background: var(--green); }

.ob-back {
  background: none;
  border: none;
  color: var(--text2);
  cursor: pointer;
  font-family: 'DM Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 0.1em;
  margin-top: 14px;
  display: block;
  text-align: center;
  width: 100%;
  transition: color 0.2s;
}
.ob-back:hover { color: var(--text); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#appScreen { display: none; }
#appScreen.visible { display: block; }

.app-header {
  background: linear-gradient(135deg, #0a0a18 0%, #0f0f20 100%);
  border-bottom: 1px solid var(--border);
  padding: 16px 24px;
  padding-top: calc(16px + env(safe-area-inset-top));
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.hdr-brand {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-shrink: 0;
}
.hdr-logo {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.7rem;
  letter-spacing: 0.1em;
  line-height: 1;
  white-space: nowrap;
}
.hdr-logo span { color: var(--accent); }

.hdr-day-block {
  display: flex;
  align-items: center;
  gap: 6px;
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 8px 14px;
}
.hdr-day-num {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2.2rem;
  color: var(--gold);
  line-height: 1;
}
.hdr-day-info { line-height: 1.3; }
.hdr-day-label {
  font-size: 0.45rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--text2);
}
.hdr-day-date { font-size: 0.6rem; color: var(--blue); }

.hdr-streak {
  display: flex;
  align-items: center;
  gap: 6px;
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 8px 14px;
  font-size: 0.7rem;
}
.hdr-streak-num {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.6rem;
  color: var(--gold);
  line-height: 1;
}

.hdr-xp-block {
  flex: 1;
  min-width: 140px;
  max-width: 260px;
}
.hdr-xp-label {
  display: flex;
  justify-content: space-between;
  font-size: 0.5rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--text2);
  margin-bottom: 5px;
}
.hdr-xp-bar {
  height: 6px;
  background: var(--border);
  border-radius: 3px;
  overflow: hidden;
}
.hdr-xp-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--gold));
  border-radius: 3px;
  transition: width 0.5s ease;
}

.hdr-block-badge {
  font-size: 0.5rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  padding: 4px 10px;
  border-radius: 4px;
  border: 1px solid;
  white-space: nowrap;
}
.hdr-block-badge.b1 { background: rgba(255,60,60,0.1); color: var(--accent); border-color: rgba(255,60,60,0.3); }
.hdr-block-badge.b2 { background: rgba(60,141,255,0.1); color: var(--blue); border-color: rgba(60,141,255,0.3); }
.hdr-block-badge.b3 { background: rgba(245,200,66,0.1); color: var(--gold); border-color: rgba(245,200,66,0.3); }
.hdr-block-badge.b4 { background: rgba(45,204,112,0.1); color: var(--green); border-color: rgba(45,204,112,0.3); }

.app-layout {
  display: flex;
  min-height: calc(100vh - 62px);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR / NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar {
  width: 220px;
  min-width: 220px;
  background: var(--panel);
  border-right: 1px solid var(--border);
  position: sticky;
  top: 62px;
  height: calc(100vh - 62px);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}
.sidebar::-webkit-scrollbar { width: 4px; }
.sidebar::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

.nav-section-title {
  font-size: 0.45rem;
  letter-spacing: 0.28em;
  text-transform: uppercase;
  color: var(--text3);
  padding: 14px 16px 8px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 16px;
  cursor: pointer;
  transition: all 0.15s;
  border-left: 3px solid transparent;
  border-bottom: 1px solid #090914;
}
.nav-item:hover { background: var(--card); }
.nav-item.active { border-left-color: var(--accent); background: var(--card); }
.nav-item .nav-icon { font-size: 1rem; width: 22px; text-align: center; }
.nav-item .nav-info { flex: 1; min-width: 0; }
.nav-item .nav-name {
  font-size: 0.62rem;
  font-weight: 500;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.nav-item.active .nav-name { color: var(--accent); }
.nav-item .nav-pct {
  font-size: 0.48rem;
  color: var(--text2);
  margin-top: 1px;
}
.nav-mini-bar {
  width: 100%;
  height: 2px;
  background: var(--border);
  border-radius: 1px;
  margin-top: 3px;
  overflow: hidden;
}
.nav-mini-fill { height: 100%; background: var(--accent); border-radius: 1px; transition: width 0.3s; }

.nav-locked {
  opacity: 0.4;
  pointer-events: none;
}
.nav-lock-icon { font-size: 0.6rem; color: var(--text3); }

/* Today Dashboard special nav item */
.nav-item.today-nav { background: rgba(255,60,60,0.06); }
.nav-item.today-nav .nav-name { color: var(--accent); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main {
  flex: 1;
  padding: 28px 36px;
  overflow-y: auto;
  min-width: 0;
}

.section { display: none; }
.section.active { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TODAY DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.today-mission-brief {
  background: linear-gradient(135deg, #0f0f20, #14141e);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 24px 28px;
  margin-bottom: 24px;
  position: relative;
  overflow: hidden;
}
.today-mission-brief::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), var(--gold));
}

.tmb-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 20px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.tmb-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.8rem;
  letter-spacing: 0.1em;
  color: #fff;
  line-height: 1;
}
.tmb-block {
  font-size: 0.55rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--text2);
  margin-top: 4px;
}
.tmb-quote {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--text2);
  font-size: 0.9rem;
  max-width: 360px;
  text-align: right;
  line-height: 1.5;
}

.tmb-progress-row {
  display: flex;
  gap: 14px;
  align-items: center;
  flex-wrap: wrap;
}
.tmb-stat {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 16px;
  text-align: center;
  min-width: 80px;
}
.tmb-stat .ts-num {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.5rem;
  line-height: 1;
  color: var(--gold);
}
.tmb-stat .ts-label {
  font-size: 0.45rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--text2);
  margin-top: 2px;
}
.tmb-global-bar { flex: 1; min-width: 140px; }
.tmb-global-bar .gbarlabel {
  display: flex;
  justify-content: space-between;
  font-size: 0.5rem;
  color: var(--text2);
  letter-spacing: 0.12em;
  margin-bottom: 5px;
}
.tmb-global-bar .gbar {
  height: 8px;
  background: var(--border);
  border-radius: 4px;
  overflow: hidden;
}
.tmb-global-bar .gbar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--gold));
  border-radius: 4px;
  transition: width 0.5s;
}

.catchup-alert {
  background: rgba(245,200,66,0.06);
  border: 1px solid rgba(245,200,66,0.25);
  border-radius: 8px;
  padding: 14px 18px;
  margin-bottom: 20px;
  display: flex;
  align-items: flex-start;
  gap: 12px;
}
.catchup-alert .ca-icon { font-size: 1.2rem; flex-shrink: 0; }
.catchup-alert .ca-text { font-size: 0.65rem; line-height: 1.7; color: var(--gold); }
.catchup-alert .ca-title { font-weight: 600; margin-bottom: 2px; font-size: 0.7rem; }

/* QUEST CARDS */
.quest-section-title {
  font-size: 0.5rem;
  letter-spacing: 0.25em;
  text-transform: uppercase;
  color: var(--text2);
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.quest-section-title::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

.quest-list { display: flex; flex-direction: column; gap: 12px; margin-bottom: 28px; }

.quest-card {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 10px;
  overflow: hidden;
  transition: all 0.2s;
}
.quest-card:hover { border-color: var(--border2); transform: translateY(-1px); }
.quest-card.completed { opacity: 0.55; }

.qc-header {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 18px;
  cursor: pointer;
}
.qc-check {
  width: 22px; height: 22px;
  border: 2px solid var(--border2);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.7rem;
}
.qc-check:hover { border-color: var(--green); }
.qc-check.done { background: var(--green); border-color: var(--green); color: #fff; }

.qc-info { flex: 1; min-width: 0; }
.qc-title {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--text);
  margin-bottom: 4px;
}
.qc-title.done { text-decoration: line-through; color: var(--text2); }
.qc-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.qc-time { font-size: 0.55rem; color: var(--text2); }
.qc-xp {
  font-size: 0.5rem;
  letter-spacing: 0.1em;
  color: var(--gold);
  background: var(--gold-dim);
  border: 1px solid rgba(245,200,66,0.2);
  padding: 1px 7px;
  border-radius: 3px;
}
.qc-tag {
  font-size: 0.48rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  padding: 1px 7px;
  border-radius: 3px;
  border: 1px solid;
}
.qc-tag.core { background: rgba(255,60,60,0.1); color: var(--accent); border-color: rgba(255,60,60,0.3); }
.qc-tag.recommended { background: rgba(245,200,66,0.1); color: var(--gold); border-color: rgba(245,200,66,0.25); }
.qc-tag.bonus { background: rgba(45,204,112,0.1); color: var(--green); border-color: rgba(45,204,112,0.25); }

.qc-expand-btn {
  background: none;
  border: none;
  color: var(--text2);
  cursor: pointer;
  font-size: 0.7rem;
  padding: 4px;
  transition: color 0.15s;
  flex-shrink: 0;
}
.qc-expand-btn:hover { color: var(--text); }

.qc-body {
  display: none;
  padding: 0 18px 18px 54px;
  border-top: 1px solid var(--border);
  padding-top: 14px;
}
.qc-body.open { display: block; }
.qc-instructions {
  font-family: 'Crimson Pro', serif;
  font-size: 0.9rem;
  color: var(--text2);
  line-height: 1.7;
  margin-bottom: 10px;
}

/* COMPLETE SESSION BTN */
.complete-session-btn {
  width: 100%;
  padding: 18px;
  background: var(--accent);
  border: none;
  border-radius: 10px;
  color: #fff;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.3rem;
  letter-spacing: 0.15em;
  cursor: pointer;
  margin-top: 8px;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.complete-session-btn:hover { background: #ff5555; transform: translateY(-2px); box-shadow: 0 8px 24px rgba(255,60,60,0.3); }
.complete-session-btn:disabled { background: var(--green); cursor: default; }

/* ROADMAP MINI */
.roadmap-strip {
  display: flex;
  gap: 3px;
  flex-wrap: wrap;
  margin-top: 16px;
  padding: 14px 18px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
}
.roadmap-day-dot {
  width: 12px; height: 12px;
  border-radius: 2px;
  background: var(--border2);
  transition: all 0.2s;
  position: relative;
  cursor: default;
}
.roadmap-day-dot.completed { background: var(--green); }
.roadmap-day-dot.partial { background: var(--gold); }
.roadmap-day-dot.current {
  background: var(--accent);
  box-shadow: 0 0 8px rgba(255,60,60,0.5);
}
.roadmap-day-dot.locked { background: var(--text3); opacity: 0.3; }

/* WEEKLY BLOCKS LEGEND */
.roadmap-legend {
  display: flex;
  gap: 16px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
.roadmap-legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.5rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--text2);
}
.roadmap-legend-dot {
  width: 10px; height: 10px;
  border-radius: 2px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PILLAR SECTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pillar-header-row {
  display: flex;
  align-items: flex-start;
  gap: 18px;
  margin-bottom: 28px;
  padding-bottom: 22px;
  border-bottom: 1px solid var(--border);
  flex-wrap: wrap;
}
.pillar-icon { font-size: 2.5rem; line-height: 1; flex-shrink: 0; }
.pillar-title-block h2 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2rem;
  letter-spacing: 0.1em;
  color: #fff;
  line-height: 1;
}
.pillar-title-block p {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--text2);
  font-size: 0.9rem;
  margin-top: 4px;
  max-width: 580px;
}
.pillar-stats-row {
  margin-left: auto;
  display: flex;
  gap: 14px;
}
.pstat {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px 14px;
  text-align: center;
  min-width: 72px;
}
.pstat .ps-num {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.5rem;
  line-height: 1;
  color: var(--gold);
}
.pstat .ps-label {
  font-size: 0.45rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--text2);
}

.unlock-overlay {
  background: rgba(8,8,16,0.85);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 40px;
  text-align: center;
  margin-bottom: 24px;
  backdrop-filter: blur(4px);
}
.unlock-overlay .uo-icon { font-size: 3rem; margin-bottom: 12px; }
.unlock-overlay h3 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.6rem;
  letter-spacing: 0.12em;
  color: var(--text2);
  margin-bottom: 8px;
}
.unlock-overlay p {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--text3);
  font-size: 0.85rem;
}
.unlock-overlay .uo-progress {
  margin-top: 14px;
  font-size: 0.6rem;
  color: var(--gold);
  letter-spacing: 0.12em;
}

/* BLOCK FOCUS PANEL */
.block-focus {
  background: #0f0f1e;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px 20px;
  margin-bottom: 24px;
  display: flex;
  gap: 20px;
  align-items: flex-start;
  flex-wrap: wrap;
}
.block-focus h4 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 0.9rem;
  letter-spacing: 0.12em;
  color: var(--gold);
  margin-bottom: 4px;
}
.block-focus p {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--text2);
  font-size: 0.82rem;
  margin-bottom: 8px;
}
.bf-ratios { display: flex; gap: 14px; flex-wrap: wrap; }
.bf-ratio {
  display: flex; align-items: center; gap: 5px;
  font-size: 0.52rem; color: var(--text2);
}
.bf-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }

/* SUBSECTIONS */
.subsection {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 16px;
}
.sub-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 13px 16px;
  cursor: pointer;
  background: #12121f;
  border-bottom: 1px solid var(--border);
  transition: background 0.15s;
}
.sub-header:hover { background: #1a1a2a; }
.sub-toggle { color: var(--text2); font-size: 0.65rem; transition: transform 0.2s; width: 12px; }
.subsection.open .sub-toggle { transform: rotate(90deg); }
.sub-name { font-size: 0.75rem; font-weight: 500; color: var(--text); flex: 1; letter-spacing: 0.04em; }
.sub-prog-label { font-size: 0.52rem; color: var(--text2); }
.sub-bar-wrap { width: 90px; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
.sub-bar-fill { height: 100%; border-radius: 2px; transition: width 0.4s; }
.sub-bar-fill.c1 { background: var(--accent); }
.sub-bar-fill.c2 { background: var(--blue); }
.sub-bar-fill.c3 { background: var(--green); }
.sub-bar-fill.c4 { background: var(--gold); }
.sub-tag { font-size: 0.45rem; letter-spacing: 0.18em; text-transform: uppercase; padding: 2px 7px; border-radius: 2px; }
.sub-tag.correction { background: rgba(255,60,60,0.1); color: var(--accent); }
.sub-tag.drilling { background: rgba(60,141,255,0.1); color: var(--blue); }
.sub-tag.matchplay { background: rgba(45,204,112,0.1); color: var(--green); }

.sub-body { display: none; }
.subsection.open .sub-body { display: block; }

.task-cat { border-bottom: 1px solid #090914; padding: 11px 16px 11px 26px; }
.task-cat:last-child { border-bottom: none; }
.task-cat-label {
  font-size: 0.52rem; letter-spacing: 0.18em; text-transform: uppercase;
  color: var(--text2); margin-bottom: 8px;
}
.atom-task {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 8px 0;
  border-bottom: 1px solid #0c0c18;
}
.atom-task:last-child { border-bottom: none; }

.atom-check {
  width: 17px; height: 17px;
  border: 1px solid var(--border2);
  border-radius: 3px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
  flex-shrink: 0;
  margin-top: 1px;
  font-size: 0.6rem;
}
.atom-check:hover { border-color: var(--green); }
.atom-check.done { background: var(--green); border-color: var(--green); color: #fff; }

.atom-info { flex: 1; min-width: 0; }
.atom-name { font-size: 0.65rem; color: var(--text); line-height: 1.5; }
.atom-name.done { text-decoration: line-through; color: var(--text2); }
.atom-meta { display: flex; gap: 7px; align-items: center; flex-wrap: wrap; margin-top: 3px; }
.atom-count { font-size: 0.52rem; color: var(--text2); }
.atom-once-tag {
  font-size: 0.45rem; letter-spacing: 0.12em; text-transform: uppercase;
  background: var(--purple-dim); color: var(--purple);
  border: 1px solid rgba(168,85,247,0.3); padding: 1px 6px; border-radius: 2px;
}
.atom-daily-tag {
  font-size: 0.45rem; letter-spacing: 0.12em; text-transform: uppercase;
  background: var(--blue-dim); color: var(--blue);
  border: 1px solid rgba(60,141,255,0.3); padding: 1px 6px; border-radius: 2px;
}
.atom-count-controls {
  display: flex; align-items: center; gap: 6px; margin-top: 5px;
}
.count-btn {
  background: var(--card2); border: 1px solid var(--border2); color: var(--text);
  width: 22px; height: 22px; border-radius: 3px; cursor: pointer;
  font-size: 0.75rem; display: flex; align-items: center; justify-content: center;
  transition: all 0.15s;
}
.count-btn:hover { background: var(--accent); border-color: var(--accent); }
.count-display { font-size: 0.6rem; color: var(--gold); min-width: 52px; text-align: center; }
.atom-mini-bar { width: 100%; height: 2px; background: var(--border); border-radius: 1px; overflow: hidden; margin-top: 4px; }
.atom-mini-fill { height: 100%; background: var(--blue); border-radius: 1px; transition: width 0.3s; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JOURNAL SECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.journal-section {
  background: #0f0f1e;
  border: 1px solid rgba(168,85,247,0.2);
  border-radius: 8px;
  padding: 18px 22px;
  margin-bottom: 24px;
}
.journal-section h3 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.1rem;
  letter-spacing: 0.12em;
  color: var(--purple);
  margin-bottom: 4px;
}
.journal-section > p {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--text2);
  font-size: 0.82rem;
  margin-bottom: 16px;
}
.journal-prompts { list-style: none; }
.jp-item {
  border-bottom: 1px solid var(--border);
  padding: 12px 0;
}
.jp-item:last-child { border-bottom: none; }
.jp-question-row {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  margin-bottom: 8px;
}
.jp-num { font-size: 0.55rem; color: var(--text2); min-width: 16px; margin-top: 1px; }
.jp-text { font-size: 0.65rem; color: var(--text); flex: 1; line-height: 1.6; }
.jp-check {
  width: 17px; height: 17px;
  border: 1px solid rgba(168,85,247,0.4);
  border-radius: 3px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.6rem;
  flex-shrink: 0;
  transition: all 0.15s;
}
.jp-check:hover { border-color: var(--purple); }
.jp-check.done { background: var(--purple); border-color: var(--purple); color: #fff; }
.jp-answer {
  width: 100%;
  background: #090910;
  border: 1px solid var(--border2);
  border-radius: 4px;
  color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 0.62rem;
  padding: 8px 12px;
  resize: vertical;
  min-height: 38px;
  outline: none;
  line-height: 1.6;
  transition: border-color 0.15s;
}
.jp-answer:focus { border-color: rgba(168,85,247,0.4); }
.jp-answer::placeholder { color: var(--text3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOLS: MATCHUPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tool-header {
  display: flex;
  align-items: flex-start;
  gap: 18px;
  margin-bottom: 28px;
  padding-bottom: 22px;
  border-bottom: 1px solid var(--border);
}
.tool-icon-big { font-size: 2.5rem; line-height: 1; }
.tool-title-block h2 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2rem;
  letter-spacing: 0.1em;
  color: #fff;
}
.tool-title-block p {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--text2);
  font-size: 0.9rem;
  margin-top: 4px;
  max-width: 560px;
}

.matchup-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 14px;
  margin-bottom: 20px;
}
.matchup-card {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  overflow: hidden;
  transition: border-color 0.15s;
}
.matchup-card:hover { border-color: var(--text3); }
.matchup-card-hdr {
  background: #12121f;
  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
}
.matchup-char-name {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.1rem;
  letter-spacing: 0.08em;
  flex: 1;
}
.matchup-del {
  background: none; border: none; color: var(--text2); cursor: pointer;
  font-size: 0.65rem; transition: color 0.15s;
}
.matchup-del:hover { color: var(--accent); }
.matchup-card-body { padding: 12px 14px; }
.matchup-field { margin-bottom: 9px; }
.matchup-field-label {
  font-size: 0.45rem; letter-spacing: 0.18em; text-transform: uppercase;
  color: var(--text2); margin-bottom: 3px;
}
.matchup-textarea {
  width: 100%; background: #090910; border: 1px solid var(--border2);
  border-radius: 3px; color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.6rem; padding: 6px 9px; resize: vertical; min-height: 36px;
  outline: none; line-height: 1.5; transition: border-color 0.15s;
}
.matchup-textarea:focus { border-color: rgba(245,200,66,0.35); }
.matchup-textarea::placeholder { color: var(--text3); }

.add-form {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 16px 18px;
  margin-bottom: 18px;
}
.add-form h4 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 0.9rem;
  letter-spacing: 0.12em;
  color: var(--gold);
  margin-bottom: 12px;
}
.add-form-row { display: flex; gap: 8px; flex-wrap: wrap; }
.add-form-input {
  flex: 1; min-width: 160px;
  background: #090910; border: 1px solid var(--border2);
  border-radius: 4px; color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.65rem; padding: 7px 12px; outline: none; transition: border-color 0.15s;
}
.add-form-input:focus { border-color: rgba(245,200,66,0.35); }
.add-form-input::placeholder { color: var(--text3); }
.add-form-btn {
  background: var(--gold-dim); border: 1px solid rgba(245,200,66,0.35);
  color: var(--gold); padding: 7px 16px; cursor: pointer;
  font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 0.1em;
  border-radius: 4px; transition: all 0.15s; white-space: nowrap;
}
.add-form-btn:hover { background: rgba(245,200,66,0.2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOLS: VOD REVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.vod-review-list { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
.vod-entry {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  overflow: hidden;
}
.vod-entry-hdr {
  background: #12121f;
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}
.vod-day-tag {
  font-size: 0.5rem; letter-spacing: 0.15em; text-transform: uppercase;
  background: var(--blue-dim); color: var(--blue); border: 1px solid rgba(60,141,255,0.3);
  padding: 2px 8px; border-radius: 3px;
}
.vod-label { font-size: 0.7rem; font-weight: 500; color: var(--text); flex: 1; }
.vod-del { background: none; border: none; color: var(--text2); cursor: pointer; font-size: 0.65rem; transition: color 0.15s; }
.vod-del:hover { color: var(--accent); }
.vod-entry-body { padding: 14px 16px; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
.vod-field label {
  display: block; font-size: 0.45rem; letter-spacing: 0.18em; text-transform: uppercase;
  color: var(--text2); margin-bottom: 3px;
}
.vod-textarea {
  width: 100%; background: #090910; border: 1px solid var(--border2);
  border-radius: 3px; color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.6rem; padding: 6px 9px; resize: vertical; min-height: 60px;
  outline: none; line-height: 1.5; transition: border-color 0.15s;
}
.vod-textarea:focus { border-color: rgba(60,141,255,0.35); }
.vod-textarea::placeholder { color: var(--text3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOLS: STAT TRACKER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stat-tracker-panel {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}
.stat-tracker-panel h3 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
  letter-spacing: 0.1em;
  color: var(--purple);
  margin-bottom: 4px;
}
.stat-tracker-panel > p { font-family: 'Crimson Pro', serif; font-style: italic; color: var(--text2); font-size: 0.82rem; margin-bottom: 16px; }

.stat-entry-form {
  display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end; margin-bottom: 18px;
}
.stat-field { display: flex; flex-direction: column; gap: 4px; }
.stat-field label { font-size: 0.5rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text2); }
.stat-input {
  background: #090910; border: 1px solid var(--border2); border-radius: 4px;
  color: var(--text); font-family: 'DM Mono', monospace; font-size: 0.65rem;
  padding: 7px 10px; outline: none; width: 120px; transition: border-color 0.15s;
}
.stat-input:focus { border-color: rgba(168,85,247,0.4); }
.stat-input::placeholder { color: var(--text3); }
.stat-submit-btn {
  background: var(--purple-dim); border: 1px solid rgba(168,85,247,0.4);
  color: var(--purple); padding: 8px 16px; cursor: pointer;
  font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 0.1em;
  border-radius: 4px; transition: all 0.15s; align-self: flex-end;
}
.stat-submit-btn:hover { background: rgba(168,85,247,0.2); }

.stat-chart-selector { display: flex; gap: 6px; margin-bottom: 10px; flex-wrap: wrap; }
.chart-metric-btn {
  background: none; border: 1px solid var(--border2); color: var(--text2);
  padding: 5px 12px; cursor: pointer; font-family: 'DM Mono', monospace;
  font-size: 0.55rem; letter-spacing: 0.08em; border-radius: 4px; transition: all 0.15s;
}
.chart-metric-btn:hover { border-color: var(--purple); color: var(--purple); }
.chart-metric-btn.active { background: var(--purple-dim); border-color: var(--purple); color: var(--purple); }

.stat-canvas-wrap { width: 100%; margin-bottom: 12px; }
#statChart { max-width: 100%; }

.stat-log-table { width: 100%; border-collapse: collapse; }
.stat-log-table th, .stat-log-table td {
  padding: 6px 10px;
  font-size: 0.58rem;
  text-align: left;
  border-bottom: 1px solid var(--border);
  color: var(--text2);
  font-family: 'DM Mono', monospace;
}
.stat-log-table th { color: var(--text3); letter-spacing: 0.12em; text-transform: uppercase; font-size: 0.48rem; }
.stat-log-table td:first-child { color: var(--text); }
.stat-trend-up { color: var(--green) !important; }
.stat-trend-down { color: var(--accent) !important; }
.stat-del-row { background: none; border: none; color: var(--text3); cursor: pointer; font-size: 0.65rem; transition: color 0.15s; }
.stat-del-row:hover { color: var(--accent); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOLS: MILESTONES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.milestone-timeline { position: relative; padding-left: 28px; }
.milestone-timeline::before {
  content: ''; position: absolute; left: 10px; top: 0; bottom: 0;
  width: 1px; background: var(--border2);
}
.milestone-entry {
  position: relative; margin-bottom: 16px;
  background: var(--card); border: 1px solid var(--border2);
  border-radius: 6px; padding: 14px 16px;
  transition: border-color 0.15s;
}
.milestone-entry:hover { border-color: rgba(245,200,66,0.3); }
.milestone-dot {
  position: absolute; left: -22px; top: 18px;
  width: 14px; height: 14px; border-radius: 50%;
  background: var(--card); border: 2px solid var(--gold);
  display: flex; align-items: center; justify-content: center;
}
.milestone-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap; }
.milestone-day-tag {
  font-size: 0.48rem; letter-spacing: 0.15em; text-transform: uppercase;
  background: var(--gold-dim); color: var(--gold); border: 1px solid rgba(245,200,66,0.25);
  padding: 2px 7px; border-radius: 3px;
}
.milestone-cat-tag {
  font-size: 0.48rem; letter-spacing: 0.15em; text-transform: uppercase;
  color: var(--text2); background: var(--card2); border: 1px solid var(--border2);
  padding: 2px 7px; border-radius: 3px;
}
.milestone-del { background: none; border: none; color: var(--text3); cursor: pointer; font-size: 0.65rem; transition: color 0.15s; margin-left: auto; }
.milestone-del:hover { color: var(--accent); }
.milestone-text { font-size: 0.65rem; color: var(--text); line-height: 1.6; }

.add-milestone-form {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 16px 18px;
  margin-bottom: 20px;
}
.add-milestone-form h4 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 0.9rem;
  letter-spacing: 0.12em;
  color: var(--gold);
  margin-bottom: 12px;
}
.milestone-form-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 8px; }
.milestone-form-input, .milestone-form-select, .milestone-form-textarea {
  flex: 1; min-width: 120px;
  background: #090910; border: 1px solid var(--border2);
  border-radius: 4px; color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.65rem; padding: 7px 10px; outline: none; transition: border-color 0.15s;
}
.milestone-form-input:focus, .milestone-form-select:focus, .milestone-form-textarea:focus { border-color: rgba(245,200,66,0.35); }
.milestone-form-input::placeholder, .milestone-form-textarea::placeholder { color: var(--text3); }
.milestone-form-select { appearance: none; cursor: pointer; }
.milestone-form-textarea { min-height: 60px; resize: vertical; width: 100%; }
.add-milestone-btn {
  background: var(--gold-dim); border: 1px solid rgba(245,200,66,0.35);
  color: var(--gold); padding: 8px 16px; cursor: pointer;
  font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 0.1em;
  border-radius: 4px; transition: all 0.15s;
}
.add-milestone-btn:hover { background: rgba(245,200,66,0.2); }
.milestones-empty { text-align: center; padding: 40px 20px; color: var(--text3); }
.milestones-empty .me-icon { font-size: 2.5rem; margin-bottom: 10px; opacity: 0.4; }
.milestones-empty p { font-family: 'Crimson Pro', serif; font-style: italic; font-size: 0.85rem; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOURNAMENT PLAYERS (LOCAL SCENE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.local-player-grid {
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin-bottom: 20px;
}
.local-player-card {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 12px;
  overflow: hidden;
  transition: border-color 0.15s;
}
.local-player-card:hover { border-color: var(--text3); }
.lp-card-hdr {
  background: linear-gradient(135deg, #12121f, #16162a);
  padding: 14px 18px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  user-select: none;
}
.lp-hdr-left { flex: 1; min-width: 0; }
.lp-name {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.4rem;
  letter-spacing: 0.08em;
  line-height: 1;
  margin-bottom: 3px;
}
.lp-char-tag {
  font-size: 0.5rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--blue);
  background: var(--blue-dim);
  border: 1px solid rgba(60,141,255,0.2);
  padding: 2px 8px;
  border-radius: 3px;
  display: inline-block;
}
.lp-hdr-right { display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
.lp-record-block { text-align: center; }
.lp-record-label { font-size: 0.4rem; letter-spacing: 0.18em; text-transform: uppercase; color: var(--text2); margin-bottom: 3px; }
.lp-record-nums { display: flex; gap: 6px; align-items: center; }
.lp-record-w { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; color: var(--green); line-height: 1; }
.lp-record-l { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; color: var(--accent); line-height: 1; }
.lp-record-sep { font-size: 0.6rem; color: var(--text3); }
.lp-completion-ring {
  width: 42px; height: 42px;
  border-radius: 50%;
  background: conic-gradient(var(--accent) 0%, var(--border) 0%);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  position: relative;
}
.lp-completion-ring::before {
  content: '';
  position: absolute;
  inset: 5px;
  border-radius: 50%;
  background: #12121f;
}
.lp-completion-pct {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 0.65rem;
  color: var(--text);
  position: relative;
  z-index: 1;
}
.lp-expand-arrow { font-size: 0.7rem; color: var(--text2); transition: transform 0.2s; }
.lp-expand-arrow.open { transform: rotate(180deg); }
.lp-del { background: none; border: none; color: var(--text3); cursor: pointer; font-size: 0.65rem; transition: color 0.15s; padding: 4px; }
.lp-del:hover { color: var(--accent); }

/* Scouting body */
.lp-scout-body { display: none; }
.lp-scout-body.open { display: block; }

.lp-section {
  border-top: 1px solid var(--border);
}
.lp-section-hdr {
  padding: 12px 18px 10px;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  user-select: none;
  transition: background 0.15s;
}
.lp-section-hdr:hover { background: rgba(255,255,255,0.02); }
.lp-section-icon { font-size: 1rem; flex-shrink: 0; }
.lp-section-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 0.85rem;
  letter-spacing: 0.12em;
  color: var(--text);
  flex: 1;
}
.lp-section-filled {
  font-size: 0.48rem;
  letter-spacing: 0.1em;
  color: var(--text2);
}
.lp-section-filled.complete { color: var(--green); }
.lp-section-chevron { font-size: 0.6rem; color: var(--text3); transition: transform 0.2s; }
.lp-section-chevron.open { transform: rotate(180deg); }

.lp-questions { display: none; padding: 0 18px 16px; }
.lp-questions.open { display: block; }

.lp-q {
  margin-bottom: 12px;
}
.lp-q-label {
  font-size: 0.55rem;
  letter-spacing: 0.05em;
  color: var(--text2);
  margin-bottom: 5px;
  line-height: 1.5;
  display: flex;
  align-items: flex-start;
  gap: 6px;
}
.lp-q-label .lq-num {
  font-size: 0.42rem;
  background: var(--border2);
  color: var(--text3);
  border-radius: 3px;
  padding: 1px 5px;
  flex-shrink: 0;
  margin-top: 1px;
  font-family: 'DM Mono', monospace;
  letter-spacing: 0.05em;
}
.lp-q-label .lq-num.answered { background: rgba(45,204,112,0.15); color: var(--green); }
.lp-q textarea, .lp-q input[type=text] {
  width: 100%; background: #090910; border: 1px solid var(--border2);
  border-radius: 4px; color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.6rem; padding: 7px 10px; resize: vertical; min-height: 32px;
  outline: none; line-height: 1.5; transition: border-color 0.15s;
}
.lp-q textarea:focus, .lp-q input[type=text]:focus { border-color: rgba(60,141,255,0.4); }
.lp-q textarea::placeholder, .lp-q input[type=text]::placeholder { color: var(--text3); }
.lp-q textarea.answered { border-color: rgba(45,204,112,0.25); }

.lp-record-input {
  background: #090910; border: 1px solid var(--border2);
  border-radius: 3px; color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.65rem; padding: 4px 8px; outline: none;
  width: 44px; text-align: center; transition: border-color 0.15s;
}
.lp-record-input:focus { border-color: rgba(60,141,255,0.35); }

/* Danger level badge */
.lp-danger {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 18px;
  border-top: 1px solid var(--border);
  background: rgba(255,60,60,0.03);
}
.lp-danger-label { font-size: 0.48rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text2); }
.lp-danger-stars { display: flex; gap: 4px; }
.lp-danger-star {
  width: 22px; height: 22px;
  border: 1px solid var(--border2);
  border-radius: 4px;
  background: none;
  font-size: 0.7rem;
  display: flex; align-items: center; justify-content: center;
  color: var(--text3);
  pointer-events: none;
  user-select: none;
}
.lp-danger-star.lit { background: rgba(255,60,60,0.15); border-color: rgba(255,60,60,0.4); color: var(--accent); }
.lp-priority-note { font-family: 'Crimson Pro', serif; font-style: italic; font-size: 0.65rem; color: var(--text2); flex: 1; text-align: right; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCENARIO TRAINING LOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scenario-panel {
  background: #0d0d1e;
  border: 1px solid rgba(60,141,255,0.2);
  border-radius: 8px;
  padding: 18px 20px;
  margin-bottom: 24px;
}
.scenario-panel h3 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.1rem;
  letter-spacing: 0.12em;
  color: var(--blue);
  margin-bottom: 4px;
}
.scenario-panel .sp-desc { font-family: 'Crimson Pro', serif; font-style: italic; color: var(--text2); font-size: 0.82rem; margin-bottom: 14px; }
.scenario-add { display: flex; gap: 8px; margin-bottom: 12px; }
.scenario-input {
  flex: 1; background: #090910; border: 1px solid var(--border2);
  border-radius: 4px; color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.65rem; padding: 8px 12px; outline: none; transition: border-color 0.15s;
}
.scenario-input:focus { border-color: rgba(60,141,255,0.4); }
.scenario-input::placeholder { color: var(--text3); }
.scenario-btn {
  background: var(--blue-dim); border: 1px solid rgba(60,141,255,0.35);
  color: var(--blue); padding: 8px 14px; cursor: pointer;
  font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 0.1em;
  border-radius: 4px; transition: all 0.15s;
}
.scenario-btn:hover { background: rgba(60,141,255,0.2); }
.scenario-list { list-style: none; }
.scenario-item {
  display: flex; align-items: flex-start; gap: 10px;
  padding: 8px 0; border-bottom: 1px solid var(--border);
}
.scenario-item:last-child { border-bottom: none; }
.scenario-check {
  width: 17px; height: 17px;
  border: 1px solid rgba(60,141,255,0.4); border-radius: 3px;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  font-size: 0.6rem; flex-shrink: 0; margin-top: 1px; transition: all 0.15s;
}
.scenario-check:hover { border-color: var(--blue); }
.scenario-check.done { background: var(--blue); border-color: var(--blue); color: #fff; }
.scenario-text { flex: 1; font-size: 0.62rem; color: var(--text); line-height: 1.5; }
.scenario-text.done-text { text-decoration: line-through; color: var(--text2); }
.scenario-del { background: none; border: none; color: var(--text3); cursor: pointer; font-size: 0.65rem; transition: color 0.15s; flex-shrink: 0; }
.scenario-del:hover { color: var(--accent); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEEKLY CHECK-IN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.weekly-checkin {
  background: rgba(245,200,66,0.05);
  border: 1px solid rgba(245,200,66,0.2);
  border-radius: 10px;
  padding: 20px 24px;
  margin-bottom: 24px;
}
.weekly-checkin h3 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
  letter-spacing: 0.12em;
  color: var(--gold);
  margin-bottom: 4px;
}
.weekly-checkin p { font-family: 'Crimson Pro', serif; font-style: italic; color: var(--text2); font-size: 0.82rem; margin-bottom: 16px; }
.weekly-q { margin-bottom: 14px; }
.weekly-q label { display: block; font-size: 0.62rem; color: var(--text); margin-bottom: 5px; line-height: 1.5; }
.weekly-textarea {
  width: 100%; background: #090910; border: 1px solid rgba(245,200,66,0.2);
  border-radius: 4px; color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.62rem; padding: 9px 12px; resize: vertical; min-height: 54px;
  outline: none; line-height: 1.6; transition: border-color 0.15s;
}
.weekly-textarea:focus { border-color: rgba(245,200,66,0.4); }
.weekly-textarea::placeholder { color: var(--text3); }
.weekly-save-btn {
  background: var(--gold-dim); border: 1px solid rgba(245,200,66,0.35);
  color: var(--gold); padding: 9px 20px; cursor: pointer;
  font-family: 'Bebas Neue', sans-serif; font-size: 0.9rem; letter-spacing: 0.12em;
  border-radius: 6px; transition: all 0.15s;
}
.weekly-save-btn:hover { background: rgba(245,200,66,0.2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SQUAD PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.squad-panel { background: var(--card); border: 1px solid var(--border2); border-radius: 8px; padding: 18px 20px; margin-bottom: 20px; }
.squad-panel h3 { font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 0.1em; color: var(--green); margin-bottom: 4px; }
.squad-panel p { font-family: 'Crimson Pro', serif; font-style: italic; color: var(--text2); font-size: 0.82rem; margin-bottom: 16px; }
.squad-code-row { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
.squad-code { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 0.2em; color: var(--green); background: var(--card2); border: 1px solid rgba(45,204,112,0.2); padding: 6px 16px; border-radius: 6px; }
.squad-code-label { font-size: 0.5rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text2); }
.squad-members { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; }
.squad-member-card { background: var(--card2); border: 1px solid var(--border2); border-radius: 6px; padding: 12px 14px; }
.sm-name { font-size: 0.75rem; font-weight: 500; color: var(--text); margin-bottom: 4px; }
.sm-status { display: flex; align-items: center; gap: 6px; font-size: 0.55rem; color: var(--text2); margin-bottom: 6px; }
.sm-online-dot { width: 6px; height: 6px; border-radius: 50%; }
.sm-online-dot.online { background: var(--green); box-shadow: 0 0 6px rgba(45,204,112,0.5); }
.sm-online-dot.offline { background: var(--text3); }
.sm-prog-bar { height: 3px; background: var(--border); border-radius: 1px; overflow: hidden; }
.sm-prog-fill { height: 100%; background: var(--green); border-radius: 1px; transition: width 0.4s; }
.sm-day { font-size: 0.5rem; color: var(--text3); margin-top: 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATIONS / TOASTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast {
  position: fixed;
  bottom: 28px;
  right: 28px;
  background: var(--card2);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 14px 20px;
  font-size: 0.7rem;
  color: var(--text);
  z-index: 9999;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s;
  max-width: 300px;
  pointer-events: none;
}
.toast.show { opacity: 1; transform: translateY(0); }
.toast.success { border-color: rgba(45,204,112,0.4); }
.toast.gold { border-color: rgba(245,200,66,0.4); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CELEBRATION OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#celebrationOverlay {
  position: fixed; inset: 0; z-index: 9000;
  background: rgba(0,0,0,0.85);
  display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none; transition: opacity 0.3s;
}
#celebrationOverlay.show { opacity: 1; pointer-events: all; }
.celebration-card {
  background: var(--panel); border: 1px solid rgba(245,200,66,0.4);
  border-radius: 16px; padding: 48px; text-align: center; max-width: 480px;
  animation: celebIn 0.4s ease;
}
@keyframes celebIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
.celebration-card .cel-icon { font-size: 4rem; margin-bottom: 14px; }
.celebration-card h2 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2.5rem; letter-spacing: 0.12em; color: var(--gold); margin-bottom: 8px;
}
.celebration-card p { font-family: 'Crimson Pro', serif; font-style: italic; color: var(--text2); font-size: 1rem; margin-bottom: 20px; }
.celebration-card .xp-gained {
  font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem;
  color: var(--green); margin-bottom: 20px; letter-spacing: 0.1em;
}
.celebration-close {
  background: var(--accent); border: none; color: #fff;
  padding: 14px 32px; border-radius: 8px; cursor: pointer;
  font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 0.12em;
  transition: all 0.2s;
}
.celebration-close:hover { background: #ff5555; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAMING ENHANCEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Scanlines overlay for game feel */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.03) 2px,
    rgba(0,0,0,0.03) 4px
  );
  pointer-events: none;
  z-index: 9998;
}

/* Particle canvas */
#particleCanvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9997;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RANK BADGE SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hdr-rank-block {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 6px 12px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}
.hdr-rank-block:hover { border-color: var(--gold); background: var(--gold-dim); }
.hdr-rank-icon { font-size: 1.3rem; line-height: 1; }
.hdr-rank-info { line-height: 1.3; }
.hdr-rank-name {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 0.9rem;
  letter-spacing: 0.12em;
  color: var(--gold);
  line-height: 1;
}
.hdr-rank-xp { font-size: 0.48rem; letter-spacing: 0.1em; color: var(--text2); }

/* Rank progression modal */
#rankModal {
  position: fixed; inset: 0; z-index: 8500;
  background: rgba(0,0,0,0.92);
  display: flex; align-items: center; justify-content: center;
  padding: 24px;
  backdrop-filter: blur(6px);
}
#rankModal.hidden { display: none !important; }
.rank-modal-card {
  background: var(--panel);
  border: 2px solid var(--gold);
  border-radius: 16px;
  padding: 36px;
  max-width: 520px;
  width: 100%;
  box-shadow: 0 0 60px rgba(245,200,66,0.15), 0 32px 80px rgba(0,0,0,0.8);
  animation: obIn 0.35s ease;
}
.rank-modal-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.8rem;
  letter-spacing: 0.15em;
  color: var(--gold);
  margin-bottom: 6px;
}
.rank-modal-sub {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--text2);
  font-size: 0.85rem;
  margin-bottom: 28px;
}
.rank-ladder { display: flex; flex-direction: column; gap: 8px; }
.rank-rung {
  display: flex; align-items: center; gap: 14px;
  background: var(--card); border: 1px solid var(--border2);
  border-radius: 8px; padding: 12px 16px;
  transition: all 0.2s;
  position: relative; overflow: hidden;
}
.rank-rung.active {
  border-color: var(--gold);
  background: var(--gold-dim);
  box-shadow: 0 0 20px rgba(245,200,66,0.1);
}
.rank-rung.achieved { border-color: rgba(45,204,112,0.3); }
.rank-rung.locked { opacity: 0.45; }
.rank-rung-fill {
  position: absolute; left: 0; top: 0; bottom: 0;
  background: rgba(245,200,66,0.06);
  pointer-events: none;
  transition: width 0.6s ease;
}
.rank-rung-icon { font-size: 1.6rem; line-height: 1; flex-shrink: 0; width: 36px; text-align: center; }
.rank-rung-info { flex: 1; }
.rank-rung-name {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1rem; letter-spacing: 0.1em;
  color: var(--text);
}
.rank-rung.active .rank-rung-name { color: var(--gold); }
.rank-rung.achieved .rank-rung-name { color: var(--green); }
.rank-rung-xp { font-size: 0.52rem; letter-spacing: 0.1em; color: var(--text2); margin-top: 2px; }
.rank-rung-status {
  font-size: 0.52rem; letter-spacing: 0.12em;
  text-transform: uppercase;
  padding: 3px 8px; border-radius: 3px;
}
.rank-rung-status.cur { background: rgba(245,200,66,0.15); color: var(--gold); border: 1px solid rgba(245,200,66,0.3); }
.rank-rung-status.done { background: rgba(45,204,112,0.12); color: var(--green); border: 1px solid rgba(45,204,112,0.3); }
.rank-rung-status.next { background: rgba(255,60,60,0.08); color: var(--text2); border: 1px solid var(--border2); }
.rank-rung-progress-text { font-size: 0.55rem; color: var(--text2); min-width: 80px; text-align: right; }
.rank-modal-close {
  margin-top: 24px;
  background: var(--card);
  border: 1px solid var(--border2);
  color: var(--text2);
  padding: 10px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'DM Mono', monospace;
  font-size: 0.62rem;
  letter-spacing: 0.1em;
  width: 100%;
  transition: all 0.15s;
}
.rank-modal-close:hover { border-color: var(--gold); color: var(--gold); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MATCH SESSION SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Pre-match popup */
#preMatchModal {
  position: fixed; inset: 0; z-index: 8200;
  background: rgba(0,0,0,0.92);
  display: flex; align-items: center; justify-content: center;
  padding: 24px;
  backdrop-filter: blur(6px);
}
#preMatchModal.hidden { display: none !important; }

.pm-card {
  background: var(--panel);
  border: 2px solid var(--blue);
  border-radius: 16px;
  padding: 36px;
  max-width: 500px;
  width: 100%;
  box-shadow: 0 0 60px rgba(60,141,255,0.15), 0 32px 80px rgba(0,0,0,0.8);
  animation: obIn 0.35s ease;
}
.pm-badge {
  display: inline-block;
  background: rgba(60,141,255,0.1);
  border: 1px solid rgba(60,141,255,0.4);
  color: var(--blue);
  font-size: 0.5rem; letter-spacing: 0.25em; text-transform: uppercase;
  padding: 4px 14px; border-radius: 20px; margin-bottom: 14px;
}
.pm-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.8rem; letter-spacing: 0.15em;
  color: #fff; margin-bottom: 22px; line-height: 1;
}
.pm-field { margin-bottom: 16px; }
.pm-label {
  font-size: 0.5rem; letter-spacing: 0.18em; text-transform: uppercase;
  color: var(--text2); margin-bottom: 6px; display: block;
}
.pm-input {
  width: 100%; background: var(--card2);
  border: 1px solid var(--border2); border-radius: 6px;
  color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.7rem; padding: 10px 14px; outline: none;
  transition: border-color 0.15s;
}
.pm-input:focus { border-color: var(--blue); }
.pm-input::placeholder { color: var(--text3); }
.pm-time-options { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
.pm-time-opt {
  background: var(--card2); border: 2px solid var(--border2);
  color: var(--text2); padding: 8px 10px; border-radius: 6px;
  cursor: pointer; font-family: 'DM Mono', monospace;
  font-size: 0.62rem; text-align: center; transition: all 0.15s;
}
.pm-time-opt:hover { border-color: var(--blue); color: var(--blue); }
.pm-time-opt.selected { border-color: var(--blue); background: var(--blue-dim); color: var(--blue); }
.pm-start-btn {
  width: 100%; margin-top: 22px;
  background: var(--blue); border: none;
  color: #fff; padding: 16px;
  border-radius: 8px; cursor: pointer;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem; letter-spacing: 0.15em;
  transition: all 0.2s;
}
.pm-start-btn:hover { background: #5ca0ff; transform: translateY(-1px); }
.pm-cancel { display: block; text-align: center; margin-top: 12px; font-size: 0.6rem; color: var(--text2); cursor: pointer; transition: color 0.15s; background: none; border: none; width: 100%; letter-spacing: 0.1em; font-family: 'DM Mono', monospace; }
.pm-cancel:hover { color: var(--text); }

/* Active session panel */
#activeSessionPanel {
  position: fixed; inset: 0; z-index: 8100;
  background: rgba(0,0,0,0.95);
  display: flex; align-items: stretch;
  backdrop-filter: blur(8px);
  overflow-y: auto;
}
#activeSessionPanel.hidden { display: none !important; }
.asp-inner {
  margin: auto;
  width: 100%; max-width: 780px;
  padding: 28px 24px;
  display: flex; flex-direction: column; gap: 20px;
}
.asp-header {
  display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
}
.asp-timer-block {
  background: var(--card);
  border: 1px solid rgba(60,141,255,0.3);
  border-radius: 10px;
  padding: 12px 20px;
  display: flex; align-items: center; gap: 16px;
}
.asp-timer-display {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2.6rem;
  letter-spacing: 0.1em;
  color: var(--blue);
  line-height: 1;
  min-width: 110px;
}
.asp-timer-label {
  font-size: 0.48rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--text2);
}
.asp-session-meta { flex: 1; }
.asp-session-vs {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.4rem; letter-spacing: 0.1em; color: #fff;
}
.asp-session-focus { font-size: 0.62rem; color: var(--text2); margin-top: 2px; font-style: italic; font-family: 'Crimson Pro', serif; }
.asp-end-btn {
  background: var(--accent); border: none;
  color: #fff; padding: 10px 20px;
  border-radius: 8px; cursor: pointer;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1rem; letter-spacing: 0.15em;
  transition: all 0.2s; white-space: nowrap;
}
.asp-end-btn:hover { background: #ff5555; transform: translateY(-1px); }

.asp-notes-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 14px;
}
.asp-note-section {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 16px 18px;
}
.asp-note-section-title {
  font-size: 0.48rem; letter-spacing: 0.22em; text-transform: uppercase;
  color: var(--text2); margin-bottom: 10px;
  display: flex; align-items: center; gap: 8px;
}
.asp-note-section-title .nt-dot {
  width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0;
}
.asp-note-textarea {
  width: 100%; background: #090910;
  border: 1px solid var(--border2); border-radius: 5px;
  color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.62rem; padding: 8px 12px;
  resize: vertical; min-height: 80px; outline: none;
  line-height: 1.65; transition: border-color 0.15s;
}
.asp-note-textarea:focus { border-color: rgba(60,141,255,0.4); }
.asp-note-textarea::placeholder { color: var(--text3); }

/* Post-session questionnaire */
#postSessionModal {
  position: fixed; inset: 0; z-index: 8300;
  background: rgba(0,0,0,0.94);
  display: flex; align-items: center; justify-content: center;
  padding: 24px;
  backdrop-filter: blur(6px);
  overflow-y: auto;
}
#postSessionModal.hidden { display: none !important; }
.pst-card {
  background: var(--panel);
  border: 2px solid var(--green);
  border-radius: 16px;
  padding: 36px;
  max-width: 520px;
  width: 100%;
  box-shadow: 0 0 60px rgba(45,204,112,0.15), 0 32px 80px rgba(0,0,0,0.8);
  animation: obIn 0.35s ease;
  margin: auto;
}
.pst-badge {
  display: inline-block;
  background: rgba(45,204,112,0.1);
  border: 1px solid rgba(45,204,112,0.35);
  color: var(--green);
  font-size: 0.5rem; letter-spacing: 0.25em; text-transform: uppercase;
  padding: 4px 14px; border-radius: 20px; margin-bottom: 14px;
}
.pst-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.8rem; letter-spacing: 0.12em;
  color: #fff; margin-bottom: 6px; line-height: 1;
}
.pst-duration { font-size: 0.6rem; color: var(--text2); margin-bottom: 22px; }
.pst-field { margin-bottom: 18px; }
.pst-label {
  font-size: 0.5rem; letter-spacing: 0.18em; text-transform: uppercase;
  color: var(--text2); margin-bottom: 6px; display: block;
}
.pst-input {
  width: 100%; background: var(--card2);
  border: 1px solid var(--border2); border-radius: 6px;
  color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 0.7rem; padding: 10px 14px; outline: none;
  transition: border-color 0.15s;
}
.pst-input:focus { border-color: var(--green); }
.pst-input::placeholder { color: var(--text3); }
.pst-rating-row { display: flex; gap: 8px; }
.pst-rating-btn {
  flex: 1; background: var(--card2); border: 2px solid var(--border2);
  color: var(--text2); padding: 10px 4px; border-radius: 6px;
  cursor: pointer; font-family: 'Bebas Neue', sans-serif;
  font-size: 1.1rem; text-align: center; transition: all 0.15s;
}
.pst-rating-btn:hover { border-color: var(--green); color: var(--green); }
.pst-rating-btn.selected { border-color: var(--green); background: rgba(45,204,112,0.15); color: var(--green); }
.pst-save-btn {
  width: 100%; margin-top: 22px;
  background: var(--green); border: none;
  color: #111; padding: 16px;
  border-radius: 8px; cursor: pointer;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem; letter-spacing: 0.15em;
  transition: all 0.2s;
}
.pst-save-btn:hover { background: #3de88a; transform: translateY(-1px); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAST SESSIONS TOOL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.past-sessions-list { display: flex; flex-direction: column; gap: 16px; }
.ps-card {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 10px;
  overflow: hidden;
  transition: border-color 0.15s;
}
.ps-card:hover { border-color: var(--blue-dim); border-color: rgba(60,141,255,0.3); }
.ps-card-hdr {
  background: #12121f;
  padding: 14px 18px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
  cursor: pointer;
}
.ps-card-hdr:hover { background: #1a1a2a; }
.ps-date-tag {
  font-size: 0.5rem; letter-spacing: 0.15em; text-transform: uppercase;
  background: var(--blue-dim); color: var(--blue);
  border: 1px solid rgba(60,141,255,0.3);
  padding: 2px 8px; border-radius: 3px;
}
.ps-vs { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 0.08em; flex: 1; }
.ps-meta-pills { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.ps-meta-pill {
  font-size: 0.48rem; letter-spacing: 0.1em; padding: 3px 9px; border-radius: 10px;
}
.ps-meta-pill.duration { background: rgba(60,141,255,0.1); color: var(--blue); border: 1px solid rgba(60,141,255,0.25); }
.ps-meta-pill.rating-high { background: rgba(45,204,112,0.1); color: var(--green); border: 1px solid rgba(45,204,112,0.25); }
.ps-meta-pill.rating-mid { background: rgba(245,200,66,0.1); color: var(--gold); border: 1px solid rgba(245,200,66,0.25); }
.ps-meta-pill.rating-low { background: rgba(255,60,60,0.1); color: var(--accent); border: 1px solid rgba(255,60,60,0.25); }
.ps-expand-btn { font-size: 0.55rem; color: var(--text2); transition: transform 0.2s; background: none; border: none; cursor: pointer; }
.ps-card.open .ps-expand-btn { transform: rotate(180deg); }
.ps-card-body { display: none; padding: 18px; }
.ps-card.open .ps-card-body { display: block; }

.ps-body-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 14px; margin-bottom: 16px; }
.ps-note-block { }
.ps-note-label { font-size: 0.45rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text2); margin-bottom: 5px; }
.ps-note-text { font-size: 0.62rem; color: var(--text); line-height: 1.65; font-family: 'DM Mono', monospace; }
.ps-note-text.empty { color: var(--text3); font-style: italic; }
.ps-takeaway-block {
  background: rgba(45,204,112,0.06);
  border: 1px solid rgba(45,204,112,0.2);
  border-radius: 6px; padding: 12px 14px; margin-top: 4px;
}
.ps-takeaway-label { font-size: 0.45rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--green); margin-bottom: 5px; }
.ps-takeaway-text { font-size: 0.65rem; color: var(--text); line-height: 1.6; }
.ps-work-on-block {
  background: rgba(255,60,60,0.06);
  border: 1px solid rgba(255,60,60,0.2);
  border-radius: 6px; padding: 12px 14px; margin-top: 10px;
}
.ps-work-on-label { font-size: 0.45rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--accent); margin-bottom: 5px; }
.ps-work-on-text { font-size: 0.65rem; color: var(--text); line-height: 1.6; }
.ps-del-btn {
  margin-top: 12px; background: none;
  border: 1px solid rgba(255,60,60,0.2); color: var(--text2);
  padding: 5px 14px; border-radius: 4px; cursor: pointer;
  font-family: 'DM Mono', monospace; font-size: 0.55rem; letter-spacing: 0.08em;
  transition: all 0.15s;
}
.ps-del-btn:hover { border-color: var(--accent); color: var(--accent); }
.ps-empty {
  text-align: center; padding: 60px 20px;
  font-family: 'Crimson Pro', serif; font-style: italic;
  color: var(--text3); font-size: 0.95rem;
}
.ps-stats-bar {
  display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap;
}
.ps-stat-chip {
  background: var(--card); border: 1px solid var(--border2);
  border-radius: 8px; padding: 10px 16px; text-align: center;
  min-width: 90px;
}
.ps-stat-chip .sc-num {
  font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem;
  color: var(--blue); line-height: 1;
}
.ps-stat-chip .sc-label {
  font-size: 0.45rem; letter-spacing: 0.15em; text-transform: uppercase;
  color: var(--text2); margin-top: 2px;
}

/* Quest card glow on hover */
.quest-card {
  transition: border-color 0.2s, box-shadow 0.2s, transform 0.15s;
}
.quest-card:hover {
  box-shadow: 0 0 20px rgba(255,60,60,0.12), 0 4px 20px rgba(0,0,0,0.4);
  transform: translateY(-1px);
}
.quest-card.completed {
  box-shadow: 0 0 20px rgba(45,204,112,0.15) !important;
}

/* Pillar nav items glow when active */
.nav-item.active {
  box-shadow: inset 0 0 20px rgba(255,60,60,0.08);
}

/* XP pop animation */
@keyframes xpPop {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  100% { opacity: 0; transform: translateY(-60px) scale(1.5); }
}
.xp-float {
  position: fixed;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.4rem;
  color: var(--gold);
  pointer-events: none;
  z-index: 9999;
  animation: xpPop 1.2s ease-out forwards;
  text-shadow: 0 0 20px rgba(245,200,66,0.8);
}

/* Daily Challenge Pop-up */
#dailyChallengeModal {
  position: fixed;
  inset: 0;
  z-index: 8000;
  background: rgba(0,0,0,0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
  backdrop-filter: blur(4px);
}
#dailyChallengeModal {
  display: flex;
}
#dailyChallengeModal.hidden { display: none !important; }
.dc-card {
  background: var(--panel);
  border: 2px solid var(--gold);
  border-radius: 16px;
  padding: 40px;
  max-width: 520px;
  width: 100%;
  text-align: center;
  box-shadow: 0 0 60px rgba(245,200,66,0.2), 0 32px 80px rgba(0,0,0,0.8);
  animation: obIn 0.4s ease;
}
.dc-badge {
  display: inline-block;
  background: rgba(245,200,66,0.1);
  border: 1px solid rgba(245,200,66,0.4);
  color: var(--gold);
  font-size: 0.55rem;
  letter-spacing: 0.25em;
  text-transform: uppercase;
  padding: 4px 14px;
  border-radius: 20px;
  margin-bottom: 16px;
}
.dc-icon { font-size: 3.5rem; margin-bottom: 12px; }
.dc-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2rem;
  letter-spacing: 0.15em;
  color: var(--gold);
  margin-bottom: 8px;
  line-height: 1;
}
.dc-challenge {
  font-family: 'Crimson Pro', serif;
  font-size: 1.05rem;
  line-height: 1.7;
  color: var(--text);
  margin-bottom: 24px;
  padding: 16px;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  border-left: 3px solid var(--gold);
  text-align: left;
}
.dc-xp-reward {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.4rem;
  color: var(--green);
  letter-spacing: 0.1em;
  margin-bottom: 20px;
}
.dc-btn-row { display: flex; gap: 10px; }
.dc-accept {
  flex: 2;
  background: var(--gold);
  border: none;
  color: #000;
  padding: 14px;
  border-radius: 8px;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.1rem;
  letter-spacing: 0.12em;
  cursor: pointer;
  transition: all 0.2s;
}
.dc-accept:hover { background: #ffd700; transform: translateY(-1px); }
.dc-skip {
  flex: 1;
  background: transparent;
  border: 1px solid var(--border2);
  color: var(--text2);
  padding: 14px;
  border-radius: 8px;
  font-family: 'DM Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 0.08em;
  cursor: pointer;
  transition: all 0.2s;
}
.dc-skip:hover { border-color: var(--text2); color: var(--text); }

/* Pillar completion banner */
@keyframes pillarUnlock {
  0% { transform: scale(0.8) rotateX(-20deg); opacity: 0; }
  60% { transform: scale(1.05) rotateX(2deg); }
  100% { transform: scale(1) rotateX(0); opacity: 1; }
}
.pillar-unlock-banner {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, #1a1a00, #2a2a00);
  border: 2px solid var(--gold);
  border-radius: 12px;
  padding: 16px 28px;
  z-index: 8500;
  text-align: center;
  box-shadow: 0 0 40px rgba(245,200,66,0.3);
  animation: pillarUnlock 0.5s ease forwards, fadeOut 0.5s ease 3s forwards;
  pointer-events: none;
}
@keyframes fadeOut { to { opacity: 0; transform: translateX(-50%) translateY(-10px); } }
.pub-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 0.15em; color: var(--gold); }
.pub-sub { font-size: 0.62rem; color: var(--text2); margin-top: 2px; }

/* Onboarding cards - more gaming feel */
.ob-card {
  position: relative;
  overflow: hidden;
}
.ob-card::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(ellipse at center, rgba(255,60,60,0.04) 0%, transparent 60%);
  pointer-events: none;
}
.ob-opt {
  position: relative;
  overflow: hidden;
}
.ob-opt::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, transparent 50%, rgba(255,60,60,0.03) 100%);
  pointer-events: none;
}

/* Quest pillar indicator bar */
.quest-pillar-bar {
  height: 2px;
  border-radius: 1px;
  margin-top: 8px;
  transition: width 0.5s ease;
}

/* Pillar progress pills in today section */
.pillar-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin: 16px 0;
}
.pillar-pill {
  display: flex;
  align-items: center;
  gap: 6px;
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 20px;
  padding: 4px 10px 4px 7px;
  font-size: 0.55rem;
  letter-spacing: 0.06em;
  color: var(--text2);
  transition: all 0.2s;
  cursor: pointer;
}
.pillar-pill:hover { border-color: var(--accent); color: var(--text); }
.pillar-pill .pp-icon { font-size: 0.9rem; }
.pillar-pill .pp-bar { 
  width: 40px; height: 3px; background: var(--border);
  border-radius: 2px; overflow: hidden;
}
.pillar-pill .pp-fill { height: 100%; border-radius: 2px; background: var(--accent); transition: width 0.4s; }
.pillar-pill .pp-pct { color: var(--text); font-weight: 500; }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME HERO DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.home-hero {
  background: linear-gradient(135deg, #0c0c1e 0%, #111128 100%);
  border: 1px solid var(--border2);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 18px;
  position: relative;
  overflow: hidden;
}
.home-hero::before {
  content: '';
  position: absolute;
  top: -60px; right: -60px;
  width: 200px; height: 200px;
  background: radial-gradient(circle, rgba(255,60,60,0.08) 0%, transparent 70%);
  pointer-events: none;
}
.hero-top-row { display: flex; gap: 24px; align-items: flex-start; margin-bottom: 16px; }
.hero-day-ring { position: relative; width: 110px; height: 110px; flex-shrink: 0; }
.ring-svg { width: 110px; height: 110px; transform: rotate(-90deg); }
.ring-bg { fill: none; stroke: var(--border2); stroke-width: 8; }
.ring-fill { fill: none; stroke: var(--accent); stroke-width: 8; stroke-linecap: round; filter: drop-shadow(0 0 6px rgba(255,60,60,0.5)); transition: stroke-dashoffset 0.8s ease; }
.ring-inner { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
.ring-day { font-family: 'Bebas Neue', sans-serif; font-size: 2.2rem; color: var(--text); line-height: 1; }
.ring-of { font-size: 0.48rem; letter-spacing: 0.15em; color: var(--text2); text-transform: uppercase; }
.ring-pct { font-size: 0.6rem; color: var(--gold); font-weight: 500; margin-top: 2px; }
.hero-stats-col { flex: 1; min-width: 0; }
.hero-rank-badge { display: flex; align-items: center; gap: 10px; background: rgba(255,60,60,0.08); border: 1px solid rgba(255,60,60,0.2); border-radius: 10px; padding: 8px 14px; margin-bottom: 12px; }
.hrb-icon { font-size: 1.4rem; }
.hrb-rank { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 0.1em; color: var(--accent); line-height: 1; }
.hrb-xp { font-size: 0.55rem; color: var(--text2); letter-spacing: 0.08em; }
.hero-stat-row { display: flex; gap: 10px; margin-bottom: 12px; }
.hsr-item { background: var(--card); border: 1px solid var(--border2); border-radius: 8px; padding: 8px 10px; text-align: center; flex: 1; }
.hsr-num { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: var(--text); line-height: 1; }
.hsr-fire { font-size: 1rem; }
.hsr-label { font-size: 0.45rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text2); margin-top: 2px; }
.hero-quote { font-family: 'Crimson Pro', serif; font-style: italic; font-size: 0.78rem; color: var(--text2); line-height: 1.5; border-left: 2px solid var(--border2); padding-left: 10px; }
.hero-block-banner { display: flex; align-items: center; gap: 14px; background: rgba(255,255,255,0.03); border-radius: 8px; padding: 10px 14px; font-size: 0.62rem; border: 1px solid; flex-wrap: wrap; }
.hero-block-b1 { border-color: rgba(255,60,60,0.2); }
.hero-block-b2 { border-color: rgba(60,141,255,0.2); }
.hero-block-b3 { border-color: rgba(45,204,112,0.2); }
.hero-block-b4 { border-color: rgba(245,200,66,0.2); }
.hbb-label { font-family: 'Bebas Neue', sans-serif; font-size: 0.9rem; letter-spacing: 0.12em; white-space: nowrap; }
.hero-block-b1 .hbb-label { color: var(--accent); }
.hero-block-b2 .hbb-label { color: var(--blue); }
.hero-block-b3 .hbb-label { color: var(--green); }
.hero-block-b4 .hbb-label { color: var(--gold); }
.hbb-focus { color: var(--text2); font-style: italic; font-family: 'Crimson Pro', serif; font-size: 0.8rem; }

/* â”€â”€ PILLAR GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pillar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(155px, 1fr)); gap: 8px; margin-bottom: 18px; }
.pg-item { background: var(--card); border: 1px solid var(--border2); border-radius: 10px; padding: 12px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.15s; position: relative; overflow: hidden; }
.pg-item::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--pill-color, var(--accent)); border-radius: 3px 0 0 3px; }
.pg-item:hover { background: var(--card2); border-color: var(--pill-color, var(--accent)); transform: translateY(-1px); }
.pg-icon { font-size: 1.2rem; flex-shrink: 0; }
.pg-info { flex: 1; min-width: 0; }
.pg-name { font-size: 0.58rem; font-weight: 500; color: var(--text); margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.pg-bar-wrap { height: 3px; background: var(--border); border-radius: 2px; overflow: hidden; margin-bottom: 3px; }
.pg-bar-fill { height: 100%; border-radius: 2px; transition: width 0.5s ease; }
.pg-pct { font-size: 0.52rem; font-weight: 500; }

/* â”€â”€ QUEST HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.quest-header-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.qhr-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: 0.12em; color: var(--text); }
.qhr-sub { font-size: 0.55rem; color: var(--text2); letter-spacing: 0.08em; margin-top: 2px; }
.qhr-spin-btn { background: rgba(245,200,66,0.1); border: 1px solid rgba(245,200,66,0.3); color: var(--gold); padding: 8px 16px; border-radius: 8px; font-family: 'DM Mono', monospace; font-size: 0.62rem; letter-spacing: 0.08em; cursor: pointer; transition: all 0.2s; }
.qhr-spin-btn:hover { background: rgba(245,200,66,0.2); transform: scale(1.05); }
.quest-progress-bar { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; margin-bottom: 14px; }
.qpb-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--gold)); border-radius: 2px; transition: width 0.5s ease; }
.complete-session-btn.done { background: var(--green); cursor: default; }
.roadmap-section { margin-top: 24px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUESTION WHEEL MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#wheelModal { position: fixed; inset: 0; z-index: 9500; background: rgba(0,0,0,0.92); display: flex; align-items: center; justify-content: center; padding: 24px; backdrop-filter: blur(6px); }
#wheelModal.hidden { display: none !important; }
.wm-card { background: var(--panel); border: 1px solid var(--border2); border-radius: 20px; padding: 32px; max-width: 520px; width: 100%; text-align: center; box-shadow: 0 40px 100px rgba(0,0,0,0.8); animation: obIn 0.3s ease; }
.wm-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 0.15em; color: var(--gold); margin-bottom: 4px; }
.wm-sub { font-size: 0.58rem; color: var(--text2); letter-spacing: 0.1em; margin-bottom: 20px; }
.wm-wheel-area { position: relative; width: 200px; height: 200px; margin: 0 auto 20px; }
#wheelCanvas { border-radius: 50%; display: block; }
.wm-pointer { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); font-size: 1.6rem; filter: drop-shadow(0 2px 8px rgba(255,60,60,0.8)); }
.wm-question { background: rgba(255,255,255,0.04); border: 1px solid var(--border2); border-radius: 10px; padding: 14px 18px; font-family: 'Crimson Pro', serif; font-size: 1rem; line-height: 1.6; color: var(--text); margin-bottom: 12px; min-height: 56px; display: flex; align-items: center; justify-content: center; text-align: center; }
.wm-answer { width: 100%; background: var(--card); border: 1px solid var(--border2); border-radius: 8px; color: var(--text); font-family: 'DM Mono', monospace; font-size: 0.65rem; padding: 10px 14px; resize: vertical; min-height: 65px; outline: none; margin-bottom: 12px; transition: border-color 0.2s; }
.wm-answer:focus { border-color: var(--gold); }
.wm-xp-tag { display: inline-block; background: rgba(45,204,112,0.1); border: 1px solid rgba(45,204,112,0.3); color: var(--green); font-size: 0.52rem; letter-spacing: 0.12em; padding: 2px 10px; border-radius: 20px; margin-bottom: 12px; }
.wm-btn-row { display: flex; gap: 8px; }
.wm-spin-btn { flex: 1; background: var(--gold); border: none; color: #000; padding: 11px; border-radius: 8px; font-family: 'Bebas Neue', sans-serif; font-size: 1rem; letter-spacing: 0.12em; cursor: pointer; transition: all 0.2s; }
.wm-spin-btn:hover { background: #ffd700; }
.wm-spin-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.wm-save-btn { flex: 1; background: var(--green-dim); border: 1px solid rgba(45,204,112,0.3); color: var(--green); padding: 11px; border-radius: 8px; font-family: 'Bebas Neue', sans-serif; font-size: 1rem; letter-spacing: 0.12em; cursor: pointer; transition: all 0.2s; }
.wm-save-btn:hover { background: rgba(45,204,112,0.2); }
.wm-close-btn { background: none; border: none; color: var(--text2); font-family: 'DM Mono', monospace; font-size: 0.6rem; cursor: pointer; margin-top: 10px; letter-spacing: 0.08em; transition: color 0.2s; }
.wm-close-btn:hover { color: var(--text); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SESSION JOURNAL PROMPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#sessionJournalModal { position: fixed; inset: 0; z-index: 9400; background: rgba(0,0,0,0.88); display: flex; align-items: center; justify-content: center; padding: 24px; backdrop-filter: blur(4px); }
#sessionJournalModal.hidden { display: none !important; }
.sj-card { background: var(--panel); border: 1px solid rgba(60,141,255,0.3); border-radius: 16px; padding: 32px; max-width: 500px; width: 100%; box-shadow: 0 0 60px rgba(60,141,255,0.1); animation: obIn 0.35s ease; }
.sj-badge { display: inline-block; background: var(--blue-dim); border: 1px solid rgba(60,141,255,0.3); color: var(--blue); font-size: 0.5rem; letter-spacing: 0.2em; text-transform: uppercase; padding: 3px 12px; border-radius: 20px; margin-bottom: 12px; }
.sj-prompt { font-family: 'Crimson Pro', serif; font-size: 1.1rem; line-height: 1.6; color: var(--text); margin-bottom: 14px; }
.sj-textarea { width: 100%; background: var(--card); border: 1px solid var(--border2); border-radius: 8px; color: var(--text); font-family: 'DM Mono', monospace; font-size: 0.65rem; padding: 12px; resize: vertical; min-height: 80px; outline: none; transition: border-color 0.2s; margin-bottom: 14px; }
.sj-textarea:focus { border-color: var(--blue); }
.sj-btn-row { display: flex; gap: 8px; }
.sj-save { flex: 2; background: var(--blue); border: none; color: #fff; padding: 11px; border-radius: 8px; font-family: 'Bebas Neue', sans-serif; font-size: 1rem; letter-spacing: 0.12em; cursor: pointer; transition: all 0.2s; }
.sj-save:hover { background: #5aabff; }
.sj-skip { flex: 1; background: transparent; border: 1px solid var(--border2); color: var(--text2); padding: 11px; border-radius: 8px; font-family: 'DM Mono', monospace; font-size: 0.6rem; cursor: pointer; transition: all 0.2s; }
.sj-skip:hover { border-color: var(--text2); }


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOD STAT TRACKING MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#vodStatModal { position: fixed; inset: 0; z-index: 9500; background: rgba(0,0,0,0.92); display: flex; align-items: center; justify-content: center; padding: 24px; backdrop-filter: blur(6px); overflow-y: auto; }
#vodStatModal.hidden { display: none !important; }
.vod-stat-card { background: var(--panel); border: 2px solid rgba(168,85,247,0.4); border-radius: 16px; padding: 36px; max-width: 600px; width: 100%; box-shadow: 0 0 80px rgba(168,85,247,0.15); animation: obIn 0.3s ease; margin: 20px 0; }
.vod-stat-badge { display: inline-block; background: var(--purple-dim); border: 1px solid rgba(168,85,247,0.3); color: var(--purple); font-size: 0.5rem; letter-spacing: 0.2em; text-transform: uppercase; padding: 3px 12px; border-radius: 20px; margin-bottom: 8px; }
.vod-stat-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 0.12em; color: var(--text); margin-bottom: 24px; }
.vod-stat-field { margin-bottom: 20px; }
.vod-stat-label { display: block; font-size: 0.65rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text); margin-bottom: 6px; font-weight: 600; }
.vod-stat-input { width: 100%; background: var(--card); border: 1px solid var(--border2); border-radius: 8px; color: var(--text); font-family: 'DM Mono', monospace; font-size: 0.7rem; padding: 10px 12px; outline: none; transition: border-color 0.2s; }
.vod-stat-input:focus { border-color: var(--purple); }
.vod-stat-textarea { width: 100%; background: var(--card); border: 1px solid var(--border2); border-radius: 8px; color: var(--text); font-family: 'DM Mono', monospace; font-size: 0.65rem; padding: 12px; resize: vertical; min-height: 80px; outline: none; transition: border-color 0.2s; }
.vod-stat-textarea:focus { border-color: var(--purple); }
.vod-stat-hint { font-size: 0.58rem; color: var(--text3); margin-top: 4px; font-style: italic; }
.vod-stat-calculator { background: rgba(168,85,247,0.05); border: 1px solid rgba(168,85,247,0.2); border-radius: 8px; padding: 12px; margin-top: 10px; }
.calc-title { font-size: 0.6rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text2); margin-bottom: 8px; }
.calc-inputs { display: flex; gap: 6px; margin-bottom: 8px; flex-wrap: wrap; }
.calc-input { width: 56px; flex: none; background: var(--card); border: 1px solid var(--border2); border-radius: 6px; color: var(--text); font-family: 'DM Mono', monospace; font-size: 0.65rem; padding: 6px 8px; outline: none; text-align: center; }
.calc-btn { background: var(--purple); border: none; color: white; padding: 8px 16px; border-radius: 6px; font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 0.05em; cursor: pointer; transition: all 0.2s; width: 100%; }
.calc-btn:hover { background: #b968ff; }
.vod-stat-btn-row { display: flex; gap: 10px; margin-top: 28px; }
.vod-stat-save { flex: 2; background: var(--purple); border: none; color: white; padding: 14px; border-radius: 8px; font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 0.12em; cursor: pointer; transition: all 0.2s; }
.vod-stat-save:hover { background: #b968ff; transform: translateY(-2px); }
.vod-stat-cancel { flex: 1; background: transparent; border: 1px solid var(--border2); color: var(--text2); padding: 14px; border-radius: 8px; font-family: 'DM Mono', monospace; font-size: 0.65rem; cursor: pointer; transition: all 0.2s; }
.vod-stat-cancel:hover { border-color: var(--text); color: var(--text); }

/* VOD Charts Styling */
.vod-chart-card {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 16px;
}
.vod-chart-title {
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.05em;
  margin-bottom: 4px;
}
.vod-chart-subtitle {
  font-size: 0.55rem;
  color: var(--text3);
  margin-bottom: 12px;
}
.vod-history-section { margin-top: 32px; }
.vod-history-title {
  font-size: 0.8rem;
  font-weight: 600;
  letter-spacing: 0.1em;
  margin-bottom: 16px;
  text-transform: uppercase;
  color: var(--text2);
}
.vod-history-card {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
}
.vod-history-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
.vod-history-name { font-weight: 600; font-size: 0.75rem; }
.vod-history-date {
  font-size: 0.6rem;
  color: var(--text3);
  font-family: 'DM Mono', monospace;
}
.vod-history-stats { display: flex; gap: 16px; flex-wrap: wrap; }
.vod-stat-item { text-align: center; }
.vod-stat-value {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--purple);
  font-family: 'Bebas Neue', sans-serif;
}
.vod-stat-label {
  font-size: 0.5rem;
  color: var(--text3);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}
.vod-history-notes {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--border);
  font-size: 0.65rem;
  color: var(--text2);
  line-height: 1.5;
}

/* Tournament Button */
.tournament-btn {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px;
  border-radius: 12px;
  border: 2px solid;
  cursor: pointer;
  margin: 16px 0;
  transition: all 0.2s;
}
.tournament-btn-incomplete {
  border-color: var(--gold);
  background: rgba(245,200,66,0.05);
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { box-shadow: 0 0 20px rgba(245,200,66,0.2); }
  50% { box-shadow: 0 0 40px rgba(245,200,66,0.4); }
}
.tournament-btn-complete {
  border-color: var(--green);
  background: rgba(45,204,112,0.05);
}
.tournament-btn:hover { transform: translateY(-2px); }
.tournament-btn-icon { font-size: 2.5rem; }
.tournament-btn-arrow {
  font-size: 1.8rem;
  animation: bounce 1.5s infinite;
}
@keyframes bounce {
  0%, 100% { transform: translateX(0); }
  50% { transform: translateX(5px); }
}
.tournament-btn-content { flex: 1; }
.tournament-btn-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
  letter-spacing: 0.1em;
  margin-bottom: 4px;
}
.tournament-btn-callout {
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--gold);
  margin: 4px 0;
}
.tournament-btn-champion {
  font-size: 1rem;
  font-weight: 700;
  color: var(--green);
  margin: 4px 0;
}
.tournament-btn-subtitle {
  font-size: 0.6rem;
  color: var(--text3);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOURNAMENT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#tournamentModal {
  position: fixed;
  inset: 0;
  z-index: 9600;
  background: rgba(0,0,0,0.95);
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 24px;
  overflow-y: auto;
  backdrop-filter: blur(6px);
}
#tournamentModal.hidden { display: none !important; }

.tm-card {
  background: var(--panel);
  border: 2px solid var(--gold);
  border-radius: 16px;
  padding: 32px;
  max-width: 1100px;
  width: 100%;
  margin: auto;
  box-shadow: 0 0 80px rgba(245,200,66,0.15);
}
.tm-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 24px;
}
.tm-badge {
  font-size: 0.6rem;
  letter-spacing: 0.15em;
  color: var(--gold);
  margin-bottom: 6px;
  font-weight: 700;
}
.tm-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2rem;
  letter-spacing: 0.1em;
}
.tm-close {
  background: var(--border2);
  border: none;
  color: var(--text2);
  font-size: 1rem;
  width: 36px;
  height: 36px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  flex-shrink: 0;
}
.tm-close:hover { background: var(--accent); color: white; }

.tm-tabs {
  display: flex;
  gap: 4px;
  margin-bottom: 24px;
  border-bottom: 1px solid var(--border2);
  padding-bottom: 0;
}
.tm-tab {
  background: none;
  border: none;
  color: var(--text3);
  font-family: 'DM Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 0.1em;
  font-weight: 700;
  padding: 10px 20px;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  margin-bottom: -1px;
  transition: all 0.2s;
}
.tm-tab.active { color: var(--gold); border-bottom-color: var(--gold); }
.tm-tab:hover:not(.active) { color: var(--text2); }

.tm-week-nav {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
}
.tm-week-btn {
  background: var(--card);
  border: 1px solid var(--border2);
  color: var(--text2);
  width: 36px;
  height: 36px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.8rem;
  transition: all 0.2s;
}
.tm-week-btn:hover { border-color: var(--gold); color: var(--gold); }
.tm-week-label {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
  letter-spacing: 0.1em;
  color: var(--gold);
}

.tm-bracket-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 12px;
  margin-bottom: 28px;
  overflow-x: auto;
}
@media (max-width: 800px) {
  .tm-bracket-grid { grid-template-columns: repeat(5, minmax(140px, 1fr)); }
}
.tm-column {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.tm-col-header {
  font-size: 0.5rem;
  letter-spacing: 0.15em;
  font-weight: 700;
  padding: 6px 10px;
  border-radius: 6px;
  text-align: center;
  text-transform: uppercase;
}
.tm-col-header.winners { background: rgba(60,141,255,0.15); color: var(--blue); }
.tm-col-header.losers { background: rgba(255,60,60,0.15); color: var(--accent); }
.tm-col-header.grand { background: rgba(245,200,66,0.15); color: var(--gold); }

.tm-round-label {
  font-size: 0.5rem;
  letter-spacing: 0.1em;
  color: var(--text3);
  text-align: center;
  text-transform: uppercase;
}

.tm-match {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 12px;
  transition: border-color 0.2s;
}
.tm-match.has-winner { border-color: var(--green); }
.tm-match-inner { display: flex; flex-direction: column; gap: 4px; margin-bottom: 10px; }

.tm-slot {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  border-radius: 6px;
  background: var(--card2);
  min-height: 30px;
  transition: background 0.2s;
}
.tm-slot.winner { background: rgba(45,204,112,0.15); }
.tm-slot.loser { opacity: 0.4; }
.tm-slot-seed {
  font-size: 0.5rem;
  color: var(--text3);
  font-weight: 700;
  min-width: 14px;
  text-align: center;
}
.tm-slot-name {
  font-size: 0.65rem;
  font-weight: 600;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.tm-score-row {
  display: flex;
  align-items: center;
  gap: 8px;
  justify-content: center;
}
.tm-score {
  width: 44px;
  background: var(--bg);
  border: 1px solid var(--border2);
  border-radius: 6px;
  color: var(--text);
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
  text-align: center;
  padding: 4px;
}
.tm-score:focus { outline: none; border-color: var(--gold); }
.tm-score-vs { font-size: 0.55rem; color: var(--text3); }

/* Seeding */
.tm-seeding {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 20px;
}
.tm-seeding-title {
  font-size: 0.6rem;
  letter-spacing: 0.1em;
  font-weight: 700;
  margin-bottom: 12px;
  color: var(--text2);
}
.tm-seeding-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
@media (max-width: 600px) { .tm-seeding-grid { grid-template-columns: repeat(2, 1fr); } }
.tm-seed-item { display: flex; align-items: center; gap: 8px; }
.tm-seed-num {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
  color: var(--gold);
  min-width: 20px;
}
.tm-seed-input {
  background: var(--bg);
  border: 1px solid var(--border2);
  border-radius: 6px;
  color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 0.65rem;
  padding: 6px 10px;
  width: 100%;
}
.tm-seed-input:focus { outline: none; border-color: var(--gold); }

/* Champion banner */
.tm-champion-banner {
  text-align: center;
  padding: 24px;
  background: rgba(245,200,66,0.05);
  border: 2px solid var(--gold);
  border-radius: 12px;
  margin-bottom: 20px;
  animation: obIn 0.4s ease;
}
.tm-champion-banner.hidden { display: none; }
.tm-champion-crown { font-size: 2.5rem; margin-bottom: 4px; }
.tm-champion-text {
  font-size: 0.6rem;
  letter-spacing: 0.2em;
  color: var(--gold);
  font-weight: 700;
}
.tm-champion-name {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2.5rem;
  letter-spacing: 0.1em;
  color: var(--gold);
}

.tm-btn-row { display: flex; gap: 12px; }
.tm-save-btn {
  flex: 1;
  background: var(--gold);
  border: none;
  border-radius: 8px;
  color: #000;
  font-family: 'DM Mono', monospace;
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  padding: 14px;
  cursor: pointer;
  transition: all 0.2s;
}
.tm-save-btn:hover { background: #f0c030; transform: translateY(-1px); }
.tm-reset-btn {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 8px;
  color: var(--text2);
  font-family: 'DM Mono', monospace;
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  padding: 14px 20px;
  cursor: pointer;
  transition: all 0.2s;
}
.tm-reset-btn:hover { border-color: var(--accent); color: var(--accent); }

/* History */
.tm-history-card {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 12px;
}
.tm-history-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}
.tm-history-week {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
  letter-spacing: 0.1em;
}
.tm-history-champion {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--gold);
}
.tm-history-results {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}
.tm-history-result {
  background: var(--card2);
  border-radius: 6px;
  padding: 6px 10px;
  font-size: 0.6rem;
  color: var(--text2);
}
.tm-empty-history {
  text-align: center;
  padding: 60px 20px;
  color: var(--text3);
  font-size: 0.75rem;
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PILLAR MILESTONE CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pillar-overall-bar-wrap {
  margin: 0 0 16px;
}
.pob-label {
  display: flex;
  justify-content: space-between;
  font-size: 0.55rem;
  letter-spacing: 0.1em;
  color: var(--text2);
  margin-bottom: 5px;
  text-transform: uppercase;
}
.pob-bar {
  height: 6px;
  background: var(--border);
  border-radius: 3px;
  overflow: hidden;
}
.pob-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.6s ease;
}

.pillar-quest-link-banner {
  display: flex;
  align-items: center;
  gap: 10px;
  background: rgba(245,200,66,0.06);
  border: 1px solid rgba(245,200,66,0.2);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 0.62rem;
  color: var(--text2);
  margin-bottom: 18px;
  flex-wrap: wrap;
}
.pqlb-icon { font-size: 1rem; flex-shrink: 0; }
.pillar-quest-link-banner strong { color: var(--gold); }
.pqlb-btn {
  background: rgba(245,200,66,0.1);
  border: 1px solid rgba(245,200,66,0.3);
  color: var(--gold);
  padding: 4px 12px;
  border-radius: 6px;
  font-family: 'DM Mono', monospace;
  font-size: 0.6rem;
  cursor: pointer;
  transition: all 0.2s;
  margin-left: auto;
  white-space: nowrap;
}
.pqlb-btn:hover { background: rgba(245,200,66,0.2); }

.milestones-section-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1rem;
  letter-spacing: 0.2em;
  color: var(--text2);
  margin-bottom: 12px;
}
.milestones-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 10px;
  margin-bottom: 24px;
}
.milestone-card {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 14px 16px;
  position: relative;
  overflow: hidden;
  transition: border-color 0.2s;
}
.milestone-card::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 3px;
  background: var(--mc-color, var(--accent));
  border-radius: 3px 0 0 3px;
}
.milestone-card.complete {
  background: color-mix(in srgb, var(--mc-color, var(--accent)) 6%, var(--card));
  border-color: color-mix(in srgb, var(--mc-color, var(--accent)) 40%, transparent);
}
.mc-header { display: flex; gap: 10px; align-items: flex-start; margin-bottom: 10px; }
.mc-status {
  font-size: 1rem;
  width: 22px;
  height: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  color: var(--mc-color, var(--accent));
  font-weight: 700;
}
.mc-info { flex: 1; }
.mc-name {
  font-size: 0.72rem;
  font-weight: 500;
  color: var(--text);
  margin-bottom: 3px;
  line-height: 1.3;
}
.mc-desc {
  font-size: 0.58rem;
  color: var(--text2);
  line-height: 1.5;
}
.mc-progress-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}
.mc-bar-wrap {
  flex: 1;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  overflow: hidden;
}
.mc-bar-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 0.5s ease;
}
.mc-pct {
  font-size: 0.62rem;
  font-weight: 500;
  min-width: 30px;
  text-align: right;
}
.mc-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  justify-content: space-between;
}
.mc-reps {
  font-size: 0.5rem;
  color: var(--text3);
  letter-spacing: 0.05em;
}
.mc-done-tag {
  font-size: 0.48rem;
  letter-spacing: 0.15em;
  background: var(--mc-color, var(--accent));
  color: #000;
  padding: 1px 8px;
  border-radius: 20px;
  font-weight: 700;
}
.mc-next {
  font-size: 0.5rem;
  color: var(--text3);
  font-style: italic;
}

.firebase-panel { background: var(--card); border: 1px solid rgba(60,141,255,0.2); border-radius: 8px; padding: 18px 20px; }
.firebase-panel h4 { font-family: 'Bebas Neue', sans-serif; font-size: 1rem; letter-spacing: 0.1em; color: var(--blue); margin-bottom: 8px; }
.firebase-panel p { font-size: 0.62rem; color: var(--text2); line-height: 1.7; margin-bottom: 12px; }
.firebase-input {
  background: #090910; border: 1px solid var(--border2); border-radius: 4px;
  color: var(--text); font-family: 'DM Mono', monospace; font-size: 0.62rem;
  padding: 8px 12px; width: 100%; outline: none; margin-bottom: 8px;
  transition: border-color 0.15s;
}
.firebase-input:focus { border-color: rgba(60,141,255,0.4); }
.firebase-connect-btn {
  background: var(--blue-dim); border: 1px solid rgba(60,141,255,0.4);
  color: var(--blue); padding: 8px 16px; cursor: pointer;
  font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 0.1em;
  border-radius: 4px; transition: all 0.15s;
}
.firebase-connect-btn:hover { background: rgba(60,141,255,0.2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP UPGRADES â€” PWA / MOBILE FIRST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Safe area support for notched phones */
:root {
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  --bottom-nav-height: 64px;
}

/* Prevent iOS rubber-band but allow in-app scroll */
/* Desktop: normal scroll on body */
html, body { height: 100%; }
body { overscroll-behavior-x: none; }

/* Mobile only: lock outer scroll, let .main scroll */
@media (max-width: 768px) {
  html { overflow: hidden; height: 100%; height: 100dvh; }
  body { overflow: hidden; height: 100%; height: 100dvh; overscroll-behavior: none; -webkit-overflow-scrolling: touch; }
  #appScreen { overflow: hidden; display: flex !important; flex-direction: column; height: 100dvh; height: 100vh; }
}

/* Page transition animation */
.section { animation: none; }
.section.active { animation: sectionIn 0.22s ease; }
@keyframes sectionIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}


/* â”€â”€ HAMBURGER (mobile only, inside header) â”€â”€ */
.hdr-hamburger {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px;
  flex-direction: column;
  gap: 5px;
  flex-shrink: 0;
}
.hdr-hamburger span {
  display: block;
  width: 22px;
  height: 2px;
  background: var(--text2);
  border-radius: 2px;
  transition: all 0.2s;
}

/* â”€â”€ MOBILE DRAWER â”€â”€ */
#mobileDrawer {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 900;
}
#mobileDrawer.open { display: block; }
.drawer-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(2px);
}
.drawer-panel {
  position: absolute;
  top: 0; left: 0; bottom: 0;
  width: min(85%, 320px);
  background: var(--panel);
  border-right: 1px solid var(--border2);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  transform: translateX(-100%);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  padding-top: calc(var(--safe-top) + 56px);
  padding-bottom: calc(var(--safe-bottom) + 20px);
}
#mobileDrawer.open .drawer-panel { transform: translateX(0); }
.drawer-header {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: calc(var(--safe-top) + 56px);
  padding: calc(var(--safe-top) + 12px) 16px 12px;
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
  background: var(--panel);
}
.drawer-logo {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.4rem;
  letter-spacing: 0.1em;
  color: var(--text);
}
.drawer-logo span { color: var(--accent); }
.drawer-close {
  background: none;
  border: none;
  color: var(--text2);
  font-size: 1.3rem;
  cursor: pointer;
  padding: 4px;
  line-height: 1;
}

/* â”€â”€ BOTTOM TAB BAR â”€â”€ */
#bottomNav {
  display: none;
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: calc(var(--bottom-nav-height) + var(--safe-bottom));
  padding-bottom: var(--safe-bottom);
  background: rgba(10,10,20,0.96);
  border-top: 1px solid var(--border2);
  backdrop-filter: blur(16px) saturate(1.5);
  -webkit-backdrop-filter: blur(16px) saturate(1.5);
  z-index: 400;
  flex-direction: row;
  align-items: stretch;
}
.bn-tab {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  cursor: pointer;
  border: none;
  background: none;
  padding: 8px 4px 4px;
  transition: all 0.15s;
  position: relative;
  -webkit-tap-highlight-color: transparent;
}
.bn-tab .bn-icon { font-size: 1.3rem; line-height: 1; transition: transform 0.15s; }
.bn-tab .bn-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.42rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--text2);
  transition: color 0.15s;
  white-space: nowrap;
}
.bn-tab.active .bn-icon { transform: scale(1.15); }
.bn-tab.active .bn-label { color: var(--accent); }
.bn-tab.active::after {
  content: '';
  position: absolute;
  top: 0; left: 20%; right: 20%;
  height: 2px;
  background: var(--accent);
  border-radius: 0 0 2px 2px;
  box-shadow: 0 0 8px rgba(255,60,60,0.6);
}
.bn-tab:active .bn-icon { transform: scale(0.9); }

/* â”€â”€ RESPONSIVE BREAKPOINTS â”€â”€ */
@media (max-width: 768px) {
  /* Show mobile UI */
  .hdr-hamburger { display: flex; }
  #bottomNav { display: flex; }

  /* Hide desktop sidebar */
  .sidebar { display: none !important; }

  /* Header compact */
  .app-header {
    padding: 8px 12px;
    padding-top: calc(var(--safe-top) + 8px);
    gap: 10px;
    flex-wrap: nowrap;
    position: sticky;
    top: 0;
  }
  .hdr-logo { font-size: 1.2rem; }
  .hdr-block-badge { display: none; }
  .hdr-day-block { padding: 5px 10px; }
  .hdr-day-num { font-size: 1.6rem; }
  .hdr-day-label { font-size: 0.38rem; }
  .hdr-day-date { font-size: 0.5rem; }
  .hdr-streak { display: none; }
  .hdr-xp-block { min-width: 80px; max-width: 140px; }
  .hdr-xp-label { font-size: 0.42rem; }
  .hdr-rank-block { padding: 5px 8px; }
  .hdr-rank-name { font-size: 0.5rem; }
  .hdr-rank-xp { display: none; }

  /* Main content accounts for bottom nav */
  .main {
    padding: 16px;
    padding-bottom: calc(var(--bottom-nav-height) + var(--safe-bottom) + 24px);
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    min-height: 0;
  }
  .app-layout { flex-direction: column; flex: 1; min-height: 0; }

  /* App screen full height on mobile â€” display is handled by existing .visible class */
  #appScreen.visible {
    display: flex !important;
    flex-direction: column;
    height: 100dvh;
    height: 100vh;
  }

  /* Touch-friendly quest cards */
  .qc-header { padding: 14px 14px; }
  .qc-check { width: 26px; height: 26px; }

  /* Onboarding */
  .ob-card { padding: 28px 20px; border-radius: 16px; }
  #onboardScreen { padding: 16px; }

  /* Modals full screen */
  .wm-card, .sj-card, .vod-stat-card, .rm-card {
    width: 100% !important;
    max-width: 100% !important;
    border-radius: 20px 20px 0 0 !important;
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    top: auto !important;
    max-height: 90vh;
    overflow-y: auto;
    padding-bottom: calc(var(--safe-bottom) + 20px) !important;
  }
  #wheelModal, #sessionJournalModal, #vodStatModal, #rankModal, #tournamentModal {
    align-items: flex-end !important;
  }

  /* Grid adjustments */
  .ob-options.cols2 { grid-template-columns: 1fr; }
  .pillar-stats-row { display: none; }
  .tmb-top { flex-direction: column; gap: 10px; }
  .tmb-quote { text-align: left; max-width: 100%; }
}

/* Very small screens */
@media (max-width: 380px) {
  .hdr-xp-block { display: none; }
  .bn-label { display: none; }
  .bn-tab { padding: 12px 4px; }
  .bn-icon { font-size: 1.5rem; }
}

/* Desktop â€” keep sidebar, hide bottom nav */
@media (min-width: 769px) {
  #mobileDrawer { display: none !important; }
  #bottomNav { display: none !important; }
  .hdr-hamburger { display: none !important; }
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MOBILE DRAWER NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mobileDrawer">
  <div class="drawer-backdrop" onclick="closeDrawer()"></div>
  <div class="drawer-panel">
    <div class="drawer-header">
      <div class="drawer-logo">TOP <span>PLAYER</span></div>
      <button class="drawer-close" onclick="closeDrawer()">âœ•</button>
    </div>
    <nav id="drawerNav"></nav>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BOTTOM TAB NAV (mobile)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav id="bottomNav">
  <button class="bn-tab" id="bnToday" onclick="bottomNavClick('today')">
    <span class="bn-icon">ğŸ </span>
    <span class="bn-label">Today</span>
  </button>
  <button class="bn-tab" id="bnQuests" onclick="bottomNavClick('quests')">
    <span class="bn-icon">ğŸ“‹</span>
    <span class="bn-label">Quests</span>
  </button>
  <button class="bn-tab" id="bnProgress" onclick="bottomNavClick('progress')">
    <span class="bn-icon">ğŸ“ˆ</span>
    <span class="bn-label">Progress</span>
  </button>
  <button class="bn-tab" id="bnStats" onclick="bottomNavClick('stats')">
    <span class="bn-icon">ğŸ¯</span>
    <span class="bn-label">Stats</span>
  </button>
  <button class="bn-tab" id="bnMore" onclick="openDrawer()">
    <span class="bn-icon">â˜°</span>
    <span class="bn-label">More</span>
  </button>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ONBOARDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="onboardScreen">
  <div class="ob-card">
    <div class="ob-logo">TOP <span>PLAYER</span> BLUEPRINT</div>
    <div class="ob-subtitle">Smash Ultimate Â· 60-Day System Â· Built for Top Players</div>
    <div class="ob-progress-dots" id="obDots"></div>

    <!-- Step 0: First Day? -->
    <div class="ob-step active" id="step0">
      <div class="ob-q">Welcome</div>
      <p style="font-family:'Crimson Pro',serif;font-style:italic;color:var(--text2);font-size:0.95rem;line-height:1.7;margin-bottom:24px;">
        This isn't a checklist. It's a 60-day system that will make you a top player â€” adaptive, forgiving, and built to challenge you every single day. It keeps your data, tracks your journey, and adjusts when life happens.
      </p>
      <div class="ob-options">
        <div class="ob-opt" onclick="selectFirstDay(true)">
          <span class="em">ğŸ”¥</span>
          <div>
            <strong style="display:block;color:var(--text);font-size:0.78rem;margin-bottom:2px;">Yes â€” today is Day 1</strong>
            <span style="font-size:0.6rem;color:var(--text2);">Start the 60-day journey from today</span>
          </div>
        </div>
        <div class="ob-opt" onclick="selectFirstDay(false)">
          <span class="em">ğŸ“…</span>
          <div>
            <strong style="display:block;color:var(--text);font-size:0.78rem;margin-bottom:2px;">I already started</strong>
            <span style="font-size:0.6rem;color:var(--text2);">Pick the date you began</span>
          </div>
        </div>
      </div>
      <div id="existingDatePicker" style="display:none;margin-top:14px;">
        <input type="date" class="ob-input" id="startDateInput" />
        <button class="ob-btn" onclick="confirmExistingStart()" style="margin-top:14px;">CONTINUE WITH THIS DATE</button>
      </div>
    </div>

    <!-- Step 1: Time Available -->
    <div class="ob-step" id="step1">
      <div class="ob-q">How much time can you train per day?</div>
      <div class="ob-options">
        <div class="ob-opt" onclick="selectOption('timePerDay','30min',this)"><span class="em">â±ï¸</span> 30 minutes â€” tight schedule</div>
        <div class="ob-opt" onclick="selectOption('timePerDay','1hr',this)"><span class="em">â³</span> 1 hour â€” solid commitment</div>
        <div class="ob-opt" onclick="selectOption('timePerDay','2hr',this)"><span class="em">ğŸ”¥</span> 2 hours â€” serious grind</div>
        <div class="ob-opt" onclick="selectOption('timePerDay','3hr+',this)"><span class="em">ğŸ’€</span> 3+ hours â€” no days off</div>
      </div>
      <button class="ob-btn" onclick="nextStep(2)">NEXT</button>
    </div>

    <!-- Step 2: Skill Level -->
    <div class="ob-step" id="step2">
      <div class="ob-q">What's your current level?</div>
      <div class="ob-options">
        <div class="ob-opt" onclick="selectOption('level','beginner',this)"><span class="em">ğŸŒ±</span> Beginner â€” just getting started</div>
        <div class="ob-opt" onclick="selectOption('level','intermediate',this)"><span class="em">ğŸ¯</span> Intermediate â€” consistent top 8 at locals</div>
        <div class="ob-opt" onclick="selectOption('level','advanced',this)"><span class="em">âš¡</span> Advanced â€” I win locals sometimes</div>
        <div class="ob-opt" onclick="selectOption('level','competitive',this)"><span class="em">ğŸ†</span> Competitive â€” I travel to regionals</div>
      </div>
      <button class="ob-btn" onclick="nextStep(3)">NEXT</button>
      <button class="ob-back" onclick="nextStep(1)">â† back</button>
    </div>

    <!-- Step 3: Goal -->
    <div class="ob-step" id="step3">
      <div class="ob-q">What's your main goal for these 60 days?</div>
      <div class="ob-options">
        <div class="ob-opt" onclick="selectOption('goal','locals',this)"><span class="em">ğŸ“</span> Win my local â€” top the bracket</div>
        <div class="ob-opt" onclick="selectOption('goal','regionals',this)"><span class="em">ğŸ—ºï¸</span> Place at regionals â€” be a threat</div>
        <div class="ob-opt" onclick="selectOption('goal','improve',this)"><span class="em">ğŸ“ˆ</span> Just get noticeably better</div>
      </div>
      <button class="ob-btn" onclick="nextStep(4)">NEXT</button>
      <button class="ob-back" onclick="nextStep(2)">â† back</button>
    </div>

    <!-- Step 4: Character + Name -->
    <div class="ob-step" id="step4">
      <div class="ob-q">Who do you play?</div>
      <input type="text" class="ob-input" id="characterInput" placeholder="Character (e.g. Pikachu, ROB, Snake)" style="margin-bottom:14px;" />
      <input type="text" class="ob-input" id="playerNameInput" placeholder="Your tag / name" style="margin-bottom:14px;" />
      <button class="ob-btn" onclick="finishOnboarding()">START MY 60-DAY JOURNEY â†’</button>
      <button class="ob-back" onclick="nextStep(3)">â† back</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="appScreen">
  <header class="app-header">
    <button class="hdr-hamburger" onclick="openDrawer()" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <div class="hdr-brand">
      <div class="hdr-logo">TOP <span>PLAYER</span></div>
      <div class="hdr-block-badge" id="hdrBlockBadge">Block 1 Â· Foundation</div>
    </div>
    <div class="hdr-day-block">
      <div class="hdr-day-num" id="hdrDayNum">1</div>
      <div class="hdr-day-info">
        <div class="hdr-day-label">of 60 Days</div>
        <div class="hdr-day-date" id="hdrDayDate">â€”</div>
      </div>
    </div>
    <div class="hdr-streak" title="Current streak">
      ğŸ”¥ <div class="hdr-streak-num" id="hdrStreak">0</div>
      <div style="font-size:0.48rem;letter-spacing:0.15em;color:var(--text2);text-transform:uppercase;">Day Streak</div>
    </div>
    <div class="hdr-xp-block">
      <div class="hdr-xp-label">
        <span>XP â€” <span id="hdrXpLabel">Recruit</span></span>
        <span id="hdrXpVal">0 XP</span>
      </div>
      <div class="hdr-xp-bar"><div class="hdr-xp-fill" id="hdrXpBar" style="width:0%"></div></div>
    </div>
    <div class="hdr-rank-block" id="hdrRankBadge" onclick="showRankModal()" title="Click to see rank progression">
      <div class="hdr-rank-icon">âš¡</div>
      <div class="hdr-rank-info">
        <div class="hdr-rank-name">RECRUIT</div>
        <div class="hdr-rank-xp">0 XP Â· 0% to next</div>
      </div>
    </div>
  </header>

  <div class="app-layout">
    <nav class="sidebar" id="sidebarNav"></nav>
    <main class="main" id="mainContent"></main>
  </div>
</div>

<!-- Question Wheel Modal -->
<div id="wheelModal" class="hidden">
  <div class="wm-card">
    <div class="wm-title">ğŸ¡ QUESTION WHEEL</div>
    <div class="wm-sub">SPIN FOR YOUR DAILY GROWTH PROMPT Â· +50 XP TO ANSWER</div>
    <div class="wm-wheel-area">
      <canvas id="wheelCanvas" width="200" height="200"></canvas>
      <div class="wm-pointer">â–¼</div>
    </div>
    <div class="wm-xp-tag">Answer honestly for +50 XP</div>
    <div class="wm-question" id="wheelQuestion">Spin the wheel to get your question...</div>
    <textarea class="wm-answer" id="wheelAnswer" placeholder="Type your answer here..."></textarea>
    <div class="wm-btn-row">
      <button class="wm-spin-btn" id="wheelSpinBtn" onclick="spinWheel()">ğŸ² SPIN</button>
      <button class="wm-save-btn" onclick="saveWheelAnswer()">ğŸ’¾ SAVE</button>
    </div>
    <button class="wm-close-btn" onclick="closeWheel()">â† close</button>
  </div>
</div>

<!-- Session Journal Prompt -->
<div id="sessionJournalModal" class="hidden">
  <div class="sj-card">
    <div class="sj-badge">ğŸ““ POST-SESSION CHECK-IN</div>
    <div class="sj-prompt" id="sjPrompt">Day done. Before you close â€” one question.</div>
    <textarea class="sj-textarea" id="sjAnswer" placeholder="Write your answer..."></textarea>
    <div class="sj-btn-row">
      <button class="sj-save" onclick="saveSessionJournal()">âœ“ SAVE & CLOSE</button>
      <button class="sj-skip" onclick="skipSessionJournal()">Skip</button>
    </div>
  </div>
</div>

<!-- VOD STAT TRACKING MODAL -->
<div id="vodStatModal" class="hidden">
  <div class="vod-stat-card">
    <div class="vod-stat-badge">ğŸ“Š VOD STAT ENTRY</div>
    <div class="vod-stat-title">Track Your Performance Metrics</div>
    
    <div class="vod-stat-field">
      <label class="vod-stat-label">Session Name</label>
      <input class="vod-stat-input" id="vodSessionName" placeholder="e.g. Ranked Grind Session 1" />
    </div>
    
    <div class="vod-stat-field">
      <label class="vod-stat-label">Avg Damage Per Opening (%)</label>
      <input type="number" class="vod-stat-input" id="vodAvgDamage" placeholder="e.g. 45" />
      <div class="vod-stat-hint">When you hit them, how much damage do you get?</div>
    </div>
    
    <div class="vod-stat-field">
      <label class="vod-stat-label">Openings Per Stock</label>
      <input type="number" step="0.1" class="vod-stat-input" id="vodOpeningsPerStock" placeholder="e.g. 2.5" />
      <div class="vod-stat-hint">How many clean openings before you take the stock?</div>
    </div>
    
    <div class="vod-stat-field">
      <label class="vod-stat-label">Average Kill Percent (%)</label>
      <input type="number" class="vod-stat-input" id="vodAvgKillPercent" placeholder="e.g. 118" />
      <div class="vod-stat-hint">What % do you usually kill at?</div>
      <div class="vod-stat-calculator">
        <div class="calc-title">Quick Calculator: <span style="color:var(--text3);font-size:0.55rem;">(enter up to 13 kill %s â€” one per stock in a Bo5)</span></div>
        <div class="calc-inputs" id="killPercentInputs">
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
          <input type="number" class="calc-input" placeholder="%" />
        </div>
        <button class="calc-btn" onclick="calculateAvgKillPercent()">Calculate Average</button>
      </div>
    </div>
    
    <div class="vod-stat-field">
      <label class="vod-stat-label">Dropped Combo Rate (%)</label>
      <input type="number" class="vod-stat-input" id="vodDroppedCombo" placeholder="e.g. 15" />
      <div class="vod-stat-hint">Clean openings where you dropped the combo</div>
    </div>
    
    <div class="vod-stat-field">
      <label class="vod-stat-label">Dropped Edgeguard Rate (%)</label>
      <input type="number" class="vod-stat-input" id="vodDroppedEdgeguard" placeholder="e.g. 30" />
      <div class="vod-stat-hint">Times opponent got back to stage/ledge when offstage</div>
    </div>
    
    <div class="vod-stat-field">
      <label class="vod-stat-label">Notes (Optional)</label>
      <textarea class="vod-stat-textarea" id="vodNotes" placeholder="What did you learn? What needs work?"></textarea>
    </div>
    
    <div class="vod-stat-btn-row">
      <button class="vod-stat-save" onclick="saveVODEntry()">ğŸ’¾ SAVE & UPDATE CHARTS</button>
      <button class="vod-stat-cancel" onclick="closeVODStatModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- TOURNAMENT BRACKET MODAL -->
<div id="tournamentModal" class="hidden">
  <div class="tm-card">
    <div class="tm-header">
      <div>
        <div class="tm-badge">âš”ï¸ SQUAD TOURNAMENT</div>
        <div class="tm-title" id="tmTitle">WEEK 1 BRACKET</div>
      </div>
      <button class="tm-close" onclick="closeTournamentModal()">âœ•</button>
    </div>

    <div class="tm-tabs">
      <button class="tm-tab active" onclick="switchTmTab('bracket',this)">BRACKET</button>
      <button class="tm-tab" onclick="switchTmTab('history',this)">HISTORY</button>
    </div>

    <!-- BRACKET TAB -->
    <div id="tmTabBracket">
      <div class="tm-week-nav">
        <button class="tm-week-btn" onclick="changeTmWeek(-1)">â—€</button>
        <div class="tm-week-label" id="tmWeekLabel">Week 1</div>
        <button class="tm-week-btn" onclick="changeTmWeek(1)">â–¶</button>
      </div>

      <div class="tm-bracket-grid">
        <!-- WINNERS SIDE -->
        <div class="tm-column">
          <div class="tm-col-header winners">WINNERS</div>
          <div class="tm-round-label">Semifinals</div>
          <div class="tm-match" id="tm-wSF1">
            <div class="tm-match-inner">
              <div class="tm-slot" id="slot-wSF1-p1"><span class="tm-slot-seed">1</span><span class="tm-slot-name">â€”</span></div>
              <div class="tm-slot" id="slot-wSF1-p2"><span class="tm-slot-seed">4</span><span class="tm-slot-name">â€”</span></div>
            </div>
            <div class="tm-score-row">
              <input type="number" class="tm-score" id="score-wSF1-p1" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
              <span class="tm-score-vs">vs</span>
              <input type="number" class="tm-score" id="score-wSF1-p2" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
            </div>
          </div>
          <div class="tm-match" id="tm-wSF2">
            <div class="tm-match-inner">
              <div class="tm-slot" id="slot-wSF2-p1"><span class="tm-slot-seed">2</span><span class="tm-slot-name">â€”</span></div>
              <div class="tm-slot" id="slot-wSF2-p2"><span class="tm-slot-seed">3</span><span class="tm-slot-name">â€”</span></div>
            </div>
            <div class="tm-score-row">
              <input type="number" class="tm-score" id="score-wSF2-p1" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
              <span class="tm-score-vs">vs</span>
              <input type="number" class="tm-score" id="score-wSF2-p2" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
            </div>
          </div>
        </div>

        <div class="tm-column">
          <div class="tm-col-header winners">WINNERS</div>
          <div class="tm-round-label">Finals</div>
          <div class="tm-match" id="tm-wF">
            <div class="tm-match-inner">
              <div class="tm-slot" id="slot-wF-p1"><span class="tm-slot-seed"></span><span class="tm-slot-name">TBD</span></div>
              <div class="tm-slot" id="slot-wF-p2"><span class="tm-slot-seed"></span><span class="tm-slot-name">TBD</span></div>
            </div>
            <div class="tm-score-row">
              <input type="number" class="tm-score" id="score-wF-p1" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
              <span class="tm-score-vs">vs</span>
              <input type="number" class="tm-score" id="score-wF-p2" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
            </div>
          </div>
        </div>

        <!-- LOSERS SIDE -->
        <div class="tm-column">
          <div class="tm-col-header losers">LOSERS</div>
          <div class="tm-round-label">Round 1</div>
          <div class="tm-match" id="tm-lR1">
            <div class="tm-match-inner">
              <div class="tm-slot" id="slot-lR1-p1"><span class="tm-slot-seed"></span><span class="tm-slot-name">TBD</span></div>
              <div class="tm-slot" id="slot-lR1-p2"><span class="tm-slot-seed"></span><span class="tm-slot-name">TBD</span></div>
            </div>
            <div class="tm-score-row">
              <input type="number" class="tm-score" id="score-lR1-p1" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
              <span class="tm-score-vs">vs</span>
              <input type="number" class="tm-score" id="score-lR1-p2" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
            </div>
          </div>
        </div>

        <div class="tm-column">
          <div class="tm-col-header losers">LOSERS</div>
          <div class="tm-round-label">Finals</div>
          <div class="tm-match" id="tm-lF">
            <div class="tm-match-inner">
              <div class="tm-slot" id="slot-lF-p1"><span class="tm-slot-seed"></span><span class="tm-slot-name">TBD</span></div>
              <div class="tm-slot" id="slot-lF-p2"><span class="tm-slot-seed"></span><span class="tm-slot-name">TBD</span></div>
            </div>
            <div class="tm-score-row">
              <input type="number" class="tm-score" id="score-lF-p1" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
              <span class="tm-score-vs">vs</span>
              <input type="number" class="tm-score" id="score-lF-p2" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
            </div>
          </div>
        </div>

        <!-- GRAND FINALS -->
        <div class="tm-column">
          <div class="tm-col-header grand">GRAND FINALS</div>
          <div class="tm-round-label">Grand Finals</div>
          <div class="tm-match" id="tm-gF">
            <div class="tm-match-inner">
              <div class="tm-slot" id="slot-gF-p1"><span class="tm-slot-seed">W</span><span class="tm-slot-name">TBD</span></div>
              <div class="tm-slot" id="slot-gF-p2"><span class="tm-slot-seed">L</span><span class="tm-slot-name">TBD</span></div>
            </div>
            <div class="tm-score-row">
              <input type="number" class="tm-score" id="score-gF-p1" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
              <span class="tm-score-vs">vs</span>
              <input type="number" class="tm-score" id="score-gF-p2" min="0" max="3" placeholder="0" onchange="updateBracket()"/>
            </div>
          </div>
        </div>
      </div>

      <!-- Player Seeding Setup -->
      <div class="tm-seeding">
        <div class="tm-seeding-title">âš™ï¸ PLAYER SEEDING</div>
        <div class="tm-seeding-grid">
          <div class="tm-seed-item">
            <span class="tm-seed-num">1</span>
            <input class="tm-seed-input" id="seed1" placeholder="Player name" value="Benny" onchange="updateBracket()"/>
          </div>
          <div class="tm-seed-item">
            <span class="tm-seed-num">2</span>
            <input class="tm-seed-input" id="seed2" placeholder="Player name" value="Dom" onchange="updateBracket()"/>
          </div>
          <div class="tm-seed-item">
            <span class="tm-seed-num">3</span>
            <input class="tm-seed-input" id="seed3" placeholder="Player name" value="Peter" onchange="updateBracket()"/>
          </div>
          <div class="tm-seed-item">
            <span class="tm-seed-num">4</span>
            <input class="tm-seed-input" id="seed4" placeholder="Player name" value="Evan" onchange="updateBracket()"/>
          </div>
        </div>
      </div>

      <!-- Champion display -->
      <div class="tm-champion-banner hidden" id="tmChampionBanner">
        <div class="tm-champion-crown">ğŸ‘‘</div>
        <div class="tm-champion-text">CHAMPION</div>
        <div class="tm-champion-name" id="tmChampionName"></div>
      </div>

      <div class="tm-btn-row">
        <button class="tm-save-btn" onclick="saveTournamentBracket()">ğŸ’¾ SAVE BRACKET</button>
        <button class="tm-reset-btn" onclick="resetTournamentBracket()">â†º RESET</button>
      </div>
    </div>

    <!-- HISTORY TAB -->
    <div id="tmTabHistory" class="hidden">
      <div id="tmHistoryContent"></div>
    </div>
  </div>
</div>

<!-- TOAST & CELEBRATION -->
<canvas id="particleCanvas" style="position:fixed;inset:0;pointer-events:none;z-index:9997;"></canvas>

<!-- Daily Challenge Modal -->
<div id="dailyChallengeModal" style="position:fixed;inset:0;z-index:8000;background:rgba(0,0,0,0.9);align-items:center;justify-content:center;padding:24px;backdrop-filter:blur(4px);" class="hidden">
  <div class="dc-card">
    <div class="dc-badge">âš”ï¸ Daily Challenge</div>
    <div class="dc-icon" id="dcIcon">ğŸ¯</div>
    <div class="dc-title" id="dcTitle">CHALLENGE UNLOCKED</div>
    <div class="dc-challenge" id="dcChallenge"></div>
    <div class="dc-xp-reward" id="dcXpReward">+250 BONUS XP</div>
    <div class="dc-btn-row">
      <button class="dc-accept" onclick="acceptChallenge()">âš¡ ACCEPT CHALLENGE</button>
      <button class="dc-skip" onclick="skipChallenge()">Skip today</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<div id="celebrationOverlay" onclick="hideCelebration()">
  <div class="celebration-card" onclick="event.stopPropagation()">
    <div class="cel-icon" id="celIcon">ğŸ‰</div>
    <h2 id="celTitle">SESSION COMPLETE</h2>
    <p id="celMsg">Another day of work. Another step closer.</p>
    <div class="xp-gained" id="celXp">+0 XP</div>
    <button class="celebration-close" onclick="hideCelebration()">KEEP GRINDING</button>
  </div>
</div>

<!-- Rank Modal -->
<div id="rankModal" class="hidden">
  <div class="rank-modal-card">
    <div class="rank-modal-title">ğŸ† RANK PROGRESSION</div>
    <div class="rank-modal-sub">Complete quests, earn XP, climb the ladder. Every rep counts.</div>
    <div class="rank-ladder" id="rankLadderContent"></div>
    <button class="rank-modal-close" onclick="closeRankModal()">â† CLOSE</button>
  </div>
</div>

<!-- Pre-Match Modal -->
<div id="preMatchModal" class="hidden">
  <div class="pm-card">
    <div class="pm-badge">âš¡ Match Session</div>
    <div class="pm-title">BEFORE YOUR MATCHES</div>
    <div class="pm-field">
      <label class="pm-label">Who are you playing?</label>
      <input class="pm-input" id="pmOpponent" placeholder="Player tag, character, or 'locals/online'" />
    </div>
    <div class="pm-field">
      <label class="pm-label">How long do you have?</label>
      <div class="pm-time-options" id="pmTimeOptions">
        <div class="pm-time-opt" onclick="selectMatchTime('30m',this)">30 min</div>
        <div class="pm-time-opt" onclick="selectMatchTime('1h',this)">1 hour</div>
        <div class="pm-time-opt" onclick="selectMatchTime('2h',this)">2 hours</div>
        <div class="pm-time-opt" onclick="selectMatchTime('3h+',this)">3h+</div>
      </div>
    </div>
    <div class="pm-field">
      <label class="pm-label">What's your focus going into this session?</label>
      <input class="pm-input" id="pmFocus" placeholder="e.g. Work on ledgetrapping, neutral patience, no panic moves..." />
    </div>
    <button class="pm-start-btn" onclick="startMatchSession()">âš¡ START SESSION</button>
    <button class="pm-cancel" onclick="closePreMatchModal()">Cancel</button>
  </div>
</div>

<!-- Active Session Panel -->
<div id="activeSessionPanel" class="hidden">
  <div class="asp-inner">
    <div class="asp-header">
      <div class="asp-timer-block">
        <div>
          <div class="asp-timer-display" id="aspTimerDisplay">00:00</div>
          <div class="asp-timer-label">Session Time</div>
        </div>
      </div>
      <div class="asp-session-meta">
        <div class="asp-session-vs" id="aspVs">â€”</div>
        <div class="asp-session-focus" id="aspFocus">â€”</div>
      </div>
      <button class="asp-end-btn" onclick="endMatchSession()">â¹ END SESSION</button>
    </div>

    <div class="asp-notes-grid">
      <div class="asp-note-section">
        <div class="asp-note-section-title"><span class="nt-dot" style="background:#ff3c3c"></span>What's Working Against Me</div>
        <textarea class="asp-note-textarea" id="aspNoteVulnerabilities" placeholder="What patterns are they exploiting? What habits am I showing?"></textarea>
      </div>
      <div class="asp-note-section">
        <div class="asp-note-section-title"><span class="nt-dot" style="background:#3c8dff"></span>Neutral Observations</div>
        <textarea class="asp-note-textarea" id="aspNoteNeutral" placeholder="What's working in neutral? What spacing, timing, or reads are landing?"></textarea>
      </div>
      <div class="asp-note-section">
        <div class="asp-note-section-title"><span class="nt-dot" style="background:#2dcc70"></span>Tech & Execution</div>
        <textarea class="asp-note-textarea" id="aspNoteTech" placeholder="What tech am I landing clean? What am I dropping under pressure?"></textarea>
      </div>
      <div class="asp-note-section">
        <div class="asp-note-section-title"><span class="nt-dot" style="background:#f5c842"></span>Mental & Composure</div>
        <textarea class="asp-note-textarea" id="aspNoteMental" placeholder="When did I tilt? When was I locked in? What set me off?"></textarea>
      </div>
      <div class="asp-note-section">
        <div class="asp-note-section-title"><span class="nt-dot" style="background:#a855f7"></span>Matchup Notes</div>
        <textarea class="asp-note-textarea" id="aspNoteMatchup" placeholder="What did I learn about this matchup or this player specifically?"></textarea>
      </div>
      <div class="asp-note-section">
        <div class="asp-note-section-title"><span class="nt-dot" style="background:#ff8c00"></span>Mid-Session Adjustments</div>
        <textarea class="asp-note-textarea" id="aspNoteAdjustments" placeholder="What did I change mid-set? Did it work? What should I try next?"></textarea>
      </div>
    </div>
  </div>
</div>

<!-- Post Session Modal -->
<div id="postSessionModal" class="hidden">
  <div class="pst-card">
    <div class="pst-badge">âœ“ Session Complete</div>
    <div class="pst-title">HOW DID IT GO?</div>
    <div class="pst-duration" id="pstDuration">Duration: â€”</div>
    <div class="pst-field">
      <label class="pst-label">Biggest Key Takeaway</label>
      <input class="pst-input" id="pstTakeaway" placeholder="The one thing you'll remember from this session..." />
    </div>
    <div class="pst-field">
      <label class="pst-label">What to Work on Next Time</label>
      <input class="pst-input" id="pstWorkOn" placeholder="Be specific â€” what drill, habit, or concept?" />
    </div>
    <div class="pst-field">
      <label class="pst-label">Rate the Session</label>
      <div class="pst-rating-row" id="pstRatingRow">
        <button class="pst-rating-btn" onclick="selectSessionRating(1,this)">1</button>
        <button class="pst-rating-btn" onclick="selectSessionRating(2,this)">2</button>
        <button class="pst-rating-btn" onclick="selectSessionRating(3,this)">3</button>
        <button class="pst-rating-btn" onclick="selectSessionRating(4,this)">4</button>
        <button class="pst-rating-btn" onclick="selectSessionRating(5,this)">5</button>
        <button class="pst-rating-btn" onclick="selectSessionRating(6,this)">6</button>
        <button class="pst-rating-btn" onclick="selectSessionRating(7,this)">7</button>
        <button class="pst-rating-btn" onclick="selectSessionRating(8,this)">8</button>
        <button class="pst-rating-btn" onclick="selectSessionRating(9,this)">9</button>
        <button class="pst-rating-btn" onclick="selectSessionRating(10,this)">10</button>
      </div>
    </div>
    <button class="pst-save-btn" onclick="saveMatchSession()">âœ“ SAVE SESSION</button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STORAGE_KEY = 'tpbq_v4';

function defaultState() {
  return {
    startDate: null,
    profile: { name: 'Player', character: '?', timePerDay: '1hr', level: 'intermediate', goal: 'improve' },
    xp: 0,
    streak: 0,
    lastLogin: null,
    dayCompletions: {},   // { dayNum: true/false }
    milestoneReps: {},    // { milestoneId: repCount } â€” core link between quests and pillars
    checks: {},           // atom task check UIDs
    counts: {},           // atom rep counts
    journalByDay: {},     // day -> pillarId -> promptIndex -> bool
    journalAnswers: {},   // day -> pillarId -> promptIndex -> string
    matchupCards: [],
    localPlayers: [],
    milestones: [],
    statLogs: [],
    scenarios: [],
    vodReviews: [],
    vodEntries: [],  // NEW: VOD stat tracking with metrics
    weeklyTournaments: {},  // NEW: Tournament bracket history {week1: {complete, champion, matches}, ...}
    weeklyCheckins: {},   // week -> answers
    squadCode: null,
    firebaseConfig: null,
    matchSessions: [],
  };
}

let state = (() => {
  try { const s = localStorage.getItem(STORAGE_KEY); return s ? { ...defaultState(), ...JSON.parse(s) } : defaultState(); }
  catch { return defaultState(); }
})();

function saveState() {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATE / DAY LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parseLocalDate(dateStr) {
  // Parse YYYY-MM-DD as LOCAL midnight, not UTC midnight
  const [y, m, d] = dateStr.split('-').map(Number);
  return new Date(y, m - 1, d);
}

function getActualCurrentDay() {
  if (!state.startDate) return 1;
  const start = parseLocalDate(state.startDate);
  const now = new Date();
  // Compare calendar dates, not raw ms, so time-of-day doesn't matter
  const startMidnight = new Date(start.getFullYear(), start.getMonth(), start.getDate());
  const todayMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const diff = Math.round((todayMidnight - startMidnight) / (1000 * 60 * 60 * 24));
  return Math.min(60, Math.max(1, diff + 1));
}

function getDayDate(day) {
  if (!state.startDate) return 'â€”';
  const d = parseLocalDate(state.startDate);
  d.setDate(d.getDate() + (day - 1));
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}

let currentDay = 1;

function updateStreak() {
  const today = new Date().toDateString();
  if (state.lastLogin === today) return;
  const yesterday = new Date(); yesterday.setDate(yesterday.getDate()-1);
  if (state.lastLogin === yesterday.toDateString()) {
    state.streak = (state.streak || 0) + 1;
  } else if (state.lastLogin && state.lastLogin !== today) {
    // Check if they missed more than 1 day
    const last = new Date(state.lastLogin);
    const diff = Math.floor((new Date() - last) / (1000 * 60 * 60 * 24));
    if (diff > 2) state.streak = 1;
    else state.streak = (state.streak || 0) + 1; // 1-day grace
  } else {
    state.streak = 1;
  }
  state.lastLogin = today;
  saveState();
}

function getMissedDays() {
  const actual = getActualCurrentDay();
  let completed = 0;
  for (let d = 1; d < actual; d++) { if (state.dayCompletions[d]) completed++; }
  return (actual - 1) - completed;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BLOCKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BLOCKS = [
  { days: [1,14],  label: 'Block 1 Â· Days 1â€“14', badgeLabel: 'Block 1 Â· Foundation', cls: 'b1', name: 'Foundation',
    focus: 'Correction-heavy. Lock in your tech, movement, and neutral fundamentals before you drill anything. Identify every flaw first.',
    ratios: [['correction', '#ff3c3c', '50%'], ['drilling', '#3c8dff', '30%'], ['matchplay', '#2dcc70', '20%']] },
  { days: [15,28], label: 'Block 2 Â· Days 15â€“28', badgeLabel: 'Block 2 Â· Drilling', cls: 'b2', name: 'Drilling',
    focus: 'Drilling-heavy. You found the gaps â€” now burn in correct patterns. Combo routes, matchup reads, ledge traps.',
    ratios: [['drilling', '#3c8dff', '50%'], ['correction', '#ff3c3c', '25%'], ['matchplay', '#2dcc70', '25%']] },
  { days: [29,42], label: 'Block 3 Â· Days 29â€“42', badgeLabel: 'Block 3 Â· Match Play', cls: 'b3', name: 'Match Play',
    focus: 'Match play focus. Apply everything under real pressure. Scenario training, set play, bracket simulation.',
    ratios: [['matchplay', '#2dcc70', '50%'], ['correction', '#ff3c3c', '25%'], ['drilling', '#3c8dff', '25%']] },
  { days: [43,60], label: 'Block 4 Â· Days 43â€“60', badgeLabel: 'Block 4 Â· Integration', cls: 'b4', name: 'Integration',
    focus: 'Full integration. Correction from footage, drilling weak spots, competitive reps. Polish the complete game.',
    ratios: [['correction', '#ff3c3c', '40%'], ['drilling', '#3c8dff', '30%'], ['matchplay', '#2dcc70', '30%']] },
];

function getBlock(day) {
  return BLOCKS.find(b => day >= b.days[0] && day <= b.days[1]) || BLOCKS[3];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DAILY QUOTES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const QUOTES = [
  "Every rep is a vote for who you're becoming.",
  "Champions are built in the sessions nobody sees.",
  "You don't rise to the occasion. You fall to your training.",
  "The gap between you and top player is just logged hours.",
  "Stop waiting to feel ready. Start, then get ready.",
  "What you do when nobody's watching is who you are.",
  "Your worst session still beats your best excuse.",
  "Comfort is the enemy. Discomfort is the curriculum.",
  "Small improvements compound into identity shifts.",
  "You're one correction away from a breakthrough.",
  "Every mistake is just data. Collect it.",
  "Losing teaches more than winning ever could.",
  "You don't need motivation. You need a system.",
  "Correction is not failure. It's the whole point.",
  "Every day you don't quit is progress.",
  "Trust the reps. The reads will follow.",
  "One focused hour beats five distracted ones.",
  "Every top player was once exactly where you are.",
  "Precision beats force. Timing beats speed.",
  "Show up with intention. Leave with data.",
  "Winners solve problems. Others just feel them.",
  "The grind is the game.",
  "Honest self-assessment is the rarest skill in the room.",
  "The work compounds. Keep going.",
  "Play to improve, not to win. The wins will catch up.",
  "The player you want to be is watching the player you are right now.",
  "Sixty days. Full send.",
  "Your ceiling is higher than you think. You just haven't tested it yet.",
  "See the pattern. Break the habit. Build the skill.",
  "Day 60 starts with what you do on Day 1.",
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PILLAR MILESTONES â€” Clean architecture
// Each pillar has 6-8 milestones. Each milestone has:
//   id, name, desc, totalReps (how many quest completions to finish it), color
// Completing quests directly adds reps to the linked milestone.
// If you complete all quests over 60 days, every milestone hits 100%.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PILLARS = [
  {
    id: 'tech',
    icon: 'âš™ï¸',
    name: 'Technical Execution',
    color: '#ff3c3c',
    desc: 'The foundation. Top players execute these motions unconsciously under maximum pressure. This is drilled before everything else.',
    milestones: [
      { id: 'tech_platform', name: 'Platform Movement Mastered', desc: 'Platform cancel, drop, aerial, full/short hop fast fall â€” executed clean under pressure.', total: 3 },
      { id: 'tech_dash', name: 'Dash & Directional Options Locked', desc: 'Perfect dashâ†’tilt, RAR, turnaround smash â€” consistent without thinking.', total: 3 },
      { id: 'tech_shield', name: 'Shield & OOS Options Drilled', desc: 'OOS grab, OOS aerial, parry â€” fastest option always selected correctly.', total: 2 },
      { id: 'tech_charmech', name: 'Character Mechanics Understood', desc: 'Unique mechanics researched, primary mechanic drilled, applied under CPU pressure.', total: 3 },
      { id: 'tech_combos', name: 'BnB Combos Consistent', desc: 'Starterâ†’ender routes, anti-air confirms, juggle extensions, kill confirms â€” landing 90%+ in sets.', total: 8 },
      { id: 'tech_pressure', name: 'Execution Under Pressure', desc: 'Perfect combos under recording, final-stock drills, stress-test sessions passed.', total: 4 },
    ]
  },
  {
    id: 'neutral',
    icon: 'âš”ï¸',
    name: 'Neutral Game',
    color: '#ff6b3c',
    desc: 'Winning interactions before a hit lands. The mental chess that separates good from great. ROI #2 â€” this is where most stocks are decided.',
    milestones: [
      { id: 'neut_spacing', name: 'Spacing & Poke Range Mastered', desc: 'Max-range safe poke identified and drilled, bait-whiff-punish consistent.', total: 4 },
      { id: 'neut_aerial', name: 'Aerial Spacing Controlled', desc: 'Fade-back aerials, full hop spacing, double jump usage â€” staying safe at max range.', total: 2 },
      { id: 'neut_condition', name: 'Conditioning & Mixups Applied', desc: '3+ habit patterns identified and consciously broken, 2 hard reads per session logged.', total: 5 },
      { id: 'neut_options', name: 'Option Coverage Consistent', desc: 'Answer to grounded approach, both roll punishes, anti-air response â€” automatic.', total: 2 },
      { id: 'neut_film', name: 'Film Review Protocol Done', desc: 'Regular footage review with written neutral analysis â€” patterns identified and drilled.', total: 4 },
    ]
  },
  {
    id: 'mental',
    icon: 'ğŸ§ ',
    name: 'Mental Game',
    color: '#f5c842',
    desc: 'Your ceiling is your mental ceiling. Tilt costs more stocks than tech errors. This is trained like any other skill.',
    milestones: [
      { id: 'ment_tilt', name: 'Tilt Management Protocol Built', desc: 'Personal tilt triggers mapped, reset routine defined and practiced mid-session.', total: 5 },
      { id: 'ment_focus', name: 'Focus & Pre-Session Routine', desc: 'Warm-up ritual established, session focus set before every practice, graded after.', total: 5 },
      { id: 'ment_identity', name: 'Player Identity Defined', desc: 'Identity statements written, process-over-outcome mindset applied in real sets.', total: 4 },
      { id: 'ment_tourney', name: 'Tournament Mental Readiness', desc: 'Tournament simulation sessions done, post-bracket reviews written honestly.', total: 5 },
      { id: 'ment_journal', name: 'Session Journaling Consistent', desc: 'Post-session answers logged regularly â€” patterns noticed, mindset tracked over time.', total: 7 },
    ]
  },
  {
    id: 'advantage',
    icon: 'ğŸ”¥',
    name: 'Advantage State',
    color: '#2dcc70',
    desc: 'You have the hit â€” convert it into a stock. Top players waste zero advantage state. Every opening must count.',
    milestones: [
      { id: 'adv_combos', name: 'Combo Tree Mapped & Drilled', desc: 'Full combo routes from grab on all local-scene weights, jab extensions drilled.', total: 4 },
      { id: 'adv_juggle', name: 'Juggle & Air Follow-ups Consistent', desc: 'Up-air strings, DI chasing, kill confirms at correct % â€” applied in real sets.', total: 3 },
      { id: 'adv_ledge', name: 'Ledge Trap Flowchart Executed', desc: 'Punishing all ledge options, correct position held, adapting to opponent patterns.', total: 3 },
      { id: 'adv_kills', name: 'Kill Confirm Routes Locked', desc: 'Kill percents known for all moves vs local characters, confirm routes drilled to muscle memory.', total: 2 },
      { id: 'adv_review', name: 'Dropped Conversions Corrected', desc: 'Every dropped combo logged post-session, root cause identified, drill built and completed.', total: 4 },
    ]
  },
  {
    id: 'disadvantage',
    icon: 'ğŸ›¡ï¸',
    name: 'Disadvantage State',
    color: '#3c8dff',
    desc: 'The skill that separates intermediate from advanced. Surviving disadvantage state consistently is what top players do that others don\'t.',
    milestones: [
      { id: 'dis_escape', name: 'Escape Options Drilled', desc: 'All getup options practiced, survival DI mapped per character, ledge options consistent.', total: 2 },
      { id: 'dis_reads', name: 'Disadvantage Pattern Reads', desc: 'Opponent\'s chase patterns identified, escape timings adapted to their habits.', total: 3 },
      { id: 'dis_ledge', name: 'Ledge Options Consistent', desc: 'Ledge option mixing, two-frame awareness, ledge trap escape routes drilled.', total: 2 },
      { id: 'dis_film', name: 'Disadvantage Footage Reviewed', desc: 'Disadvantage sequences watched, damage taken mapped, avoidable damage identified.', total: 2 },
    ]
  },
  {
    id: 'matchups',
    icon: 'ğŸ—‚ï¸',
    name: 'Matchup Mastery',
    color: '#a855f7',
    desc: 'Every character in your local scene has a pattern. Know all of them before they walk up to you in bracket.',
    milestones: [
      { id: 'mu_cards', name: 'Matchup Cards Built', desc: 'One card per local character â€” their win condition, your win condition, game plan written.', total: 6 },
      { id: 'mu_research', name: 'Top-Level Footage Reviewed', desc: 'Watched high-level sets in priority matchups, 1 note per watch logged.', total: 3 },
      { id: 'mu_drilling', name: 'Matchup-Specific Drills Done', desc: 'Hardest matchup scenarios drilled in training mode, CPU simulation sessions completed.', total: 6 },
      { id: 'mu_update', name: 'Cards Updated After Sets', desc: 'Matchup notes updated after every tournament or session vs that character.', total: 6 },
    ]
  },
  {
    id: 'competitive',
    icon: 'ğŸ†',
    name: 'Competitive Play',
    color: '#ff8c00',
    desc: 'Real sets, real pressure, real data. Locals, online grind, bracket simulation â€” the feedback loop that closes every gap.',
    milestones: [
      { id: 'comp_prep', name: 'Pre-Bracket Protocol Consistent', desc: 'Focus set before every bracket, matchup card reviewed, training mode warmup done.', total: 6 },
      { id: 'comp_review', name: 'Post-Bracket Reviews Written', desc: 'Specific losing interaction logged, drill identified, mental composure rated after every event.', total: 6 },
      { id: 'comp_boss', name: 'Boss Battle Sessions Completed', desc: 'Weekly Bo5 sets vs best training partner â€” full tournament rules, no mercy.', total: 7 },
      { id: 'comp_grind', name: 'Online Grind Sessions Logged', desc: 'Focused online sessions with clear objectives, not mindless queuing.', total: 9 },
      { id: 'comp_bracket', name: 'Bracket Simulation Reps Done', desc: 'Tournament-rules practice sets, no resets, emotional state noted.', total: 4 },
      { id: 'comp_vod', name: 'VOD Analysis & Stat Tracking', desc: 'Regular stat tracking sessions â€” avg damage, openings per stock, kill%, dropped combos/edgeguards logged.', total: 20 },
    ]
  },
  {
    id: 'physical',
    icon: 'ğŸ’ª',
    name: 'Physical Foundation',
    color: '#2dcc70',
    desc: 'Dehydration costs stocks. Sleep debt costs reads. The physical habits that keep your edge sharp across a 60-day grind.',
    milestones: [
      { id: 'phys_hydration', name: 'Pre-Session Hydration Habit', desc: '500ml water before every session â€” logged until it\'s automatic.', total: 7 },
      { id: 'phys_hands', name: 'Hand Care Routine Built', desc: 'Finger stretches before every session, hand health maintained throughout grind.', total: 6 },
      { id: 'phys_sleep', name: 'Sleep Audit Completed', desc: '7+ hours tracked, correlation with performance noted, sleep quality improved.', total: 6 },
      { id: 'phys_focus', name: 'Focus Quality Tracked', desc: 'Session focus rated 1-10 consistently, patterns between physical habits and performance identified.', total: 6 },
      { id: 'phys_cardio', name: 'Aerobic Base Built', desc: '30 minutes of Zone 2 cardio, twice per week â€” sustaining the cognitive endurance that keeps decision quality high in Hour 6 of a tournament.', total: 16 },
    ]
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FULL 60-DAY QUEST SCHEDULE
// Every quest maps to a pillar milestone ID.
// Completing the quest adds exactly 1 rep to that milestone.
// The schedule is designed so all milestones hit 100% by Day 60.
// ROI order: Tech & Neutral first, then Mental & Competitive,
//            then Advantage & Disadvantage, then Matchups last.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const QUEST_SCHEDULE = {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BLOCK 1: FOUNDATION (Days 1â€“14)
  // Week 1 Theme: MOVEMENT & NEUTRAL FUNDAMENTALS
  // Week 2 Theme: CONVERSION & EXECUTION UNDER PRESSURE
  // Every drill quest has a pass condition. Sessions are 45â€“60 min minimum.
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // â”€â”€ WEEK 1: Movement & Neutral Fundamentals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1: [
    { id:'d1q1', pillar:'tech', milestone:'tech_platform', priority:'core', title:'Platform Movement Drill', time:30, xp:80, instructions:'Week 1 theme: Movement & Neutral. Your foundation starts here. In training mode: platform cancel into aerial (40 reps), platform drop (40 reps), full hopâ†’fast fall (40 reps). Count every miss. PASS: Complete all 3 sequences with fewer than 10 misses total. If you don\'t pass in 30 min, keep going until you do â€” that\'s the point. Log your miss count.' },
    { id:'d1q2', pillar:'mental', milestone:'ment_focus', priority:'core', title:'Set Your Session Focus', time:5, xp:40, instructions:'Before you touch a controller: write ONE specific thing you are working on today â€” not "improve," something like "I will not dash attack on reaction to rolls." At session end, grade yourself 1â€“10 on executing it. This is not optional. The grade is your data.' },
    { id:'d1q3', pillar:'physical', milestone:'phys_hydration', priority:'recommended', title:'Pre-Session Hydration', time:2, xp:20, instructions:'500ml of water before your session. Log it. Goal: automatic by Day 7.' },
  ],
  2: [
    { id:'d2q1', pillar:'tech', milestone:'tech_dash', priority:'core', title:'Dash & Directional Drills', time:35, xp:80, instructions:'Week 1 theme: Movement & Neutral. Drill: perfect dashâ†’tilt (40 reps), RAR â€” dash, jump, reverse mid-air (40 reps). These should feel awkward today. PASS: Hit 30/40 clean on each. If you miss pass on either, add 20 reps to that movement before you stop. Log your clean rate on both.' },
    { id:'d2q2', pillar:'neutral', milestone:'neut_spacing', priority:'core', title:'Identify & Drill Your Max-Range Poke', time:20, xp:60, instructions:'First: name the move that is safe at max range for your character. Then drill it at tip range â€” land it, retreat, no punish (50 reps). PASS: 45/50 with no punish received. If CPU punishes you, that rep doesn\'t count. Stay until you pass.' },
    { id:'d2q3', pillar:'physical', milestone:'phys_hands', priority:'recommended', title:'Hand Stretch Routine', time:3, xp:20, instructions:'Finger stretches (5s Ã— 5), wrist rolls (10 each direction), squeeze and release (10 reps). Do this before every single session â€” injury prevention starts Day 1.' },
  ],
  3: [
    { id:'d3q1', pillar:'tech', milestone:'tech_shield', priority:'core', title:'Shield & OOS Drills', time:35, xp:80, instructions:'Week 1 theme: Movement & Neutral. Drill OOS grab (40 reps â€” timing is everything), OOS jump aerial (40 reps, both full and short hop). PASS: 35/40 clean on OOS grab, 32/40 clean on OOS aerial. Log your clean rates. If you don\'t hit pass threshold, identify what specifically is going wrong and drill that specific part 20 more reps.' },
    { id:'d3q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 1 â€” Establish Your Baseline', time:20, xp:100, instructions:'First VOD session. Record a session and watch it back with one goal: find your MOST REPEATED mistake â€” not your worst, your most frequent. Log it in the VOD tool. This is your baseline. Every future review measures against today.' },
    { id:'d3q3', pillar:'physical', milestone:'phys_sleep', priority:'recommended', title:'Sleep Audit â€” Day 1', time:3, xp:20, instructions:'Log hours slept and rate your focus today 1â€“10. Do this every day. The correlation between sleep and performance is the data you need.' },
  ],
  4: [
    { id:'d4q1', pillar:'tech', milestone:'tech_charmech', priority:'core', title:'Character Mechanics Deep Dive', time:25, xp:70, instructions:'Week 1 theme: Movement & Neutral. Research your character\'s unique mechanics â€” frame data, special movement properties, anything your character can do that others can\'t. Write a numbered list. PASS: Name at least 5 distinct character-specific mechanics you can describe in one sentence each. If you\'re below 5, keep researching.' },
    { id:'d4q2', pillar:'tech', milestone:'tech_platform', priority:'core', title:'Platform Drop + Aerial Consistency', time:20, xp:70, instructions:'Platform drop into aerial (50 reps), short hop fast fall (50 reps). PASS: 45/50 clean on each. This is the same skill from Day 1 â€” it should be cleaner. Note what percentage improved vs Day 1. That improvement rate is your baseline learning speed.' },
    { id:'d4q3', pillar:'mental', milestone:'ment_tilt', priority:'core', title:'Map Your Tilt Triggers', time:10, xp:60, instructions:'Write honestly: what makes you tilt? Missed tech? Getting grabbed? Losing a stock you had? PASS: Name at least 3 specific triggers with the exact in-game scenario that causes each. "Getting grabbed" is not specific enough. "Getting grabbed after whiffing forward smash and then dying because of it" is. Write at that level of specificity.' },
    { id:'d4q4', pillar:'matchups', milestone:'mu_cards', priority:'core', title:'ğŸ•µï¸ Scout Report â€” First Player', time:20, xp:90, instructions:'Open Local Scene Scouting. Add the player who beats you most consistently. Fill Neutral Game and Their Advantage State completely. PASS: Every field has a specific observation â€” not "they play aggressive" but "they always dash in with Ftilt after I land from an aerial." Vague answers don\'t count. Rewrite until every field is match-specific.' },
    { id:'d4q5', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 1', time:30, xp:35, instructions:'30 minutes of Zone 2 cardio â€” walking briskly, jogging, cycling, whatever you have access to. The rule: you must be able to hold a full conversation throughout. If you\'re gasping, slow down. This isn\'t about intensity â€” it\'s about building the aerobic base that keeps your cognitive performance from degrading in Hour 5 of a tournament. Log it: activity, duration, how you felt after.' },
  ],
  5: [
    { id:'d5q1', pillar:'tech', milestone:'tech_combos', priority:'core', title:'BnB Starter Drill â€” Hit Your Standard', time:35, xp:80, instructions:'Week 1 theme: Movement & Neutral. Drill your most important combo starter â†’ ender (60 reps). PASS: 50/60 clean â€” starter connects AND ender lands. Every drop: write what went wrong (input error, timing, wrong read). Find the pattern in your drops. If you don\'t hit 50/60, drill 20 more reps before stopping.' },
    { id:'d5q2', pillar:'neutral', milestone:'neut_spacing', priority:'core', title:'Bait & Punish â€” Timing Drill', time:25, xp:70, instructions:'vs CPU on walk: bait the whiff, punish it (50 reps). PASS: 42/50 punishes landed within 10 frames of the whiff. Slow punishes don\'t count â€” the goal is fast-twitch timing, not just getting the punish eventually. Log your timing accuracy.' },
    { id:'d5q3', pillar:'physical', milestone:'phys_focus', priority:'recommended', title:'Rate Your Focus', time:2, xp:20, instructions:'After today\'s session: rate focus 1â€“10. Write one sentence on what affected it most. Build this data now.' },
  ],
  6: [
    { id:'d6q1', pillar:'tech', milestone:'tech_shield', priority:'core', title:'Parry Timing Drill', time:35, xp:70, instructions:'Week 1 theme: Movement & Neutral. Parry is shield on the exact frame of an attack. Set CPU to a predictable move â€” drill the parry (50 reps). PASS: 35/50 successful parries. A "successful parry" means you got the parry window, not just that you shielded. Log your success rate. If you\'re below 35, identify whether the issue is timing anticipation or input speed.' },
    { id:'d6q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 2 â€” Count Your Neutral Decisions', time:20, xp:100, instructions:'Watch a set and count: how many times did you WIN a neutral exchange? How many did you LOSE? Of the losses â€” what option did you choose and what punished it? Write the numbers. You are building a database of your neutral decisions. Log it in the VOD tool.' },
    { id:'d6q3', pillar:'mental', milestone:'ment_focus', priority:'recommended', title:'Pre-Session Intention + Grade', time:5, xp:40, instructions:'Set ONE technical focus before your session. At session end, grade yourself 1â€“10 on executing it. Not on wins â€” on execution. The grade is what matters.' },
  ],
  7: [
    { id:'d7q1', pillar:'competitive', milestone:'comp_boss', priority:'core', title:'âš”ï¸ BOSS BATTLE â€” Week 1', time:45, xp:250, instructions:'WEEK 1 BOSS DAY. Full Bo5 vs your best training partner. Tournament rules â€” no pausing, no rematching mid-set. PASS: Complete all 5 games. After: write what Week 1\'s movement and neutral work showed up in your play â€” and where it didn\'t. Be specific. That gap is what Week 2 targets.' },
    { id:'d7q2', pillar:'mental', milestone:'ment_journal', priority:'core', title:'Week 1 Reflection', time:10, xp:60, instructions:'Answer three questions at depth: What movement or neutral skill improved most this week? What was harder than expected? Where did your Week 1 theme (Movement & Neutral) actually show up in the Boss Battle â€” and where were you still on autopilot? Write at least 3 sentences per question.' },
    { id:'d7q3', pillar:'physical', milestone:'phys_hydration', priority:'recommended', title:'Hydration Habit Check', time:2, xp:20, instructions:'500ml before session. Rate how automatic it feels 1â€“10. Below 8: set a phone alarm for pre-session.' },
  ],

  // â”€â”€ WEEK 2: Conversion & Execution Under Pressure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  8: [
    { id:'d8q1', pillar:'tech', milestone:'tech_combos', priority:'core', title:'Combo Extension Drills', time:35, xp:80, instructions:'Week 2 theme: Conversion & Execution Under Pressure. Drill anti-air confirm â†’ full combo route (40 reps), juggle extension â€” up-air string minimum 3 hits (35 reps). PASS: 34/40 on anti-air confirm completing the full route, 28/35 on 3-hit juggle string. Log your drop points â€” the exact moment you lose the combo. That drop point is tomorrow\'s 20-rep targeted drill.' },
    { id:'d8q2', pillar:'neutral', milestone:'neut_condition', priority:'core', title:'Identify Your Autopilot Habit', time:15, xp:70, instructions:'Watch 15 minutes of your own footage. Find your most repeated neutral pattern â€” the thing you do without thinking. PASS: Name it with enough specificity that you could design a drill around it. "I approach too much" doesn\'t pass. "I always dash in with a running Nair whenever they land from a platform" passes. Write it. You will now consciously target this for the rest of the program.' },
    { id:'d8q3', pillar:'physical', milestone:'phys_hands', priority:'recommended', title:'Hand Maintenance', time:3, xp:20, instructions:'Full stretch. How do your hands feel after a week of daily drilling? Note any tightness â€” adjust grip pressure if needed.' },
    { id:'d8q4', pillar:'matchups', milestone:'mu_cards', priority:'core', title:'ğŸ•µï¸ Scout Report â€” Second Player', time:20, xp:90, instructions:'Add your second toughest opponent. For both players: fill their Disadvantage State section completely â€” ledge habits, recovery angle, getup tendencies. PASS: Every field for both players has a specific, matchup-tested observation. Anything vague gets rewritten.' },
  ],
  9: [
    { id:'d9q1', pillar:'tech', milestone:'tech_dash', priority:'core', title:'RAR Consistency Drill', time:30, xp:70, instructions:'Week 2 theme: Conversion & Execution Under Pressure. RAR â€” dash, jump, reverse momentum mid-air (50 reps). Then running turnaround fsmash (35 reps). PASS: 42/50 clean RAR (correct direction, no fumbled input), 28/35 clean turnaround fsmash. What is still the sticking point? Name it specifically and note it for tomorrow\'s warmup.' },
    { id:'d9q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 3 â€” Track Your Disadvantage Deaths', time:20, xp:100, instructions:'This review has one focus: disadvantage state. Watch a full set. Mark every stock loss â€” how many came from disadvantage you couldn\'t escape vs disadvantage you survived? Write the split. Your escape rate is a real number now. Log it in the VOD tool.' },
    { id:'d9q3', pillar:'competitive', milestone:'comp_grind', priority:'recommended', title:'Focused Online Session â€” Neutral Only', time:20, xp:60, instructions:'5 online sets, focus: apply your max-range poke at the correct range. Not winning â€” applying the skill. Rate your application 1â€“10 after. Below 6: what stopped you from applying it?' },
    { id:'d9q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 2', time:30, xp:35, instructions:'30 minutes, conversational pace. One addition: notice how your breathing settles after the first 10 minutes. That settling point is your aerobic system engaging. Log: activity, and rate your focus quality in tonight\'s session vs a day you skipped cardio. You\'re building correlation data.' },
  ],
  10: [
    { id:'d10q1', pillar:'tech', milestone:'tech_combos', priority:'core', title:'Kill Confirm Drills â€” Know Your Percents', time:35, xp:80, instructions:'Week 2 theme: Conversion & Execution Under Pressure. Identify the kill confirm route for your character. Drill it on training mode dummies at exact kill percents for your 3 most common local-scene matchups (40 reps per weight class). PASS: 35/40 clean confirms landing on correct weight class dummy at the relevant percent. Log confirm rate per weight class â€” they will be different.' },
    { id:'d10q2', pillar:'neutral', milestone:'neut_condition', priority:'core', title:'Break Your Autopilot Habit â€” Day 1', time:20, xp:70, instructions:'Go into your next session with one rule: do NOT do the autopilot habit you identified on Day 8. Every time you catch yourself about to do it â€” stop and choose a different option. PASS: Catch yourself avoiding the habit at least 8 times in a session (each catch = conscious override). Log the count. Below 8 means either you didn\'t play long enough or the habit is deeper than you thought.' },
    { id:'d10q3', pillar:'mental', milestone:'ment_tilt', priority:'core', title:'Build Your Tilt Reset Routine', time:8, xp:50, instructions:'Design your personal tilt reset routine. Requirements: under 10 seconds, executable mid-match without dropping controller, repeatable. Write it out exactly. Then practice it physically 10 times right now â€” actually do the motions. PASS: You have a specific written routine AND have physically rehearsed it 10 times. Vague "breathe and refocus" doesn\'t pass â€” it must be a specific, timed, physical sequence.' },
  ],
  11: [
    { id:'d11q1', pillar:'tech', milestone:'tech_pressure', priority:'core', title:'Execution Under Pressure â€” The 10-Clean Standard', time:40, xp:80, instructions:'Week 2 theme: Conversion & Execution Under Pressure. 10 perfect combos in a row â€” starter connects, full route, kill confirm at kill percent. Drop one: reset to 0. PASS: Hit 10 clean consecutive. Do not leave training mode until you pass. This isn\'t about time â€” it\'s about building the neural pathway that says pressure doesn\'t change execution. Log how many resets it took.' },
    { id:'d11q2', pillar:'neutral', milestone:'neut_film', priority:'core', title:'Neutral Analysis â€” Assumptions vs Reality', time:20, xp:80, instructions:'Watch a full set of your own footage. For every neutral exchange you lost: write what you ASSUMED they would do vs what they ACTUALLY did. PASS: Find at least 3 assumptions that were wrong in the same way â€” the same wrong assumption showing up repeatedly is a conditioning you\'ve built. Name the assumption. That\'s what Week 2 neutral work is targeting.' },
    { id:'d11q3', pillar:'physical', milestone:'phys_sleep', priority:'recommended', title:'Sleep-Performance Log', time:3, xp:20, instructions:'Log sleep hours and session focus rating. Is there a pattern? What\'s the threshold where your focus noticeably drops? That threshold is your sleep floor.' },
  ],
  12: [
    { id:'d12q1', pillar:'tech', milestone:'tech_charmech', priority:'core', title:'Character Mechanic Drill â€” Live Application', time:35, xp:80, instructions:'Week 2 theme: Conversion & Execution Under Pressure. Your primary unique mechanic â€” drill it in isolation (50 reps in training mode). Then: vs CPU on high difficulty, execute the mechanic correctly in 10 live exchanges. PASS: 42/50 clean in isolation AND 7/10 successful in live exchanges. The live portion is the test â€” drilling without transferring means the mechanic isn\'t yours yet.' },
    { id:'d12q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 4 â€” Kill Opportunity Audit', time:20, xp:100, instructions:'Watch a set. Count every time you had a kill-percent opportunity â€” did you take it cleanly, miss it, or not recognize it? Write: opportunities created, opportunities converted, clean percentage. Log it in the VOD tool.' },
    { id:'d12q3', pillar:'competitive', milestone:'comp_prep', priority:'recommended', title:'Pre-Session Protocol', time:5, xp:40, instructions:'Before playing: set your technical focus, review any matchup notes for who you\'ll likely play, 10 min training mode warmup before touching a real set. Write out this ritual â€” it becomes your standard.' },
    { id:'d12q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 3', time:30, xp:35, instructions:'30 minutes. Pick the same activity as Day 9 if possible â€” consistency in the stimulus makes the adaptation cleaner. Use this time productively: mentally walk through your combo tree or replay a set in your head. Your brain is still working. Log duration and activity.' },
  ],
  13: [
    { id:'d13q1', pillar:'tech', milestone:'tech_combos', priority:'core', title:'Ledge Trap Coverage â€” Name Every Option', time:25, xp:70, instructions:'Week 2 theme: Conversion & Execution Under Pressure. Hold your ledge trap position and call out every opponent option aloud while covering it (5 sets of 2 minutes each). PASS: Can you name AND cover all 5 options â€” roll in, roll attack, getup, ledge jump, neutral jump â€” within 1 second of each? If any option catches you more than once per set, that option gets 20 dedicated reps.' },
    { id:'d13q2', pillar:'mental', milestone:'ment_identity', priority:'core', title:'Define Your Player Identity', time:10, xp:60, instructions:'Write: "I am a player who ___." Describe your playstyle â€” not results. Write 3 versions, pick the truest one. PASS: Your chosen statement is specific enough that someone who watched you play could confirm or deny it. "I am a player who wins" fails. "I am a player who controls center stage and baits approaches from max range" passes.' },
    { id:'d13q3', pillar:'physical', milestone:'phys_focus', priority:'recommended', title:'Focus Quality Check', time:3, xp:20, instructions:'Rate today\'s focus 1â€“10. What specifically would have raised it? Name one controllable thing to change before your next session.' },
    { id:'d13q4', pillar:'matchups', milestone:'mu_cards', priority:'core', title:'ğŸ•µï¸ Scout Report â€” Mental & Shield Habits', time:15, xp:80, instructions:'For every scouted player: fill Mental & Habits and Shield & Pressure sections. What do they do when losing? What is their panic option? What do they press on your shield? PASS: Every answer is a specific in-game observation. If you can\'t answer any field, you write "UNKNOWN â€” need to watch them" and that becomes a homework item before your next set against them.' },
  ],
  14: [
    { id:'d14q1', pillar:'tech', milestone:'tech_pressure', priority:'core', title:'Recorded Execution Drill', time:30, xp:80, instructions:'Week 2 theme: Conversion & Execution Under Pressure. Record yourself playing. Execute your hardest tech knowing you\'re being recorded â€” the pressure is the point. PASS: Review the footage. Grade your hardest tech execution: did it hold up under recording pressure? What dropped that wouldn\'t drop in unrecorded reps? Write the gap. That gap is your Week 2 pressure lesson.' },
    { id:'d14q2', pillar:'neutral', milestone:'neut_spacing', priority:'core', title:'Map Local Character Poke Answers', time:15, xp:70, instructions:'For each character in your local scene: what is their answer to your max-range safe poke? Write it. PASS: Every character you regularly face has a specific answer written. This is your neutral cheat sheet â€” know what\'s coming before they show you.' },
    { id:'d14q3', pillar:'mental', milestone:'ment_journal', priority:'core', title:'Block 1 Journal â€” Foundation Complete', time:10, xp:80, instructions:'Block 1 done. Answer at this depth: What is your biggest tech weakness right now, specifically? What neutral habit still needs the most work? What mental pattern is costing you the most stocks â€” name the exact in-game moment it shows up? These three answers become your Block 2 targets. Vague answers mean you haven\'t looked hard enough yet.' },
  ],

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BLOCK 2: DRILLING (Days 15â€“28)
  // Week 3 Theme: ADVANTAGE STATE â€” converting openings into damage and kills
  // Week 4 Theme: DISADVANTAGE STATE â€” surviving, escaping, resetting neutral
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // â”€â”€ WEEK 3: Advantage State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  15: [
    { id:'d15q1', pillar:'advantage', milestone:'adv_combos', priority:'core', title:'Map Your Full Combo Tree', time:30, xp:90, instructions:'Week 3 theme: Advantage State. Map your full combo tree from every major starter (grab, anti-air, ground poke) on all local-scene character weights â€” light, mid, heavy. Write it out. PASS: Every starter has at least 2 routes written, covering at least 3 different weight classes. If any starter has a blank route, that blank is your day\'s drill focus after mapping.' },
    { id:'d15q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 5 â€” Week 2 Comparison', time:20, xp:100, instructions:'Pull up your Day 3 baseline mistake. Watch a new set looking specifically for that mistake. Is it still there? How often? Has it changed shape? Write the update. Log it in the VOD tool.' },
    { id:'d15q3', pillar:'competitive', milestone:'comp_grind', priority:'recommended', title:'Online Grind â€” Neutral Focus', time:25, xp:60, instructions:'5 online sets. Focus: use your mapped neutral options consciously. Not winning â€” applying the system. Rate application 1â€“10 after.' },
  ],
  16: [
    { id:'d16q1', pillar:'advantage', milestone:'adv_combos', priority:'core', title:'Grab Combo Routes â€” Weight Class Mastery', time:35, xp:80, instructions:'Week 3 theme: Advantage State. Drill grab â†’ throw combo for each direction on light weights (35 reps per throw direction) and heavy weights (35 reps per throw direction). PASS: 30/35 clean on each direction and weight class. Log your clean rate per category â€” there will be one weight class that\'s harder. That class gets an extra 20 reps before you stop.' },
    { id:'d16q2', pillar:'tech', milestone:'tech_combos', priority:'core', title:'Combo Drop Analysis', time:20, xp:70, instructions:'Play 3 sets and log every single dropped combo â€” starter, what you were attempting, what you got instead. PASS: Find the most repeated drop pattern. Write it as a specific drill prescription: "My [starter] â†’ [ender] drops because I [specific input error]. Tomorrow\'s drill: 30 reps specifically targeting [that input]." Vague patterns don\'t count.' },
    { id:'d16q3', pillar:'physical', milestone:'phys_hydration', priority:'recommended', title:'Hydration & Nutrition Check', time:3, xp:20, instructions:'500ml water. Did you eat before this session? Log pre-session meal and how focus felt. Carbs before = more cognitive stamina.' },
  ],
  17: [
    { id:'d17q1', pillar:'advantage', milestone:'adv_juggle', priority:'core', title:'Juggle Extension + DI Reading', time:35, xp:80, instructions:'Week 3 theme: Advantage State. Drill up-air juggle string â€” minimum 3 hits (40 reps). Then DI reading during juggle â€” CPU DIs randomly, you chase correct direction (30 reps). PASS: 34/40 on 3-hit string completion, 22/30 correct DI reads. The DI reading is harder and matters more â€” missing the chase direction is a free stock for your opponent.' },
    { id:'d17q2', pillar:'neutral', milestone:'neut_options', priority:'core', title:'Punish Positioning â€” Position Before Punish', time:25, xp:70, instructions:'After every blocked move: cover both roll options (40 reps each side). The goal is having the correct position BEFORE they roll â€” not reacting. PASS: 34/40 on each side where you are in correct punish position before they roll. If you\'re reacting rather than positioning, your pass rate will be much lower â€” that\'s the data.' },
    { id:'d17q3', pillar:'mental', milestone:'ment_focus', priority:'recommended', title:'Mid-Session Check-In', time:5, xp:40, instructions:'Halfway through today\'s session, stop. Rate focus 1â€“10. What changed since the start? If it dropped â€” name the specific moment it dropped. That moment is your focus interrupt to design around.' },
    { id:'d17q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 4', time:30, xp:35, instructions:'30 minutes, conversational pace. Week 3 check: does it feel easier than Week 1? It should â€” that\'s your aerobic base building. Log: activity, and write one word for how your mental state felt mid-cardio. This data will matter later.' },
  ],
  18: [
    { id:'d18q1', pillar:'advantage', milestone:'adv_ledge', priority:'core', title:'Ledge Trap Execution â€” All Three Options', time:35, xp:80, instructions:'Week 3 theme: Advantage State. Drill: punish ledge roll in (35 reps), ledge attack (35 reps), getup (35 reps). Hold the position â€” don\'t chase. PASS: 30/35 on each option. For any option below pass threshold, identify whether you\'re missing the coverage timing or the punish input. They\'re different problems requiring different fixes.' },
    { id:'d18q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 6 â€” Advantage State Conversion Rate', time:20, xp:100, instructions:'This review: advantage state only. Count every time you landed a hit and entered advantage. Full combo? Partial conversion? No conversion? Write all three numbers. Your conversion rate is now a stat you own. Log it in the VOD tool.' },
    { id:'d18q3', pillar:'competitive', milestone:'comp_prep', priority:'recommended', title:'Matchup Review Before Sets', time:8, xp:40, instructions:'Before your next session: review your matchup card for the character you\'re most likely to face. Game plan before you queue up â€” not after you\'ve already lost.' },
  ],
  19: [
    { id:'d19q1', pillar:'advantage', milestone:'adv_kills', priority:'core', title:'Kill Confirm Percents â€” Mapped and Drilled', time:35, xp:80, instructions:'Week 3 theme: Advantage State. Identify the kill percents for every kill move vs each local-scene character. Write it. Then drill each confirm at exact kill percent (20 reps per character). PASS: Every local-scene character has a specific kill percent written AND you hit the confirm cleanly 16/20 on each character. Sloppy confirms at kill percent are the most expensive mistake in this game.' },
    { id:'d19q2', pillar:'tech', milestone:'tech_pressure', priority:'core', title:'Final Stock Close-Out Drill', time:25, xp:70, instructions:'Final stock, your character at kill percent, CPU on high difficulty â€” 15 rounds. PASS: Close out 11/15 cleanly (clean = kill confirm landing, no SD, no panic option). Log your close-out rate. Missing close-outs at this stage is almost never a tech problem â€” it\'s a mental execution-under-pressure problem. Note what happens in your misses.' },
    { id:'d19q3', pillar:'physical', milestone:'phys_hands', priority:'recommended', title:'Hand Health Check', time:3, xp:20, instructions:'Stretch, check for soreness. Two weeks in â€” any chronic tension? Address it now.' },
  ],
  20: [
    { id:'d20q1', pillar:'advantage', milestone:'adv_review', priority:'core', title:'Dropped Conversion Log â€” Find the Pattern', time:20, xp:80, instructions:'Week 3 theme: Advantage State. Play a full session. After every set, log every dropped combo â€” starter, what you attempted, what you actually got. PASS: After the session, identify the one drop pattern that appears most often across ALL sets. Write a specific drill prescription for it. That prescription is part of tomorrow\'s warmup.' },
    { id:'d20q2', pillar:'neutral', milestone:'neut_film', priority:'core', title:'Neutral Film â€” Build a Drill From It', time:20, xp:80, instructions:'Watch one set. Identify the #1 most repeated neutral mistake. PASS: Don\'t just name it â€” design a specific 20-rep drill around fixing it. Write the drill: what training mode setup, what CPU setting, what the "clean rep" looks like, what counts as a fail. That drill runs as tomorrow\'s warmup.' },
    { id:'d20q3', pillar:'mental', milestone:'ment_tilt', priority:'core', title:'Tilt Exposure Training â€” Controlled Pressure', time:15, xp:60, instructions:'Mental training week 3: test your reset routine under mild controlled stress. Play a set against someone who beats you with a deliberate handicap â€” start every game at 50% damage. When you feel tilt coming: execute your reset routine exactly as written. PASS: You executed your written reset routine at least 3 times during the session AND noted whether it reduced tilt or not. If it didn\'t work, you rewrite one element of it tonight.' },
    { id:'d20q4', pillar:'matchups', milestone:'mu_cards', priority:'core', title:'ğŸ•µï¸ Scout Report â€” Write Their Game Plans', time:20, xp:100, instructions:'For every scouted player: fill Your Game Plan section completely. PASS: Every player has a specific answer to â€” what neutral option beats their approach, how you cover their ledge habits, and a one-sentence game plan at the bottom. If you can\'t write the one-sentence plan for someone who beats you regularly, that\'s the problem to solve today.' },
    { id:'d20q5', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 5', time:30, xp:35, instructions:'30 minutes. Halfway through Block 2. Use the time to mentally review your Day 8 autopilot habit â€” what\'s it doing now? Cardio is also active mental recovery. Your brain is processing everything you drilled this week. Let it. Log activity and duration.' },
  ],
  21: [
    { id:'d21q1', pillar:'competitive', milestone:'comp_boss', priority:'core', title:'âš”ï¸ BOSS BATTLE â€” Week 3', time:45, xp:250, instructions:'WEEK 3 BOSS DAY. Full Bo5 vs your best training partner. After: review the set mentally â€” where did Week 3\'s advantage state work show up? How many times did you convert an opening cleanly vs drop it? Write 3 specific things your advantage state still needs. That\'s Week 4\'s work.' },
    { id:'d21q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 7 â€” Reactive vs Intentional', time:20, xp:100, instructions:'Watch a full set twice. First pass: no notes. Second pass: pause every neutral decision â€” "Was that reactive or intentional?" Write the ratio. Intentional decisions should be growing. Reactive panic decisions should be shrinking. Log both numbers in the VOD tool.' },
    { id:'d21q3', pillar:'physical', milestone:'phys_sleep', priority:'recommended', title:'Sleep Pattern Review', time:3, xp:20, instructions:'Review your sleep log from the past 3 weeks. What\'s the pattern? What\'s the sleep amount that consistently produces high focus? Target that number this week.' },
  ],

  // â”€â”€ WEEK 4: Disadvantage State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  22: [
    { id:'d22q1', pillar:'advantage', milestone:'adv_ledge', priority:'core', title:'Two-Frame Punish Drill', time:25, xp:70, instructions:'Week 4 theme: Disadvantage State. Two-frame ledge grab punish â€” your character\'s option if applicable (30 reps). If not applicable: ledge jump punish (30 reps). PASS: 25/30 clean. Also map the reverse: which moves YOUR ledge grab animation is vulnerable to. Write your own two-frame vulnerabilities â€” you\'ll drill the defense on Day 26.' },
    { id:'d22q2', pillar:'matchups', milestone:'mu_cards', priority:'core', title:'Build Second Matchup Card', time:15, xp:70, instructions:'Add your second hardest local matchup to the Matchup Anchors tool. PASS: Every field filled, including one specific observation about their ledge options that your game plan must account for.' },
    { id:'d22q3', pillar:'competitive', milestone:'comp_grind', priority:'recommended', title:'Apply Advantage State â€” 5 Conversion Sets', time:20, xp:60, instructions:'5 online sets. Focus: apply your ledge trap flowchart every time you get an offstage situation. Not winning â€” executing. Rate your ledge trap consistency 1â€“10 after.' },
  ],
  23: [
    { id:'d23q1', pillar:'disadvantage', milestone:'dis_escape', priority:'core', title:'Disadvantage Escape Options â€” Isolation Drill', time:35, xp:80, instructions:'Week 4 theme: Disadvantage State. Map your character\'s best escape options: getup attack, roll in, roll out, jump, wait. Then vs CPU on medium: survive disadvantage without taking additional damage â€” 15 rounds. PASS: Survive 11/15 without extra damage taken after landing. Every death or extra hit: write which option you tried and what punished it. That data tells you which options are actually viable.' },
    { id:'d23q2', pillar:'neutral', milestone:'neut_condition', priority:'core', title:'Autopilot Habit â€” Day 2 Track', time:15, xp:60, instructions:'Week 4 neutral: track your Day 8 autopilot habit in a live session. PASS: Catch and override the habit at least 10 times (up from 8 on Day 10). Each override: write what you did instead. Is your replacement option consistent? Inconsistent replacement options mean you need to pick one specific counter-habit.' },
    { id:'d23q3', pillar:'physical', milestone:'phys_focus', priority:'recommended', title:'Focus Environment Audit', time:5, xp:30, instructions:'What in your environment is hurting your focus? Phone? Noise? Lighting? Fix one thing today that will improve every session after this.' },
  ],
  24: [
    { id:'d24q1', pillar:'disadvantage', milestone:'dis_reads', priority:'core', title:'Opponent Chase Pattern â€” Map It', time:25, xp:80, instructions:'Week 4 theme: Disadvantage State. Watch your own disadvantage footage â€” what does your opponent do to keep you in disadvantage? Their chase pattern is what your escape options must beat. PASS: Write the specific chase sequence your most common opponent uses â€” their first option after a hit, their second option if you dodge, their read if you jump. Map all three. That map is your escape framework.' },
    { id:'d24q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 8 â€” Read Your Opponent', time:20, xp:100, instructions:'Flip the lens. Watch a set and track your OPPONENT\'s tendencies only: what do they do out of shield, first option after landing, behavior on first stock vs last stock? Build a live scout report from this footage. Log your reads in the VOD tool.' },
    { id:'d24q3', pillar:'matchups', milestone:'mu_research', priority:'recommended', title:'Top-Level Matchup Footage', time:20, xp:60, instructions:'Watch one top-level set in your hardest matchup. One note only: the one thing they do in neutral that you don\'t. Write it in your matchup card.' },
    { id:'d24q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 6', time:30, xp:35, instructions:'30 minutes, conversational pace. You\'re in Week 4 â€” the program\'s hardest mental stretch. Aerobic work directly lowers cortisol. This session is as much mental maintenance as physical. Log: activity, and rate your stress level before and after on a 1â€“10 scale. That delta is the data.' },
  ],
  25: [
    { id:'d25q1', pillar:'competitive', milestone:'comp_review', priority:'core', title:'Post-Set Protocol â€” Interaction Autopsy', time:15, xp:70, instructions:'Week 4 theme: Disadvantage State. After your next serious set: write the specific interaction that ended it. PASS: Your write-up identifies the exact moment (what percent, what position, what option you chose) AND names one drill you could run to address that specific interaction. "I lost neutral too much" doesn\'t pass. "I got punished by their dash attack every time I landed from a short hop Nair and I need to land with a different aerial or change my jump timing" passes.' },
    { id:'d25q2', pillar:'advantage', milestone:'adv_combos', priority:'core', title:'Jab Extension Drills', time:25, xp:70, instructions:'Drill jab â†’ combo extension option at every percent range â€” low, mid, kill (40 reps per percent range). PASS: 34/40 clean on each percent range. Your jab is often your fastest punish â€” what comes after it must be automatic, not a decision.' },
    { id:'d25q3', pillar:'mental', milestone:'ment_identity', priority:'recommended', title:'Identity Under Pressure â€” Live Test', time:10, xp:50, instructions:'Mental training week 4: play a hard set against someone who beats you. Before the set: state your identity aloud. Play AS that identity. After: did your playstyle match who you said you are? Name the exact moment you reverted to old habits. That reversion moment is your mental training target for Block 3.' },
  ],
  26: [
    { id:'d26q1', pillar:'disadvantage', milestone:'dis_ledge', priority:'core', title:'Ledge Option Mixing â€” Force the Mix', time:35, xp:70, instructions:'Week 4 theme: Disadvantage State. Practice all 5 ledge options: ledge jump, roll, attack, getup, drop (20 reps each in isolation). Then: 5 sets where you consciously rotate options â€” no option used more than twice in a row. PASS: After 5 sets, every option appeared at least 5 times. If any option appeared fewer than 5 times, you defaulted and didn\'t mix â€” your opponent already knows what\'s coming.' },
    { id:'d26q2', pillar:'neutral', milestone:'neut_aerial', priority:'core', title:'Double Jump Usage Drill', time:25, xp:70, instructions:'Use your double jump as a deliberate pressure or escape tool (25 reps pressure, 25 reps escape). PASS: 20/25 on each where the double jump achieves its intended purpose (pressure maintained, or escape successful). If your double jump is getting absorbed or punished, you\'re using it predictably â€” vary the timing.' },
    { id:'d26q3', pillar:'physical', milestone:'phys_hydration', priority:'recommended', title:'Hydration Streak Check', time:2, xp:20, instructions:'Is pre-session hydration automatic yet? Rate 1â€“10. Below 8: phone alarm before every session until it is.' },
  ],
  27: [
    { id:'d27q1', pillar:'advantage', milestone:'adv_review', priority:'core', title:'Advantage Drill From Footage', time:30, xp:80, instructions:'Week 4 theme: Disadvantage State. Watch your footage from this week. Pick the most repeated dropped conversion. PASS: Build a drill specifically targeting that drop (30 reps minimum) AND complete it before you move on. The drill must come directly from something you saw in your own footage â€” not a general combo practice. Log the drop you targeted and your clean rate.' },
    { id:'d27q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 9 â€” Extract Tomorrow\'s Drill', time:20, xp:100, instructions:'Watch a recent set with one mission: find ONE moment where you lost an interaction you should have won. Pause it. Write exactly what happened. Design 30 reps around that exact scenario. Log the drill design in the VOD tool â€” that drill runs tomorrow.' },
    { id:'d27q3', pillar:'competitive', milestone:'comp_bracket', priority:'recommended', title:'Bracket Simulation Set', time:25, xp:70, instructions:'3 sets â€” tournament rules, no pausing, no resets. After: what was your emotional state? Where did nerves change your decisions?' },
    { id:'d27q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 7', time:30, xp:35, instructions:'30 minutes. Block 2 is almost done. Seven cardio sessions in â€” is it routine yet? If it still feels like a chore, you haven\'t connected it to your performance yet. Review your focus logs: do your high-focus days correlate with recent cardio? Log activity and note the pattern if you see it.' },
  ],
  28: [
    { id:'d28q1', pillar:'tech', milestone:'tech_pressure', priority:'core', title:'Block 2 Tech Audit', time:20, xp:80, instructions:'Run your full tech checklist. Grade every category â€” platform, dash, shield/OOS, combos, character mechanic, pressure execution. PASS: Every category rated AND every category below 80% has a specific drill prescription written for Block 3. "Needs work" doesn\'t pass â€” "needs 30 reps of [specific drill] daily in Block 3 warmup" passes.' },
    { id:'d28q2', pillar:'mental', milestone:'ment_journal', priority:'core', title:'Block 2 Journal Entry', time:10, xp:80, instructions:'Half of 60 days done. Answer: What has changed in your game since Day 1 â€” specifically? What is the single biggest improvement you can point to in footage? What is the hardest thing you still need to fix in Block 3 â€” the specific interaction or habit that is still costing you stocks?' },
    { id:'d28q3', pillar:'physical', milestone:'phys_sleep', priority:'recommended', title:'Block 2 Physical Check', time:3, xp:20, instructions:'Review your sleep and focus logs. Is your physical baseline better than Day 1? What ONE physical habit has the biggest impact on your play quality?' },
    { id:'d28q4', pillar:'matchups', milestone:'mu_cards', priority:'core', title:'ğŸ•µï¸ Scout Report â€” Fill the Gaps', time:15, xp:80, instructions:'Check your completion rings â€” any player below 50%? PASS: Every scouted player at 70%+ completion before you leave Block 2. Players you\'ve dismissed because you "already know them" get a section. The players you dismiss are always the ones who catch you in bracket.' },
  ],

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BLOCK 3: APPLICATION (Days 29â€“42)
  // Week 5 Theme: APPLYING DRILLS IN LIVE SETS â€” does training transfer?
  // Week 6 Theme: MATCHUP EXECUTION â€” game plans under real pressure
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // â”€â”€ WEEK 5: Applying Drills in Live Sets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  29: [
    { id:'d29q1', pillar:'competitive', milestone:'comp_prep', priority:'core', title:'Match Play Block Starts â€” Written Game Plans', time:15, xp:70, instructions:'Week 5 theme: Applying Drills in Live Sets. Block 3 is real sets. Today\'s rule: enter every set with a written game plan. Not a feeling â€” a written plan. PASS: Before your first set today, write a game plan of at least 3 specific points. After each set, write whether you executed it. Yes/no per point is enough. If you can\'t write a plan, you haven\'t done enough drilling â€” that\'s the answer.' },
    { id:'d29q2', pillar:'disadvantage', milestone:'dis_film', priority:'core', title:'Disadvantage Footage Review â€” Pattern Map', time:20, xp:80, instructions:'Watch your own footage focused ONLY on disadvantage. For each sequence: how much damage did you take, was it avoidable, what option would have worked? PASS: Write the one most repeated pattern in your disadvantage deaths. Not "I die a lot in disadvantage" â€” the specific setup that kills you most often. That setup gets a dedicated 30-rep drill this week.' },
    { id:'d29q3', pillar:'matchups', milestone:'mu_research', priority:'recommended', title:'Matchup Footage Study', time:15, xp:60, instructions:'Watch a top-level set in a matchup you\'re struggling with. One tactical note only â€” something they do in neutral you can apply this week.' },
  ],
  30: [
    { id:'d30q1', pillar:'competitive', milestone:'comp_grind', priority:'core', title:'Transfer Test â€” Did Drilling Show Up?', time:30, xp:80, instructions:'Week 5 theme: Applying Drills in Live Sets. 10 sets minimum. After each set: did your trained BnB starter show up? Did your neutral poke show up? Did your ledge trap show up? Write yes/no for each across all 10 sets. PASS: At least 2 of your 3 trained skills showed up in at least 7/10 sets. Below that means the drilling didn\'t transfer â€” Block 3 Week 5 is your correction window.' },
    { id:'d30q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 10 â€” Did the Drills Cross Over?', time:20, xp:100, instructions:'Watch a recent set and count specifically: how many times did your trained BnB starter appear? Your max-range poke? Your OOS punish? Write the counts. This is the feedback loop. Did muscle memory cross over? Log the numbers in the VOD tool.' },
    { id:'d30q3', pillar:'neutral', milestone:'neut_condition', priority:'core', title:'Autopilot Habit Interrupt â€” Live Sets', time:20, xp:80, instructions:'Your Day 8 habit â€” it is still there in live sets. Rule for today: every time you catch yourself using it, you must immediately do something different in the very next neutral exchange. PASS: Catch and override the habit at least 12 times across your session. Each catch: write what you did instead. Consistent replacement options are building a new habit. Inconsistent replacements mean you still don\'t have a counter-habit yet.' },
    { id:'d30q4', pillar:'mental', milestone:'ment_tourney', priority:'recommended', title:'Tournament Mental Prep', time:8, xp:50, instructions:'Visualize your next local in detail: walking in, warming up, your first set, a close game on last stock. Mental rehearsal is real training â€” do it seriously for 5 minutes.' },
    { id:'d30q5', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 8', time:30, xp:35, instructions:'30 minutes. Block 3 starts. The research is consistent: aerobic fitness improves sustained attention, working memory under fatigue, and emotional regulation under stress â€” all three of which determine your play quality in a long bracket run. You\'re now 8 sessions in. Log activity and duration.' },
  ],
  31: [
    { id:'d31q1', pillar:'matchups', milestone:'mu_drilling', priority:'core', title:'Matchup-Specific Drill + Live Application', time:30, xp:80, instructions:'Week 5 theme: Applying Drills in Live Sets. Your hardest matchup scenario: drill the specific interaction you struggle with most (40 reps in training mode). Then: vs CPU on hard, execute your matchup game plan for 5 stocks without deviating from the written plan. PASS: Hit 34/40 clean on the drill AND complete 5 stocks without deviation. One deviation from the written plan and that stock doesn\'t count.' },
    { id:'d31q2', pillar:'neutral', milestone:'neut_film', priority:'core', title:'Neutral Pattern Update â€” Is Block 1 Habit Gone?', time:15, xp:70, instructions:'Watch a recent set. Is the neutral habit you identified in Block 1 fixed? If yes: what replaced it? If no: is it showing up in exactly the same situation or a new one? PASS: Write a specific update on the habit\'s current state â€” changed, mutated, or eliminated. "I think it\'s better" doesn\'t pass. A specific observation from your footage passes.' },
    { id:'d31q3', pillar:'physical', milestone:'phys_hands', priority:'recommended', title:'Hand Care Mid-Program', time:3, xp:20, instructions:'Full stretch. Any accumulated tension? Ice or rest if anything is concerning. Don\'t play through pain.' },
  ],
  32: [
    { id:'d32q1', pillar:'competitive', milestone:'comp_review', priority:'core', title:'Set Autopsy â€” One Interaction', time:20, xp:80, instructions:'Week 5 theme: Applying Drills in Live Sets. After your next serious set: write a full post-set autopsy. PASS: Your write-up identifies the one interaction that most changed the outcome â€” specific percent, position, option chosen â€” AND names the drill that would address it. Rating your mental composure 1â€“10 is required. Four-sentence minimum per question.' },
    { id:'d32q2', pillar:'advantage', milestone:'adv_ledge', priority:'core', title:'Adaptive Ledge Trap â€” Read and Adjust', time:20, xp:70, instructions:'Play 3 sets. Rule: adjust your ledge trap option based on the last 2 options your opponent showed. If they rolled in twice, stop covering roll in. PASS: After each set, write your ledge trap adjustments and how many times you successfully punished an option they thought you weren\'t covering. Each successful read = evidence the adjustment worked.' },
    { id:'d32q3', pillar:'tech', milestone:'tech_pressure', priority:'core', title:'Tech Under Live Pressure â€” Forced Attempts', time:25, xp:80, instructions:'In your next 3 sets: attempt your hardest Block 2 tech (platform cancel into aerial, or OOS punish, or RAR) at least 3 times per set â€” even in risky situations. You cannot wait for "the safe moment." PASS: Successfully execute it under pressure at least 6 times across 3 sets. Log attempt-to-success rate. Below 50% success means the tech isn\'t owned yet â€” it\'s only a training-mode skill.' },
    { id:'d32q4', pillar:'mental', milestone:'ment_focus', priority:'recommended', title:'Focus Window Optimization', time:5, xp:40, instructions:'When in your session are you sharpest? Use that window for your hardest sets. Schedule warmup and cooldown around it.' },
  ],
  33: [
    { id:'d33q1', pillar:'disadvantage', milestone:'dis_reads', priority:'core', title:'Escape Timing Adaptation â€” React to the Chase', time:30, xp:80, instructions:'Week 5 theme: Applying Drills in Live Sets. vs a training partner: they chase you in disadvantage using their real patterns, you practice escaping correctly. PASS: Survive 10 consecutive disadvantage sequences without dying â€” escape must be reactive to what they did, not a preset option. If you die, the count resets to 0. How many attempts to reach 10? That number is your disadvantage baseline.' },
    { id:'d33q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 11 â€” The Autopilot Moment', time:20, xp:100, instructions:'Watch a set and find the exact moment you went on autopilot. Not a stretch â€” the exact moment. What triggered it? Write the trigger and what changed after that moment vs before. The trigger is what you need to interrupt. Log it in the VOD tool.' },
    { id:'d33q3', pillar:'competitive', milestone:'comp_bracket', priority:'recommended', title:'Tournament Simulation â€” Emotional Baseline', time:30, xp:70, instructions:'5+ sets, tournament rules. Record your emotional state at each moment of pressure â€” first set, down a stock, match point. That data is your mental baseline going into real bracket.' },
    { id:'d33q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 9', time:30, xp:35, instructions:'30 minutes, conversational pace. Week 5 â€” application block. Your body is adapting. Use this session to mentally rehearse your written game plan for your next set. Walk through it decision by decision. This is active visualization, not daydreaming. Log activity.' },
  ],
  34: [
    { id:'d34q1', pillar:'advantage', milestone:'adv_kills', priority:'core', title:'Kill Confirm Under Real Pressure', time:25, xp:80, instructions:'Week 5 theme: Applying Drills in Live Sets. Drill kill confirm at relevant percent â€” but rule: miss the confirm and the stock resets. Force yourself to wait for the confirm. PASS: Hit 12 clean kill confirms in a row without a miss-reset. Reset the count if you go for a raw kill instead of the confirm. How many total attempts to reach 12 clean? Log it.' },
    { id:'d34q2', pillar:'neutral', milestone:'neut_options', priority:'core', title:'Anti-Air Consistency â€” Now Automatic?', time:20, xp:70, instructions:'Anti-air response to full hop approaches (40 reps). PASS: 35/40 clean. By Block 3 this should be approaching automatic. If you\'re not hitting pass, the issue is timing anticipation, not knowledge â€” drill the timing input separately, not the punish.' },
    { id:'d34q3', pillar:'disadvantage', milestone:'dis_reads', priority:'core', title:'VOD â†’ Drill Loop: Disadvantage Death Autopsy', time:25, xp:90, instructions:'Open your most recent set footage. Find one disadvantage sequence where you died that was survivable. Watch it 5 times. Write exactly what option you should have taken. Go to training mode and drill that exact scenario â€” same setup, same percent, same character. PASS: Escape the setup cleanly 8/10 consecutive times. This is the elite training loop â€” every death contains a drill. Run the loop.' },
    { id:'d34q4', pillar:'physical', milestone:'phys_focus', priority:'recommended', title:'Physical-Performance Correlation', time:5, xp:30, instructions:'What physical variables correlate with your highest-focus sessions? Make those your Block 3 non-negotiables.' },
  ],
  35: [
    { id:'d35q1', pillar:'competitive', milestone:'comp_boss', priority:'core', title:'âš”ï¸ BOSS BATTLE â€” Week 5', time:45, xp:250, instructions:'BOSS DAY. Bo5 â€” your partner knows your game now. They\'ve watched you improve. Play like your identity statement. After: what was the hardest adjustment they forced on you? What trained skill showed up most reliably under real pressure? Write specifically.' },
    { id:'d35q2', pillar:'mental', milestone:'ment_tourney', priority:'core', title:'Pre-Tournament Ritual Build', time:10, xp:70, instructions:'Design your complete tournament day ritual: what you eat, when you arrive, warmup sequence, mental check-in before first set. Write it out. PASS: Your ritual is specific enough to follow as a checklist â€” not "warm up and focus" but "arrive 45 min early, 15 min training mode (neutral poke + combo tree), 2 sets vs someone I know, review matchup card for seed 1 threat, deep breath + identity statement before bracket starts."' },
    { id:'d35q3', pillar:'matchups', milestone:'mu_research', priority:'recommended', title:'Matchup Counter Research', time:15, xp:60, instructions:'Your hardest matchup: watch specifically for what the opponent does when YOUR typical option appears. Find the counter to your tendencies in that matchup.' },
  ],

  // â”€â”€ WEEK 6: Matchup Execution â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  36: [
    { id:'d36q1', pillar:'disadvantage', milestone:'dis_ledge', priority:'core', title:'Two-Frame Defense Drill', time:25, xp:70, instructions:'Week 6 theme: Matchup Execution. Know which of your opponent\'s moves two-frame YOUR ledge grab. Drill defending against it â€” use correct ledge options to avoid the two-frame (25 reps per option). PASS: 20/25 on each option without getting two-framed. If you\'re getting hit, the timing on your option choice is wrong â€” drill the timing of the option selection, not the option itself.' },
    { id:'d36q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 12 â€” Test Your Scout Report', time:20, xp:100, instructions:'Open your scout report on the player in your most recent set. Watch the set. Did they do what you predicted? Mark every prediction right or wrong. Update the report with what you saw. Log your prediction accuracy rate in the VOD tool.' },
    { id:'d36q3', pillar:'competitive', milestone:'comp_grind', priority:'recommended', title:'Disadvantage Application Sets', time:20, xp:60, instructions:'5+ sets. Focus: apply your disadvantage survival options from this block. Track escape rate vs death rate. That ratio should be better than Week 4.' },
    { id:'d36q4', pillar:'matchups', milestone:'mu_update', priority:'core', title:'ğŸ•µï¸ Scout Report â€” Post-Sets Reality Check', time:15, xp:90, instructions:'Open Local Scene Scouting. Update Match History for every player you\'ve faced since Day 20. Then correct anything in Neutral or Advantage that real sets proved wrong. PASS: At least one correction made per player â€” theory always has gaps. If you have zero corrections, you haven\'t looked hard enough at the gap between what you predicted and what actually happened.' },
    { id:'d36q5', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 10', time:30, xp:35, instructions:'30 minutes. Double digits. Log: activity, and write your honest answer to this â€” has cardio changed anything about your play or how you feel during long sessions? No answer is wrong. Honest data is the point. If you haven\'t noticed anything, that\'s also information.' },
  ],
  37: [
    { id:'d37q1', pillar:'matchups', milestone:'mu_drilling', priority:'core', title:'Shadow Box Hard Matchup â€” Verbalize the Plan', time:20, xp:70, instructions:'Week 6 theme: Matchup Execution. Shadow box your hardest matchup â€” narrate the game plan out loud. "They\'ll approach with X, I respond with Y. They edgeguard with Z, I DI to recover at angle A." PASS: Complete a full narrated game plan covering their neutral approach, their advantage state, their edgeguard, and your counterplay to each. If you blank on any section, that blank is what you watch film on tonight.' },
    { id:'d37q2', pillar:'mental', milestone:'ment_identity', priority:'core', title:'Identity Check â€” Does Your Play Match Your Statement?', time:10, xp:60, instructions:'Mental training week 6: review your identity statement. Play a session and after each set, write one sentence on whether your play matched the statement or contradicted it. PASS: After 5 sets, you have 5 sentences â€” at least 3 showing the statement held under pressure. If it consistently breaks down in specific situations, that situation is your mental training focus for Block 4.' },
    { id:'d37q3', pillar:'physical', milestone:'phys_hydration', priority:'recommended', title:'Physical Maintenance Check', time:3, xp:20, instructions:'Water + pre-session meal check. Block 3 is the hardest part of the program â€” physical maintenance matters more now.' },
  ],
  38: [
    { id:'d38q1', pillar:'competitive', milestone:'comp_prep', priority:'core', title:'Apply Matchup Cards at Locals â€” Real Test', time:15, xp:80, instructions:'Week 6 theme: Matchup Execution. At your next local: before each set, review that character\'s matchup card. Play your written game plan â€” not your instincts. PASS: After bracket, update the card with what you learned. Write specifically what the plan got right, what it got wrong, and what adjustment you\'ll make for the next time you face that character. A card you didn\'t update didn\'t teach you anything.' },
    { id:'d38q2', pillar:'advantage', milestone:'adv_juggle', priority:'core', title:'DI Chase Drills â€” Read the Tell', time:25, xp:70, instructions:'Reading DI during juggle â€” chase left vs right (30 reps each). PASS: 24/30 correct reads on each direction. What is the visual tell that tells you which direction they\'re DI\'ing? Write it specifically. If you can\'t name the tell, you\'re guessing â€” guessing gets you to 50%, not 80%.' },
    { id:'d38q3', pillar:'mental', milestone:'ment_tilt', priority:'core', title:'Tilt Exposure Training â€” Medium Pressure', time:15, xp:60, instructions:'Mental training week 6: step up the pressure from Day 20. Play a set against your hardest matchup with a specific pressure rule: if you go up a game, intentionally play more conservatively on the next game (to simulate protecting a lead). When tilt appears â€” execute your reset routine. PASS: Execute your reset routine at least 4 times AND reflect afterward: did it reduce tilt faster or slower than on Day 20? If slower, identify what changed and rewrite one element of the routine.' },
  ],
  39: [
    { id:'d39q1', pillar:'matchups', milestone:'mu_update', priority:'core', title:'Update Cards After Sets â€” Theory vs Reality', time:15, xp:70, instructions:'Week 6 theme: Matchup Execution. After this week\'s sessions: update every matchup card you faced. PASS: Every updated card has at least one thing the theory didn\'t predict but real sets taught you. Unchanged cards after real sets means you\'re not learning from your games.' },
    { id:'d39q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 13 â€” 5-Week Progress Audit', time:20, xp:100, instructions:'Pull up the earliest footage you have. Compare to something from this week. Name 3 concrete differences in how you play â€” not feelings, specific visible changes in options, positioning, or execution. Log them in the VOD tool.' },
    { id:'d39q3', pillar:'competitive', milestone:'comp_bracket', priority:'recommended', title:'Simulation with Stakes', time:25, xp:70, instructions:'Bracket simulation with real stakes â€” loser does warmup laps, or any consequence that creates real pressure. Pressure = practice for tournament nerves.' },
  ],
  40: [
    { id:'d40q1', pillar:'competitive', milestone:'comp_review', priority:'core', title:'Tournament Analysis â€” 3 Rights Before Wrongs', time:15, xp:80, instructions:'Week 6 theme: Matchup Execution. After your most recent tournament or serious session: list 3 things that went RIGHT before you write a single thing that went wrong. Then write the ONE adjustment that would have changed your result most. PASS: The adjustment is specific enough to design a drill around â€” not "I need to play better under pressure" but "I need to stop going for raw smash attacks when I have the kill percent opening and start confirming into the actual confirm."' },
    { id:'d40q2', pillar:'tech', milestone:'tech_platform', priority:'core', title:'Platform Tech in Live Sets â€” Intentional Use', time:20, xp:70, instructions:'In your next 3 live sets: use platform tech (cancel, drop, aerial through) at least 5 times each set â€” not accidentally, intentionally. PASS: After 3 sets, you used platform tech intentionally at least 15 times and can describe each usage. "I platform dropped into Nair to cross them up on wakeup in game 2" counts. "I did some platform stuff" doesn\'t.' },
    { id:'d40q3', pillar:'mental', milestone:'ment_journal', priority:'core', title:'Block 3 Journal Entry', time:10, xp:80, instructions:'Block 3 is almost done. Write at depth: What is the biggest concrete difference in how you play now vs Day 1 â€” point to specific footage if you can? What is the ONE remaining bad habit still showing up under pressure in live sets? That habit is your Block 4 target.' },
    { id:'d40q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 11', time:30, xp:35, instructions:'30 minutes, conversational pace. Block 3 final week. Your aerobic base should be noticeably better than Week 1 â€” same pace feels easier, recovery is faster. Log: activity, and compare how this session felt vs Session 1 on Day 4. Write one sentence on the difference.' },
  ],
  41: [
    { id:'d41q1', pillar:'matchups', milestone:'mu_drilling', priority:'core', title:'Matchup Game Plan â€” Plan Over Instincts', time:25, xp:70, instructions:'Week 6 theme: Matchup Execution. vs CPU: play your hardest matchup for 5 stocks using ONLY your written game plan. Every deviation from the plan: pause and write it. PASS: Complete 5 stocks with fewer than 3 deviations from your written plan. 3+ deviations means your instincts are still overriding your game plan â€” the plan needs more live reps before it becomes the default.' },
    { id:'d41q2', pillar:'advantage', milestone:'adv_review', priority:'core', title:'Persistent Conversion Drop â€” Final Block 3 Drill', time:25, xp:80, instructions:'Review your dropped conversion log from Block 3. What\'s the most persistent conversion you\'re still dropping in real sets? PASS: Drill that specific route (30 reps minimum) and hit an 85% clean rate before you stop. If you can\'t hit 85% in 30 reps, add 20 more. This conversion should be locked before Block 4 starts.' },
    { id:'d41q3', pillar:'physical', milestone:'phys_sleep', priority:'recommended', title:'Sleep Baseline Confirmation', time:3, xp:20, instructions:'20 days left. Confirm your sleep target is being hit. Sleep debt in the final block costs more than any missed drill.' },
  ],
  42: [
    { id:'d42q1', pillar:'competitive', milestone:'comp_boss', priority:'core', title:'âš”ï¸ BOSS BATTLE â€” Week 6', time:45, xp:250, instructions:'BOSS DAY. Bo5 â€” full tournament rules. After: write the difference between this set and Week 1\'s Boss Battle. Not feelings â€” specific: what technical skills showed up that didn\'t exist in Week 1? What game plan decisions were different? What mental moment was handled differently? That difference is 6 weeks of work, described specifically.' },
    { id:'d42q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 14 â€” Block 4 Entry Baseline', time:20, xp:100, instructions:'Watch your most recent full set. Write your honest current stats: neutral win rate (estimate), conversion rate, disadvantage escape rate, kill close-out rate. These four numbers are your Block 4 entry baseline. In 18 days they should all be measurably higher. Log them now in the VOD tool.' },
    { id:'d42q3', pillar:'physical', milestone:'phys_hands', priority:'recommended', title:'Hand Care â€” Final Block Prep', time:3, xp:20, instructions:'Full stretch. Block 4 is the highest intensity. Address anything building up before it starts.' },
  ],

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BLOCK 4: INTEGRATION (Days 43â€“60)
  // Week 7 Theme: FULL GAME INTEGRATION â€” everything working together
  // Week 8 Theme: TOURNAMENT-READY â€” pressure, mental mastery, peak performance
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // â”€â”€ WEEK 7: Full Game Integration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  43: [
    { id:'d43q1', pillar:'tech', milestone:'tech_combos', priority:'core', title:'Full Combo Tree Audit â€” 90% Standard', time:30, xp:90, instructions:'Week 7 theme: Full Game Integration. Run your complete combo tree â€” all routes, all weights. Grade each one. PASS: Every route must hit 90%+. Anything below 85% gets 30 reps before you close training mode. Write your grades. This is the integration block â€” you don\'t get to still drop combos at this stage and call yourself a top player.' },
    { id:'d43q2', pillar:'neutral', milestone:'neut_condition', priority:'core', title:'Neutral Autopilot Elimination â€” High Stakes', time:20, xp:80, instructions:'Week 7 theme: Full Game Integration. Play 3 sets with one rule: if you do your autopilot habit, the set is a loss regardless of the score. PASS: Complete 3 sets where you forced yourself to override the habit every time you felt it coming. Write after: how many times did you have to consciously override? That number should be going down from Week 5\'s baseline â€” if it\'s not, the habit is deeper than surface-level.' },
    { id:'d43q3', pillar:'mental', milestone:'ment_focus', priority:'recommended', title:'Block 4 Mental Reset', time:8, xp:50, instructions:'Final block. Set your Block 4 intention: what is the ONE thing you will improve most in these 18 days? Write it. Everything in Block 4 serves this intention.' },
    { id:'d43q4', pillar:'matchups', milestone:'mu_drilling', priority:'core', title:'ğŸ•µï¸ Scout Reports â†’ Muscle Memory', time:20, xp:100, instructions:'Open Local Scene Scouting. Read Your Game Plan for your two hardest opponents. Take their most common ledge getup option and drill the punish (30 reps). Then drill the answer to their neutral approach (25 reps). PASS: 25/30 on the ledge punish, 20/25 on the neutral answer. Your scouting reports are useless if they stay as text â€” today you turn one insight from each into muscle memory.' },
    { id:'d43q5', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 12', time:30, xp:35, instructions:'30 minutes. Block 4 opens. This is your peak intensity block â€” 18 days of integration and tournament prep. Cardio is non-negotiable here. Cognitive fatigue is the hidden variable in close sets. You\'ve built a base. Now maintain it through the finish. Log activity and duration.' },
  ],
  44: [
    { id:'d44q1', pillar:'competitive', milestone:'comp_grind', priority:'core', title:'Full Integration Sets â€” All Tools', time:35, xp:90, instructions:'Week 7 theme: Full Game Integration. No single focus â€” play full game with all tools. After each set: review one thing from each pillar (tech, neutral, advantage, mental). PASS: After 5 sets you have 5 reviews each covering all four pillars. A review that doesn\'t mention tech, neutral, advantage, AND mental doesn\'t count â€” this forces you to see your whole game, not just what felt good.' },
    { id:'d44q2', pillar:'matchups', milestone:'mu_update', priority:'core', title:'Matchup Card Final Update â€” Real Experience Only', time:15, xp:70, instructions:'Review every matchup card. Update with everything Blocks 2-3 taught you. PASS: Every card has at least one entry that says "Theory said X, real sets showed Y." Cards with no corrections were either never played or you weren\'t paying attention in your sets.' },
    { id:'d44q3', pillar:'physical', milestone:'phys_focus', priority:'recommended', title:'Peak Performance Audit', time:5, xp:30, instructions:'What conditions produce your best play? Use Block 4 to specifically practice during your peak focus window. Quality over quantity in the final stretch.' },
  ],
  45: [
    { id:'d45q1', pillar:'advantage', milestone:'adv_combos', priority:'core', title:'Advantage State Integration â€” Convert Every Opening', time:25, xp:80, instructions:'Week 7 theme: Full Game Integration. Play 5 sets with one rule: every opening must be converted into a combo. If you fail to convert an opening, note it â€” that\'s a drop. PASS: In 5 sets, conversion rate is 80%+ of openings. Write your total openings and conversions. Below 80% at Day 45 means your advantage state still isn\'t integrated â€” it\'s still a drilling skill, not a live skill.' },
    { id:'d45q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 15 â€” Integration Check Against Baseline', time:20, xp:100, instructions:'Watch a set from this week. Use your Day 42 entry stats as benchmark. Is neutral win rate up? Conversion rate higher? Pick the stat that improved most and write what specifically changed in your play that caused it. Log the updated numbers in the VOD tool.' },
    { id:'d45q3', pillar:'matchups', milestone:'mu_drilling', priority:'recommended', title:'Matchup Card Application Check', time:15, xp:60, instructions:'In your next 3 sets vs local-scene characters: play exclusively from your matchup cards. No improvising â€” game plan only. Update the card where the plan didn\'t hold up.' },
  ],
  46: [
    { id:'d46q1', pillar:'mental', milestone:'ment_tourney', priority:'core', title:'Tournament Pressure Simulation â€” Hard Stress Test', time:35, xp:90, instructions:'Week 7 theme: Full Game Integration. Mental training week 7: maximum pressure simulation. 5 sets, tournament rules, real stakes (agree on a consequence with your training partner beforehand). You must be down at some point in the session â€” intentionally put yourself in a deficit. Execute your tilt reset routine when tilt appears. PASS: You executed your reset routine at least 5 times AND it was effective each time (you can feel the difference). If the routine isn\'t reducing tilt, you rewrite it tonight and test it again tomorrow.' },
    { id:'d46q2', pillar:'disadvantage', milestone:'dis_reads', priority:'core', title:'Disadvantage Mastery Check â€” Baseline vs Now', time:20, xp:80, instructions:'Play 3 sets tracking only your disadvantage state. How many times did you survive vs die? PASS: Your escape rate is at least 20% higher than your Day 9 baseline. If it\'s not, what specific setup is still killing you? That setup gets a 30-rep drill today.' },
    { id:'d46q3', pillar:'neutral', milestone:'neut_film', priority:'recommended', title:'Block 4 Neutral Footage Compare', time:15, xp:60, instructions:'Watch footage from this week vs Block 1. Write 3 specific improvements you can point to in the footage. Not feelings â€” visible differences in options, positioning, or decision-making.' },
    { id:'d46q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 13', time:30, xp:35, instructions:'30 minutes, conversational pace. Week 7 â€” you\'re in the hardest mental stretch of the program. Cardio is active stress regulation. Use this time to decompress from the intensity of this block. No mental rehearsal required today â€” just move and breathe. Log activity.' },
  ],
  47: [
    { id:'d47q1', pillar:'competitive', milestone:'comp_boss', priority:'core', title:'âš”ï¸ BOSS BATTLE â€” Week 7', time:45, xp:250, instructions:'BOSS DAY. The most important Bo5 of the program. You\'re different now â€” play like it. After: write an honest assessment. Are you a top player in your local scene? Not "maybe" â€” what specific things would a top player say you\'ve clearly mastered, and what specific things would they say are still missing? Both answers tell you exactly what Week 8 is for.' },
    { id:'d47q2', pillar:'mental', milestone:'ment_journal', priority:'core', title:'Week 7 Reflection', time:10, xp:80, instructions:'Three questions: What is the hardest thing you\'ve done in this program? What would Day 1 you think of your play right now â€” specifically? What do you need to close out these final 13 days strong â€” one skill, one habit, one mental thing?' },
    { id:'d47q3', pillar:'physical', milestone:'phys_hydration', priority:'recommended', title:'Physical Habits Final Check', time:3, xp:20, instructions:'All 4 physical habits should be fully automatic. If any aren\'t, they need daily attention for the final push.' },
  ],

  // â”€â”€ WEEK 8: Tournament-Ready â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  48: [
    { id:'d48q1', pillar:'tech', milestone:'tech_charmech', priority:'core', title:'Character Mechanic Mastery â€” Pressure Test', time:25, xp:80, instructions:'Week 8 theme: Tournament-Ready. Your primary character mechanic â€” record 2 sets and count: how many times attempted vs how many times executed cleanly. PASS: 75%+ execution rate under match conditions. Below 75% means it\'s still a training-mode skill â€” 30 reps immediately to address the gap, then retest in your next set.' },
    { id:'d48q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 16 â€” Clutch Moment Analysis', time:20, xp:100, instructions:'Watch a close set â€” last stock, last game. Watch only the final stock of the final game. Was your decision-making better or worse than earlier in the set? Write exactly what fell apart in clutch moments and your mental state at that time. That is what you are fixing before Day 60. Log it in the VOD tool.' },
    { id:'d48q3', pillar:'matchups', milestone:'mu_update', priority:'recommended', title:'Matchup Cards Final Update', time:10, xp:50, instructions:'Update every matchup card with Block 3 insights. Cards should reflect real match experience. If a field is still empty â€” fill it from memory of actual sets.' },
  ],
  49: [
    { id:'d49q1', pillar:'competitive', milestone:'comp_review', priority:'core', title:'Full Four-Lens Game Review', time:20, xp:90, instructions:'Week 8 theme: Tournament-Ready. Watch your most recent tournament set through all four lenses: tech (what dropped?), neutral (what patterns?), advantage (what conversions?), mental (where did mindset change the outcome?). PASS: One specific fix identified per lens â€” four total. Each fix must be specific enough to drill or practice. Vague observations don\'t count.' },
    { id:'d49q2', pillar:'neutral', milestone:'neut_spacing', priority:'core', title:'Spacing Mastery Confirmation', time:20, xp:70, instructions:'Drill your max-range poke (30 reps at tip range). PASS: 26/30 with no punish received â€” same standard as Day 5, but should feel dramatically easier now. Then play 3 sets and count how many times you land it safely. Write the count. This number measures how much Day 2\'s isolation drill actually became a live skill.' },
    { id:'d49q3', pillar:'mental', milestone:'ment_tilt', priority:'core', title:'Tilt Exposure Training â€” Tournament Simulation', time:20, xp:70, instructions:'Mental training week 8: real tournament pressure. Set up a full bracket simulation with at least 2 other players. Play your bracket run. When tilt appears â€” your reset routine is your only tool. After: did the routine hold under real bracket pressure? PASS: You used the routine at least 3 times in bracket AND you can describe whether it worked each time. If it failed, write exactly why and what you\'ll change for Day 59\'s Boss Battle.' },
  ],
  50: [
    { id:'d50q1', pillar:'competitive', milestone:'comp_prep', priority:'core', title:'Tournament Game Plan â€” Complete Battle Plan', time:15, xp:90, instructions:'Week 8 theme: Tournament-Ready. Write your complete tournament game plan for your next local: warmup sequence, mental ritual, game plan vs your top 3 most-likely opponents, tilt reset protocol. PASS: Every section is specific enough to execute without thinking. "Warm up" is not a warmup plan. "15 min training mode â€” neutral poke 20 reps, combo tree all routes once, then 2 sets vs [name]" is a warmup plan.' },
    { id:'d50q2', pillar:'disadvantage', milestone:'dis_film', priority:'core', title:'Disadvantage Final Footage Review', time:15, xp:70, instructions:'Watch your most recent disadvantage footage. You have 10 days left. What is the ONE disadvantage setup you still don\'t have a clean answer for? PASS: Name the setup specifically AND drill the answer (25 reps in training mode) today. That setup should not catch you in your Day 59 Boss Battle.' },
    { id:'d50q3', pillar:'physical', milestone:'phys_sleep', priority:'recommended', title:'Peak Physical State', time:3, xp:20, instructions:'10 days left. Sleep is non-negotiable. Write it as a commitment: "I will sleep ___ hours every night until Day 60."' },
    { id:'d50q4', pillar:'matchups', milestone:'mu_update', priority:'core', title:'ğŸ•µï¸ Scout Report â€” Full Pre-Locals Audit', time:25, xp:110, instructions:'Open Local Scene Scouting. Read every report front to back. PASS: Every player at 70%+ completion AND you can recite the one-sentence game plan for your top 2 hardest opponents without looking. Close the app and say it out loud. If you blank â€” that\'s who knocks you out. Study them tonight.' },
  ],
  51: [
    { id:'d51q1', pillar:'tech', milestone:'tech_dash', priority:'core', title:'Movement Tech Integration â€” In Toolkit, Not Training Mode', time:20, xp:70, instructions:'Week 8 theme: Tournament-Ready. Play 3 sets and consciously use RAR, perfect dashâ†’tilt, and turnaround smash in live play. PASS: Each movement tech appears at least 3 times across 3 sets â€” 9 total conscious deployments. Write each usage: "RAR bair in game 2 to cover their landing." If a tech never appeared, it\'s not in your toolkit yet.' },
    { id:'d51q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 17 â€” Name the Last Weakness', time:20, xp:100, instructions:'Watch two recent sets. Find your most persistent remaining bad habit â€” the thing that shows up even when you\'re playing well. PASS: Name it with exact specificity. "I get sloppy" fails. "I dash attack when I get hit and want to reset the situation" passes. That named habit is your final target. Log it in the VOD tool.' },
    { id:'d51q3', pillar:'mental', milestone:'ment_identity', priority:'recommended', title:'Final Identity Statement', time:8, xp:50, instructions:'Read your Block 1 identity statement. Is it still true? Write the final version â€” the most accurate description of the player you\'ve become.' },
    { id:'d51q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 14', time:30, xp:35, instructions:'30 minutes. 9 days left. Your aerobic base is built. Log this session and compare your resting heart rate now vs when you started â€” if you\'ve been consistent, it should be lower. Lower resting HR means faster recovery between sets in a bracket. That\'s the tangible payoff. Log activity.' },
  ],
  52: [
    { id:'d52q1', pillar:'competitive', milestone:'comp_boss', priority:'core', title:'âš”ï¸ BOSS BATTLE â€” Week 8', time:45, xp:250, instructions:'BOSS DAY. Final Boss Battle before the closing run. Play your best. After: compare this set mentally to Week 1\'s Boss Battle. Write the difference you feel â€” not just "I played better" but "In Week 1 I had no answer to their approach. Today I baited it 4 times and punished 3 of them. Here\'s the specific moment it happened..."' },
    { id:'d52q2', pillar:'advantage', milestone:'adv_review', priority:'core', title:'Final Advantage Leak Fix', time:20, xp:80, instructions:'What conversion are you still dropping in live sets? PASS: 30 reps of that specific route AND 3 sets with one focus: convert that opening every time it appears. Your pass rate on the opening in live sets must be above 80%. Write your live conversion rate.' },
    { id:'d52q3', pillar:'neutral', milestone:'neut_condition', priority:'recommended', title:'Final Habit Elimination Check', time:12, xp:60, instructions:'What neutral habit still resurfaces under pressure? 3 sets â€” if the habit appears, write it down immediately. Data is correction. How often is it showing up compared to Week 5?' },
  ],
  53: [
    { id:'d53q1', pillar:'tech', milestone:'tech_combos', priority:'core', title:'Combo Reliability â€” 95% Standard', time:30, xp:80, instructions:'Week 8 theme: Tournament-Ready. Full combo tree â€” every route, 10 reps each. PASS: 95%+ on your core routes (BnB, kill confirm, juggle extension). Anything below 90% gets drilled to 90% before you stop. Log your grades. There should be visible improvement from Day 43\'s audit â€” if there isn\'t, you haven\'t been drilling the weak routes.' },
    { id:'d53q2', pillar:'competitive', milestone:'comp_grind', priority:'core', title:'Integration Sets â€” Practice vs Live Gap', time:30, xp:80, instructions:'10 sets â€” full game, all tools. After each set: score yourself 1â€“10 on how well your practice matched your live play. PASS: Average score of 7+. Below 7 means your trained skills are not showing up consistently â€” the gap between drilling and live play is your final frontier.' },
    { id:'d53q3', pillar:'mental', milestone:'ment_journal', priority:'recommended', title:'53-Day Journal Entry', time:8, xp:60, instructions:'7 days left. Write what you know now that you didn\'t know on Day 1 â€” explain it like you\'re writing to Day 1 yourself. That gap is your growth.' },
  ],
  54: [
    { id:'d54q1', pillar:'disadvantage', milestone:'dis_escape', priority:'core', title:'Disadvantage Final Check â€” Escape Rate vs Day 9', time:20, xp:70, instructions:'Week 8 theme: Tournament-Ready. 3 sets tracking only disadvantage state. PASS: Escape rate is at least 30% higher than your Day 9 baseline that you logged in VOD Session 3. Write both numbers and the gap. If the gap is under 30%, name the specific setup still killing you and drill it today.' },
    { id:'d54q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 18 â€” Day 3 vs Day 54', time:20, xp:100, instructions:'Pull up Day 3 footage. Then watch Day 54 footage. Count occurrences of your Day 3 baseline mistake in each. If you can\'t find your Day 3 habit in Day 54 footage â€” that is your proof. Write what changed, what it took, and what is left. Log your final comparison in the VOD tool.' },
    { id:'d54q3', pillar:'physical', milestone:'phys_focus', priority:'recommended', title:'Focus Optimization Final', time:5, xp:30, instructions:'Schedule your most important sessions this final week during your peak focus window. Protect your performance conditions.' },
  ],
  55: [
    { id:'d55q1', pillar:'competitive', milestone:'comp_review', priority:'core', title:'Pattern Across All Brackets â€” The One Thing', time:15, xp:90, instructions:'Week 8 theme: Tournament-Ready. Review every bracket write-up you\'ve done in 55 days. What pattern appears across ALL of them? PASS: Name the single thing that has ended more sets for you than anything else â€” and write a 30-rep drill or practice protocol addressing it for today. If you can\'t find a pattern, you haven\'t been writing specific enough post-set reviews.' },
    { id:'d55q2', pillar:'matchups', milestone:'mu_drilling', priority:'core', title:'Hardest Matchup â€” Final Session', time:25, xp:70, instructions:'Your hardest matchup â€” one final dedicated session. Drill the hardest specific scenario (30 reps). Then 3 sets vs CPU using ONLY your matchup card game plan. PASS: Hit 26/30 on the drill AND complete 3 sets with fewer than 2 deviations from the written plan each. This matchup should feel manageable now.' },
    { id:'d55q3', pillar:'mental', milestone:'ment_tourney', priority:'recommended', title:'Final Mental Ritual Run-Through', time:8, xp:50, instructions:'Run through your complete tournament ritual today as if you\'re about to enter bracket. It should feel automatic. If it doesn\'t, practice it two more times until it does.' },
    { id:'d55q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 15', time:30, xp:35, instructions:'30 minutes, conversational pace. 5 days out. Use this session to mentally run your complete tournament ritual â€” warmup sequence, matchup review, tilt reset protocol. By the time you step into bracket, this mental walk-through will have happened so many times it\'s automatic. Log activity.' },
  ],
  56: [
    { id:'d56q1', pillar:'advantage', milestone:'adv_juggle', priority:'core', title:'Juggle Conversion â€” Measure Against Week 3', time:20, xp:70, instructions:'Week 8 theme: Tournament-Ready. In your next 5 sets: count every juggle opportunity. How many converted vs dropped or escaped? PASS: 75%+ conversion rate. Write your exact rate. Compare it to your estimate from when you drilled juggles in Week 3 â€” that comparison is your improvement proof.' },
    { id:'d56q2', pillar:'neutral', milestone:'neut_aerial', priority:'core', title:'Aerial Spacing Final Check', time:15, xp:60, instructions:'Play 3 sets. Track: how many times did you get hit out of an aerial that should have been safe? PASS: Fewer than 5 unsafe aerials across 3 sets. More than 5 means aerial spacing is still a reflex problem. 30 reps of the specific aerial at the correct range before tomorrow.' },
    { id:'d56q3', pillar:'competitive', milestone:'comp_bracket', priority:'recommended', title:'Final Bracket Simulation', time:25, xp:70, instructions:'5 sets, tournament rules, real pressure. This is your final rehearsal. Play your best game â€” not training mode, not drilling. Your full game, fully integrated.' },
  ],
  57: [
    { id:'d57q1', pillar:'competitive', milestone:'comp_grind', priority:'core', title:'Final Grind â€” Target the Weakest Thing Left', time:25, xp:90, instructions:'Week 8 theme: Tournament-Ready. 3 days left. What is still the weakest part of your game? PASS: Spend this session focused specifically on that weakness. Not to fix it completely â€” to minimize its impact. Write at the end: what is it at now and what can you realistically reach by Day 60?' },
    { id:'d57q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 19 â€” Pre-Tournament Opponent Film', time:20, xp:100, instructions:'3 days out. Watch a recent set vs someone likely to be at your next local. This is opponent analysis, not self-analysis. What is their most reliable setup? What do they go to when winning vs losing? Build your mental game plan for the rematch. Log your read in the VOD tool.' },
    { id:'d57q3', pillar:'physical', milestone:'phys_hydration', priority:'recommended', title:'Physical Habits â€” Final Confirmation', time:3, xp:20, instructions:'Are all 4 habits automatic? Hydration, sleep, hand care, focus tracking. These are lifetime habits now.' },
    { id:'d57q4', pillar:'matchups', milestone:'mu_update', priority:'core', title:'ğŸ•µï¸ Scout Report â€” Memory Test', time:15, xp:100, instructions:'Open Local Scene Scouting. Read every game plan for every player likely to be at your next local. Close the app. Recite each player\'s game plan from memory out loud. PASS: You can recite the one-sentence game plan for every likely opponent without looking. Anyone you blank on is who knocks you out. Study them tonight.' },
  ],
  58: [
    { id:'d58q1', pillar:'tech', milestone:'tech_combos', priority:'core', title:'58-Day Combo Check â€” Before and After', time:20, xp:80, instructions:'Final combo audit. Run the full tree and record your scores. PASS: 90%+ on every route. Write your Day 1 combo ability (from memory of how it felt) vs today\'s grades. That gap is measurable proof of 58 days of work.' },
    { id:'d58q2', pillar:'competitive', milestone:'comp_review', priority:'core', title:'60-Day Program Review', time:20, xp:100, instructions:'Write a full review: what worked, what you\'d do differently, what surprised you. PASS: Include your biggest improvements in tech, neutral, advantage, disadvantage, mental, and matchup knowledge â€” one specific example per category. Vague reviews mean vague learning.' },
    { id:'d58q3', pillar:'mental', milestone:'ment_journal', priority:'core', title:'Final Journal Entry Prep', time:8, xp:60, instructions:'2 days left. Write: one thing you\'re proud of from this program, one thing you\'d do differently, and the single most important lesson you carry out of this 60-day run.' },
    { id:'d58q4', pillar:'physical', milestone:'phys_cardio', priority:'recommended', title:'Zone 2 Cardio â€” Session 16', time:30, xp:35, instructions:'30 minutes. Final cardio session of the program. 16 sessions over 60 days â€” that\'s a habit. Log it: activity, and write one sentence on what this habit did for your game. Then decide right now whether it continues after Day 60. Elite players don\'t have an off-season for their aerobic base. They just keep going.' },
  ],
  59: [
    { id:'d59q1', pillar:'competitive', milestone:'comp_boss', priority:'core', title:'âš”ï¸ FINAL BOSS BATTLE â€” Day 59', time:60, xp:300, instructions:'THE FINAL BOSS BATTLE. Full Bo5 vs your best training partner. Play your absolute best game. After: write the difference between this set and Day 7\'s Boss Battle. Not feelings â€” specific: what technical skills exist now that didn\'t in Week 1? What neutral decisions were different? What mental moment was handled better? That difference is 59 days of deliberate work described in your own words.' },
    { id:'d59q2', pillar:'mental', milestone:'ment_tourney', priority:'core', title:'Top Player Mental Assessment', time:10, xp:80, instructions:'Answer honestly: Are you a top player now? What would a top player in your scene say you\'ve clearly mastered â€” name 3 specific things? What would they say is still missing â€” name 2? The honest answer to both tells you exactly what the next 60 days should target.' },
    { id:'d59q3', pillar:'physical', milestone:'phys_hands', priority:'recommended', title:'Final Hand Care', time:3, xp:20, instructions:'Full stretch. 59 days. Commit to maintaining hand care as a lifetime practice.' },
  ],
  60: [
    { id:'d60q1', pillar:'competitive', milestone:'comp_prep', priority:'core', title:'Day 60 â€” Top Player Protocol', time:15, xp:150, instructions:'Day 60. Before your final session: write out your complete game as a top player â€” tech strengths, neutral identity, advantage flowchart, disadvantage survival, matchup knowledge. PASS: Every section is specific enough that someone who reads it could describe your game without ever having watched you play. Vague player profiles are for players who don\'t know themselves yet. You\'ve had 60 days.' },
    { id:'d60q2', pillar:'competitive', milestone:'comp_vod', priority:'core', title:'ğŸ“Š VOD Session 20 â€” The Final Review', time:20, xp:100, instructions:'Last one. Watch your Day 59 Boss Battle footage. Write the answer to one question: "What would have made this game unwinnable for my opponent?" That answer is your top player identity â€” the thing you do better than almost everyone in your local scene after 60 days of deliberate work. Log it in the VOD tool. Then close it. You know what you are now.' },
    { id:'d60q3', pillar:'competitive', milestone:'comp_grind', priority:'core', title:'Day 60 â€” Play Your Best Game', time:30, xp:200, instructions:'Final session. No single focus, no drills, no goals except one: play the best game you\'ve ever played. Apply everything. This is what 60 days of work looks like in practice. Measure yourself honestly. Then plan Day 61.' },
  ],
};


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUEST GENERATION
// Returns today's quests from the schedule, with fallback generator
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateTodayQuests(day) {
  const profile = state.profile || {};
  const timePerDay = profile.timePerDay || '1hr';
  const isBehind = getMissedDays() > 2;

  // Get scheduled quests
  let quests = (QUEST_SCHEDULE[day] || QUEST_SCHEDULE[Math.min(day, 60)] || []).slice();

  // If behind, only show core quests
  if (isBehind) {
    quests = quests.filter(q => q.priority === 'core');
  }

  // Trim by time available
  const maxQ = timePerDay === '30min' ? 2 : timePerDay === '1hr' ? 3 : timePerDay === '2hr' ? 4 : 5;
  quests = quests.slice(0, maxQ);

  // Every 7 days: Boss Battle is always first (already in schedule)
  return quests;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MILESTONE PROGRESS â€” Core linking function
// When a quest is completed, this adds 1 rep to the linked milestone.
// The milestone progress is stored in state.milestoneReps[milestoneId].
// When reps >= milestone.total, the milestone is "complete".
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getMilestone(pillarId, milestoneId) {
  const pillar = PILLARS.find(p => p.id === pillarId);
  if (!pillar) return null;
  return pillar.milestones.find(m => m.id === milestoneId) || null;
}

function getMilestoneProgress(milestoneId) {
  return state.milestoneReps[milestoneId] || 0;
}

function getMilestonePct(milestone) {
  const reps = getMilestoneProgress(milestone.id);
  return Math.min(100, Math.round((reps / milestone.total) * 100));
}

function getPillarPct(pillar) {
  if (!pillar.milestones || pillar.milestones.length === 0) return 0;
  const total = pillar.milestones.reduce((s, m) => s + getMilestonePct(m), 0);
  return Math.round(total / pillar.milestones.length);
}

function getGlobalPct() {
  const pcts = PILLARS.map(p => getPillarPct(p));
  return Math.round(pcts.reduce((s, v) => s + v, 0) / pcts.length);
}

function completeQuestMilestone(quest) {
  // Add 1 rep to the linked milestone
  const milestoneId = quest.milestone;
  if (!milestoneId) return;
  const milestone = getMilestone(quest.pillar, milestoneId);
  if (!milestone) return;
  const current = state.milestoneReps[milestoneId] || 0;
  if (current < milestone.total) {
    state.milestoneReps[milestoneId] = current + 1;
    // Check if milestone just completed
    if (state.milestoneReps[milestoneId] >= milestone.total) {
      setTimeout(() => {
        showToast(`ğŸ† MILESTONE COMPLETE: ${milestone.name}!`, 'gold');
        spawnParticles(window.innerWidth/2, window.innerHeight/3, '#f5c842', 50);
      }, 400);
    }
  }
}



// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// XP SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const XP_LEVELS = [
  { name: 'Recruit',   min: 0 },
  { name: 'Contender', min: 500 },
  { name: 'Threat',    min: 1500 },
  { name: 'Competitor',min: 3000 },
  { name: 'Local King',min: 6000 },
  { name: 'Regional',  min: 10000 },
  { name: 'Top Player',min: 15000 },
];

function getXpLevel(xp) {
  let level = XP_LEVELS[0];
  for (const l of XP_LEVELS) { if (xp >= l.min) level = l; }
  return level;
}

function getXpProgress(xp) {
  const levels = XP_LEVELS;
  for (let i = 0; i < levels.length - 1; i++) {
    if (xp < levels[i+1].min) {
      const range = levels[i+1].min - levels[i].min;
      const progress = xp - levels[i].min;
      return Math.round((progress / range) * 100);
    }
  }
  return 100;
}

function addXp(amount) {
  const prev = getXpLevel(state.xp);
  state.xp += amount;
  const curr = getXpLevel(state.xp);
  if (curr.name !== prev.name) {
    showToast(`ğŸ‰ RANK UP â†’ ${curr.name}!`, 'gold');
  }
  saveState();
  updateHeader();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ONBOARDING LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let obCurrentStep = 0;
const obAnswers = {};

function updateObDots() {
  const dots = document.getElementById('obDots');
  const total = 5;
  dots.innerHTML = '';
  for (let i = 0; i < total; i++) {
    const d = document.createElement('div');
    d.className = 'ob-dot' + (i === obCurrentStep ? ' active' : i < obCurrentStep ? ' done' : '');
    dots.appendChild(d);
  }
}

function selectOption(key, value, el) {
  obAnswers[key] = value;
  el.closest('.ob-options').querySelectorAll('.ob-opt').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
}

function nextStep(n) {
  try {
    var cur = document.getElementById('step' + obCurrentStep);
    if (cur) cur.classList.remove('active');
    obCurrentStep = n;
    var nxt = document.getElementById('step' + n);
    if (nxt) nxt.classList.add('active');
    updateObDots();
  } catch(e) { console.error('nextStep:', e); }
}

function selectFirstDay(isToday) {
  try {
    if (isToday) {
      obAnswers.startDate = new Date().toISOString().split('T')[0];
      nextStep(1);
    } else {
      document.getElementById('existingDatePicker').style.display = 'block';
      var di = document.getElementById('startDateInput');
      di.max = new Date().toISOString().split('T')[0];
      di.value = new Date(Date.now() - 7*86400000).toISOString().split('T')[0];
    }
  } catch(e) { console.error('selectFirstDay:', e); }
}

function confirmExistingStart() {
  const val = document.getElementById('startDateInput').value;
  if (!val) return;
  obAnswers.startDate = val;
  nextStep(1);
}

function finishOnboarding() {
  try {
    var char = document.getElementById('characterInput').value.trim() || '?';
    var name = document.getElementById('playerNameInput').value.trim() || 'Player';
    state.startDate = obAnswers.startDate || new Date().toISOString().split('T')[0];
    state.profile = { name: name, character: char, timePerDay: obAnswers.timePerDay || '1hr', level: obAnswers.level || 'intermediate', goal: obAnswers.goal || 'improve' };
    state.streak = 1;
    state.lastLogin = new Date().toDateString();
    state.xp = 0;
    saveState();
    launchAppEnhanced();
  } catch(e) { console.error('finishOnboarding:', e); try { launchAppEnhanced(); } catch(e2) {} }
}

updateObDots();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP LAUNCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function launchAppBase() {
  document.getElementById('onboardScreen').classList.add('hidden');
  document.getElementById('appScreen').classList.add('visible');

  currentDay = getActualCurrentDay();
  updateStreak();
  buildNav();
  buildMain();
  updateHeader();
  showSection('today');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PILLAR JOURNALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PILLAR_JOURNALS = {
  tech: [
    "Which tech drill felt most inconsistent today? Describe the exact moment it breaks down â€” timing, positioning, or mental?",
    "Are you executing clean in training but dropping in real sets? What's different about the two contexts?",
    "Name one tech mechanic you've been avoiding because it's uncomfortable. What would change if you locked it in?",
  ],
  neutral: [
    "What is the most common way your opponent gets in on you? What's your actual answer â€” not your intended answer?",
    "Describe the last neutral interaction you lost that you should have won. What assumption were you running on?",
    "What pattern are you running on autopilot that opponents are starting to read? What replaces it?",
  ],
  mental: [
    "What was the first moment your focus dropped today? What happened right before it?",
    "Did you stay on your game plan the whole session, or did you start playing emotionally after a loss?",
    "Rate your composure today 1-10. What specific moment earned or lost you those points?",
  ],
  advantage: [
    "How many advantage states did you convert vs reset to neutral today? Be honest.",
    "Are you ending combos at the right time, or getting greedy and dropping to a punish?",
    "What is one edgeguard you should be taking more often but default to a safer option instead?",
  ],
  disadvantage: [
    "How many stocks did you lose offstage today that you could have survived? What were the DI or recovery mistakes?",
    "When you're getting combo'd, are you trying to escape early or just taking damage passively?",
    "What is your opponent's favorite way to kill you? Do you know the DI for it?",
  ],
  matchups: [
    "Which matchup in your local scene still confuses you? What specifically are you confused about?",
    "After reviewing your matchup notes â€” were your reads on that character's game plan correct, or does the note need updating?",
    "Describe a situation against your hardest matchup where you had no answer. What should the answer be?",
  ],
  competitive: [
    "What was the specific interaction that ended your deepest set? What do you drill this week because of it?",
    "Were you playing your game plan or your opponent's game plan in your last bracket?",
    "What's the difference between how you played in bracket vs practice? Is the gap shrinking?",
  ],
  physical: [
    "Did you eat and drink properly before today's session? Did it affect your focus?",
    "Rate your energy level at session start vs 30 minutes in. Was there a drop-off and why?",
    "What physical habit do you keep skipping that you know makes you play better?",
  ],
};

function stampAtomUIDs() {
  // No-op: new architecture uses milestone IDs, not atom UIDs
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let activeSection = 'today';

function buildNav() {
  const nav = document.getElementById('sidebarNav');
  nav.innerHTML = '';

  // Today nav
  const todayItem = document.createElement('div');
  todayItem.className = 'nav-item today-nav' + (activeSection === 'today' ? ' active' : '');
  todayItem.innerHTML = `<span class="nav-icon">âš¡</span><div class="nav-info"><div class="nav-name">Today's Quests</div><div class="nav-pct">Day ${currentDay} of 60</div></div>`;
  todayItem.onclick = () => showSection('today');
  nav.appendChild(todayItem);

  // Pillar nav
  const ptitle = document.createElement('div');
  ptitle.className = 'nav-section-title';
  ptitle.textContent = 'Pillars of Mastery';
  nav.appendChild(ptitle);

  PILLARS.forEach(p => {
    const pct = getPillarPct(p);
    const doneMilestones = p.milestones.filter(m => getMilestonePct(m) >= 100).length;

    const item = document.createElement('div');
    item.className = 'nav-item' + (activeSection === p.id ? ' active' : '');
    item.style.setProperty('--nav-pillar-color', p.color || 'var(--accent)');
    item.innerHTML = `
      <span class="nav-icon">${p.icon}</span>
      <div class="nav-info">
        <div class="nav-name">${p.name}</div>
        <div class="nav-pct" style="color:${p.color}">${doneMilestones}/${p.milestones.length} milestones Â· ${pct}%</div>
        <div class="nav-mini-bar"><div class="nav-mini-fill" style="width:${pct}%;background:${p.color};"></div></div>
      </div>
    `;
    item.onclick = () => showSection(p.id);
    nav.appendChild(item);
  });

  // Tools nav
  const ttitle = document.createElement('div');
  ttitle.className = 'nav-section-title';
  ttitle.textContent = 'Tools';
  nav.appendChild(ttitle);

  const tools = [
    { id: 'tool_matchups', icon: 'âš”ï¸', name: 'Matchup Anchors' },
    { id: 'tool_vodstats', icon: 'ğŸ“Š', name: 'VOD Stats & Charts' },
    { id: 'tool_vod', icon: 'ğŸ“¹', name: 'VOD Review' },
    { id: 'tool_locals', icon: 'ğŸ‘¥', name: 'Local Scene' },
    { id: 'tool_milestones', icon: 'ğŸ…', name: 'Milestones' },
    { id: 'tool_squad', icon: 'ğŸ¤', name: 'Squad' },
    { id: 'tool_pastsessions', icon: 'ğŸ“‹', name: 'Past Sessions' },
    { id: 'tool_reset', icon: 'âš ï¸', name: 'Reset Data' },
  ];
  tools.forEach(t => {
    const item = document.createElement('div');
    item.className = 'nav-item' + (activeSection === t.id ? ' active' : '');
    item.innerHTML = `<span class="nav-icon">${t.icon}</span><div class="nav-info"><div class="nav-name">${t.name}</div></div>`;
    item.onclick = () => showSection(t.id);
    nav.appendChild(item);
  });

  // R.O.B. Tutorial button
  const robBtn = document.createElement('div');
  robBtn.className = 'nav-item';
  robBtn.style.cssText = 'border-top:1px solid #1c1c30;margin-top:8px;';
  robBtn.innerHTML = '<span class="nav-icon">ğŸ¤–</span><div class="nav-info"><div class="nav-name" style="color:#ff3c3c;">R.O.B. Tutorial</div><div class="nav-pct">Replay the guide</div></div>';
  robBtn.onclick = function() { if (typeof robTutorial !== 'undefined') robTutorial.reset(); };
  nav.appendChild(robBtn);
}

function isPillarLocked(p) {
  return false; // All pillars unlocked â€” ROI-first access
}

function showSection(id) {
  activeSection = id;
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  const sec = document.getElementById('sec_' + id);
  if (sec) sec.classList.add('active');
  buildNav();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUILD MAIN CONTENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildMain() {
  const main = document.getElementById('mainContent');
  main.innerHTML = '';

  // TODAY section
  main.appendChild(buildTodaySectionEnhanced());

  // PILLAR sections
  PILLARS.forEach(p => main.appendChild(buildPillarSection(p)));

  // TOOL sections
  main.appendChild(buildVodStatsTool());
  main.appendChild(buildMatchupsTool());
  main.appendChild(buildVodTool());
  main.appendChild(buildLocalsTool());
  main.appendChild(buildMilestonesTool());
  main.appendChild(buildSquadSection());
  main.appendChild(buildPastSessionsTool());
  main.appendChild(buildResetTool());
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TODAY SECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildTodaySectionBase() {
  const sec = document.createElement('div');
  sec.className = 'section active';
  sec.id = 'sec_today';

  const block = getBlock(currentDay);
  const quests = generateTodayQuests(currentDay);
  const missed = getMissedDays();
  const globalPct = getGlobalPct(); // milestone-based
  const allDone = quests.every(q => state.dayCompletions[`quest_${currentDay}_${q.id}`]);
  const completedCount = quests.filter(q => state.dayCompletions[`quest_${currentDay}_${q.id}`]).length;
  const totalTime = quests.reduce((s,q)=>s+q.time,0);
  const xpLevel = getXpLevel(state.xp);

  // â”€â”€ HERO DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const hero = document.createElement('div');
  hero.className = 'home-hero';
  hero.innerHTML = `
    <div class="hero-top-row">
      <div class="hero-day-ring">
        <svg viewBox="0 0 120 120" class="ring-svg">
          <circle cx="60" cy="60" r="52" class="ring-bg"/>
          <circle cx="60" cy="60" r="52" class="ring-fill" style="stroke-dasharray:${Math.PI*2*52};stroke-dashoffset:${Math.PI*2*52*(1-globalPct/100)};"/>
        </svg>
        <div class="ring-inner">
          <div class="ring-day">${currentDay}</div>
          <div class="ring-of">of 60</div>
          <div class="ring-pct">${globalPct}%</div>
        </div>
      </div>
      <div class="hero-stats-col">
        <div class="hero-rank-badge">
          <span class="hrb-icon">âš¡</span>
          <div>
            <div class="hrb-rank">${xpLevel.name.toUpperCase()}</div>
            <div class="hrb-xp">${state.xp.toLocaleString()} XP</div>
          </div>
        </div>
        <div class="hero-stat-row">
          <div class="hsr-item">
            <div class="hsr-num">${state.streak || 0}<span class="hsr-fire">ğŸ”¥</span></div>
            <div class="hsr-label">Streak</div>
          </div>
          <div class="hsr-item">
            <div class="hsr-num">${60-currentDay}</div>
            <div class="hsr-label">Days Left</div>
          </div>
          <div class="hsr-item">
            <div class="hsr-num">${completedCount}/${quests.length}</div>
            <div class="hsr-label">Today</div>
          </div>
        </div>
        <div class="hero-quote">"${QUOTES[(currentDay-1) % QUOTES.length]}"</div>
      </div>
    </div>
    <div class="hero-block-banner hero-block-${block.cls}">
      <span class="hbb-label">${block.badgeLabel}</span>
      <span class="hbb-focus">${block.focus.split('.')[0]}.</span>
    </div>
  `;
  sec.appendChild(hero);

  // â”€â”€ PILLAR OVERVIEW GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const pgrid = document.createElement('div');
  pgrid.className = 'pillar-grid';

  // ROI-ordered pillars (most impactful first)
  const ROI_ORDER = ['tech', 'neutral', 'mental', 'competitive', 'advantage', 'disadvantage', 'matchups', 'review', 'physical', 'metagame'];
  const orderedPillars = [...PILLARS].sort((a,b) => {
    const ai = ROI_ORDER.indexOf(a.id); const bi = ROI_ORDER.indexOf(b.id);
    return (ai === -1 ? 99 : ai) - (bi === -1 ? 99 : bi);
  });

  orderedPillars.forEach((p, idx) => {
    const pct = getPillarPct(p);
    const roiColors = ['#ff3c3c','#ff3c3c','#f5c842','#2dcc70','#3c8dff','#3c8dff','#a855f7','#ff8c00','#2dcc70','#8888a8'];
    const color = roiColors[idx] || '#8888a8';
    const pill = document.createElement('div');
    pill.className = 'pg-item';
    pill.style.setProperty('--pill-color', color);
    pill.onclick = () => showSection(p.id);
    pill.innerHTML = `
      <div class="pg-icon">${p.icon}</div>
      <div class="pg-info">
        <div class="pg-name">${p.name}</div>
        <div class="pg-bar-wrap">
          <div class="pg-bar-fill" style="width:${pct}%;background:${color};"></div>
        </div>
        <div class="pg-pct" style="color:${color}">${pct}%</div>
      </div>
    `;
    pgrid.appendChild(pill);
  });
  sec.appendChild(pgrid);

  // â”€â”€ CATCH-UP ALERT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (missed > 2) {
    const alert = document.createElement('div');
    alert.className = 'catchup-alert';
    alert.innerHTML = `
      <div class="ca-icon">âš ï¸</div>
      <div class="ca-text">
        <div class="ca-title">CATCH-UP MODE â€” ${missed} DAYS BEHIND</div>
        System adjusted. Only CORE quests showing. No shame â€” just get one done right now.
      </div>
    `;
    sec.appendChild(alert);
  }

  // â”€â”€ TODAY'S QUESTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const qHeader = document.createElement('div');
  qHeader.className = 'quest-header-row';
  qHeader.innerHTML = `
    <div class="qhr-left">
      <div class="qhr-title">TODAY'S QUESTS</div>
      <div class="qhr-sub">${completedCount} of ${quests.length} complete Â· ~${totalTime} min</div>
    </div>
    <button class="qhr-spin-btn" onclick="showQuestionWheel()">ğŸ¡ SPIN</button>
  `;
  sec.appendChild(qHeader);

  // Quest progress bar
  const qpBar = document.createElement('div');
  qpBar.className = 'quest-progress-bar';
  qpBar.innerHTML = `<div class="qpb-fill" style="width:${quests.length ? Math.round(completedCount/quests.length*100) : 0}%"></div>`;
  sec.appendChild(qpBar);

  const questList = document.createElement('div');
  questList.className = 'quest-list';
  questList.id = 'todayQuestList';
  quests.forEach(q => questList.appendChild(buildQuestCard(q)));
  sec.appendChild(questList);

  // â”€â”€ PRE-MATCH BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const pmBtn = document.createElement('button');
  pmBtn.className = 'complete-session-btn';
  pmBtn.style.cssText = 'background:linear-gradient(135deg,#0d1a2e,#112233);border:2px solid var(--blue);color:var(--blue);margin-bottom:10px;';
  pmBtn.innerHTML = `<span>ğŸ® START MATCH SESSION</span><span style="font-size:0.7rem;opacity:0.7;font-family:'DM Mono',monospace;">Track your sets, take notes, review after</span>`;
  pmBtn.onclick = openPreMatchModal;
  sec.appendChild(pmBtn);

  // â”€â”€ COMPLETE SESSION BTN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const csBtn = document.createElement('button');
  csBtn.className = 'complete-session-btn' + (allDone ? ' done' : '');
  csBtn.id = 'completeSessionBtn';
  csBtn.innerHTML = allDone
    ? `<span>âœ“ DAY ${currentDay} LOCKED IN</span><span style="font-size:0.7rem;opacity:0.7;font-family:'DM Mono',monospace;">See you tomorrow</span>`
    : `<span>âš¡ MARK SESSION COMPLETE</span><span style="font-size:0.7rem;opacity:0.7;font-family:'DM Mono',monospace;">Earn ${quests.reduce((s,q)=>s+q.xp,0)} XP</span>`;
  csBtn.style.display = 'flex';
  csBtn.style.flexDirection = 'column';
  csBtn.style.gap = '2px';
  if (allDone) csBtn.disabled = true;
  csBtn.onclick = completeSession;
  sec.appendChild(csBtn);

  // â”€â”€ TOURNAMENT BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const tournamentDiv = document.createElement('div');
  tournamentDiv.innerHTML = renderTournamentButton();
  sec.appendChild(tournamentDiv.firstChild);

  // â”€â”€ ROADMAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const rdWrap = document.createElement('div');
  rdWrap.className = 'roadmap-section';
  rdWrap.innerHTML = `<div class="quest-section-title" style="margin-bottom:10px;">60-DAY ROADMAP</div>`;
  rdWrap.appendChild(buildRoadmap());
  sec.appendChild(rdWrap);

  // â”€â”€ WEEKLY CHECK-IN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const currentWeek = Math.ceil(currentDay / 7);
  if (currentDay % 7 === 0 && !state.weeklyCheckins[currentWeek]) {
    sec.appendChild(buildWeeklyCheckin(currentWeek));
  }

  return sec;
}

function buildQuestCard(q) {
  const isDone = !!state.dayCompletions[`quest_${currentDay}_${q.id}`];
  const card = document.createElement('div');
  card.className = 'quest-card' + (isDone ? ' completed' : '');
  card.id = `qcard_${q.id}`;

  card.innerHTML = `
    <div class="qc-header">
      <div class="qc-check ${isDone ? 'done' : ''}" onclick="toggleQuestDone('${q.id}', ${q.xp})">${isDone ? 'âœ“' : ''}</div>
      <div class="qc-info">
        <div class="qc-title ${isDone ? 'done' : ''}">${q.title}</div>
        <div class="qc-meta">
          <span class="qc-time">â± ${q.time} min</span>
          <span class="qc-xp">+${q.xp} XP</span>
          <span class="qc-tag ${q.priority}">${q.priority.toUpperCase()}</span>
          <span style="font-size:0.52rem;color:var(--text2);">${PILLARS.find(p=>p.id===q.pillar)?.icon || ''} ${PILLARS.find(p=>p.id===q.pillar)?.name || ''}</span>
        </div>
      </div>
      <button class="qc-expand-btn" onclick="toggleQuestExpand('${q.id}')">â–¼</button>
    </div>
    <div class="qc-body" id="qbody_${q.id}">
      <div class="qc-instructions">${q.instructions}</div>
    </div>
  `;
  
  // VOD quest special handling - click to open modal
  if (q.milestone === 'comp_vod') {
    card.style.cursor = 'pointer';
    card.addEventListener('click', (e) => {
      if (!e.target.closest('.qc-check') && !e.target.closest('.qc-expand-btn')) {
        openVODStatModal();
      }
    });
  }
  
  return card;
}

function advancePillarAtoms(pillarId, questXp) {
  // Legacy stub â€” replaced by completeQuestMilestone()
  // Called by old code paths; safe to no-op
}

function toggleQuestDone(qid, xp) {
  const key = `quest_${currentDay}_${qid}`;
  const wasDone = !!state.dayCompletions[key];
  state.dayCompletions[key] = !wasDone;
  if (!wasDone) {
    addXp(xp);
    // Find the quest and directly link to its milestone
    const todayQuests = generateTodayQuests(currentDay);
    const quest = todayQuests.find(q => q.id === qid);
    if (quest) {
      completeQuestMilestone(quest);
      const pillar = PILLARS.find(p => p.id === quest.pillar);
      const milestone = getMilestone(quest.pillar, quest.milestone);
      if (pillar && milestone) {
        const pct = getMilestonePct(milestone);
        showToast(`âœ… ${milestone.name} â€” ${pct}% Â· +${xp} XP`, 'success');
      }
    }
    updateGlobal();
    updateHeader();
  }
  saveState();
  // Re-render today section
  if (activeSection === 'today') {
    const sec = document.getElementById('sec_today');
    if (sec) {
      const newSec = buildTodaySectionEnhanced();
      newSec.classList.add('active');
      sec.replaceWith(newSec);
    }
  }
}

function toggleQuestExpand(qid) {
  const body = document.getElementById(`qbody_${qid}`);
  if (body) body.classList.toggle('open');
}

function completeSession() {
  const quests = generateTodayQuests(currentDay);
  quests.forEach(q => {
    const key = `quest_${currentDay}_${q.id}`;
    if (!state.dayCompletions[key]) {
      state.dayCompletions[key] = true;
      addXp(q.xp);
      completeQuestMilestone(q);  // Direct 1-to-1 milestone link
    }
  });
  state.dayCompletions[currentDay] = true;
  saveState();

  const totalXp = quests.reduce((s,q) => s+q.xp, 0);
  showCelebration(currentDay, totalXp);
  updateHeader();
  updateGlobal();

  setTimeout(() => showSessionJournalPrompt(), 2800);

  const sec = document.getElementById('sec_today');
  if (sec) {
    const newSec = buildTodaySectionEnhanced();
    newSec.classList.add('active');
    sec.replaceWith(newSec);
  }
}

function buildRoadmap() {
  const wrap = document.createElement('div');
  const legend = document.createElement('div');
  legend.className = 'roadmap-legend';
  legend.innerHTML = `
    <div class="roadmap-legend-item"><div class="roadmap-legend-dot" style="background:var(--green)"></div>Complete</div>
    <div class="roadmap-legend-item"><div class="roadmap-legend-dot" style="background:var(--accent)"></div>Today</div>
    <div class="roadmap-legend-item"><div class="roadmap-legend-dot" style="background:var(--border2)"></div>Upcoming</div>
  `;
  wrap.appendChild(legend);

  const strip = document.createElement('div');
  strip.className = 'roadmap-strip';
  for (let d = 1; d <= 60; d++) {
    const dot = document.createElement('div');
    dot.className = 'roadmap-day-dot';
    dot.title = `Day ${d} â€” ${getDayDate(d)}`;
    if (state.dayCompletions[d]) dot.classList.add('completed');
    else if (d === currentDay) dot.classList.add('current');
    else if (d > currentDay) dot.classList.add('locked');
    strip.appendChild(dot);
  }
  wrap.appendChild(strip);
  return wrap;
}

function buildWeeklyCheckin(week) {
  const div = document.createElement('div');
  div.className = 'weekly-checkin';
  div.style.marginTop = '28px';

  const questions = [
    `Week ${week} down. What's the single biggest improvement you made this week?`,
    `What's the #1 thing you need to fix going into Week ${week+1}?`,
    `On a scale of 1-10, how disciplined were you this week? What cost you points?`,
    `Write your game plan for next week in one sentence.`,
  ];

  const existing = state.weeklyCheckins[week] || {};

  div.innerHTML = `
    <h3>ğŸ“‹ WEEK ${week} CHECK-IN</h3>
    <p>End of week. Answer these honestly. Your answers save automatically.</p>
    ${questions.map((q, i) => `
      <div class="weekly-q">
        <label>${q}</label>
        <textarea class="weekly-textarea" placeholder="Your answer..." onblur="saveWeeklyAnswer(${week},${i},this.value)">${escHtml(existing[i] || '')}</textarea>
      </div>
    `).join('')}
    <button class="weekly-save-btn" onclick="markWeeklyDone(${week})">âœ“ SAVE WEEK ${week} CHECK-IN</button>
  `;
  return div;
}

function saveWeeklyAnswer(week, idx, val) {
  if (!state.weeklyCheckins[week]) state.weeklyCheckins[week] = {};
  state.weeklyCheckins[week][idx] = val;
  saveState();
}

function markWeeklyDone(week) {
  if (!state.weeklyCheckins[week]) state.weeklyCheckins[week] = {};
  state.weeklyCheckins[week].done = true;
  saveState();
  showToast('Week ' + week + ' check-in saved. ğŸ’ª', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PILLAR SECTIONS â€” Milestone-based, directly linked to quest completions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildPillarSection(p) {
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.id = 'sec_' + p.id;

  const pct = getPillarPct(p);
  const doneMilestones = p.milestones.filter(m => getMilestonePct(m) >= 100).length;

  // Header
  const hdr = document.createElement('div');
  hdr.className = 'pillar-header-row';
  hdr.style.setProperty('--pillar-color', p.color || 'var(--accent)');
  hdr.innerHTML = `
    <div class="pillar-icon">${p.icon}</div>
    <div class="pillar-title-block">
      <h2>${p.name}</h2>
      <p>${p.desc}</p>
    </div>
    <div class="pillar-stats-row">
      <div class="pstat"><div class="ps-num" style="color:${p.color}">${doneMilestones}</div><div class="ps-label">Mastered</div></div>
      <div class="pstat"><div class="ps-num">${p.milestones.length}</div><div class="ps-label">Total</div></div>
      <div class="pstat"><div class="ps-num" style="color:${p.color}">${pct}%</div><div class="ps-label">Progress</div></div>
    </div>
  `;
  sec.appendChild(hdr);

  // Overall pillar progress bar
  const barWrap = document.createElement('div');
  barWrap.className = 'pillar-overall-bar-wrap';
  barWrap.innerHTML = `
    <div class="pob-label"><span>Overall Progress</span><span style="color:${p.color}">${pct}%</span></div>
    <div class="pob-bar"><div class="pob-fill" style="width:${pct}%;background:${p.color};box-shadow:0 0 8px ${p.color}66;"></div></div>
  `;
  sec.appendChild(barWrap);

  // How quests link to this pillar
  const todayQuests = generateTodayQuests(currentDay);
  const linkedToday = todayQuests.filter(q => q.pillar === p.id);
  if (linkedToday.length > 0) {
    const linkBanner = document.createElement('div');
    linkBanner.className = 'pillar-quest-link-banner';
    linkBanner.innerHTML = `
      <span class="pqlb-icon">âš¡</span>
      <span><strong>${linkedToday.length} quest${linkedToday.length>1?'s':''} today</strong> feed this pillar â€” complete them on the Today tab to advance progress</span>
      <button class="pqlb-btn" onclick="showSection('today')">â†’ Go to Today</button>
    `;
    sec.appendChild(linkBanner);
  }

  // Milestones
  const milestonesTitle = document.createElement('div');
  milestonesTitle.className = 'milestones-section-title';
  milestonesTitle.textContent = 'MILESTONES';
  sec.appendChild(milestonesTitle);

  const milestonesGrid = document.createElement('div');
  milestonesGrid.className = 'milestones-grid';

  p.milestones.forEach((m, mi) => {
    const reps = getMilestoneProgress(m.id);
    const mpct = getMilestonePct(m);
    const complete = mpct >= 100;

    // Find which days in the schedule feed this milestone
    const feedingDays = [];
    for (let d = 1; d <= 60; d++) {
      const dq = QUEST_SCHEDULE[d] || [];
      if (dq.some(q => q.milestone === m.id)) feedingDays.push(d);
    }
    const nextDay = feedingDays.find(d => d >= currentDay);

    const card = document.createElement('div');
    card.className = 'milestone-card' + (complete ? ' complete' : '');
    card.style.setProperty('--mc-color', p.color || 'var(--accent)');
    card.innerHTML = `
      <div class="mc-header">
        <div class="mc-status">${complete ? 'âœ“' : (mpct > 0 ? 'â—' : 'â—‹')}</div>
        <div class="mc-info">
          <div class="mc-name">${m.name}</div>
          <div class="mc-desc">${m.desc}</div>
        </div>
      </div>
      <div class="mc-progress-row">
        <div class="mc-bar-wrap">
          <div class="mc-bar-fill" style="width:${mpct}%;background:${p.color};"></div>
        </div>
        <div class="mc-pct" style="color:${complete ? p.color : 'var(--text2)'}">${mpct}%</div>
      </div>
      <div class="mc-meta">
        <span class="mc-reps">${reps} / ${m.total} quest completions</span>
        ${complete ? '<span class="mc-done-tag">MASTERED</span>' : (nextDay ? `<span class="mc-next">Next: Day ${nextDay}</span>` : '')}
      </div>
    `;
    milestonesGrid.appendChild(card);
  });

  sec.appendChild(milestonesGrid);

  // Journal section
  sec.appendChild(buildJournalSection(p.id));

  return sec;
}

function buildJournalSection(pillarId) {
  const div = document.createElement('div');
  div.className = 'journal-section';
  div.id = 'journal_' + pillarId;
  renderJournalSection(div, pillarId);
  return div;
}

function renderJournalSection(div, pillarId) {
  const prompts = PILLAR_JOURNALS[pillarId] || [];
  const dk = String(currentDay);
  const dayChecks = (state.journalByDay[dk] && state.journalByDay[dk][pillarId]) || {};
  const dayAnswers = (state.journalAnswers[dk] && state.journalAnswers[dk][pillarId]) || {};

  div.innerHTML = `
    <h3>ğŸ““ Session Journal</h3>
    <p>Answer at least one after each session. This is where real correction happens.</p>
    <ul class="journal-prompts">
      ${prompts.map((prompt, i) => {
        const done = !!dayChecks[i];
        const ans = escHtml(dayAnswers[i] || '');
        return `
          <li class="jp-item">
            <div class="jp-question-row">
              <span class="jp-num">${i+1}.</span>
              <span class="jp-text">${prompt}</span>
              <div class="jp-check ${done ? 'done' : ''}" onclick="toggleJournalCheck('${pillarId}',${i})">${done?'âœ“':''}</div>
            </div>
            <textarea class="jp-answer" placeholder="Write your answer here â€” it saves automatically..." onblur="saveJournalAnswer('${pillarId}',${i},this.value)">${ans}</textarea>
          </li>
        `;
      }).join('')}
    </ul>
  `;
}

function toggleJournalCheck(pillarId, idx) {
  const dk = String(currentDay);
  if (!state.journalByDay[dk]) state.journalByDay[dk] = {};
  if (!state.journalByDay[dk][pillarId]) state.journalByDay[dk][pillarId] = {};
  const prev = !!state.journalByDay[dk][pillarId][idx];
  state.journalByDay[dk][pillarId][idx] = !prev;
  saveState();
  if (!prev) { addXp(25); showToast('Journal entry saved. +25 XP', 'success'); }
  const d = document.getElementById('journal_' + pillarId);
  if (d) renderJournalSection(d, pillarId);
}

function saveJournalAnswer(pillarId, idx, val) {
  const dk = String(currentDay);
  if (!state.journalAnswers[dk]) state.journalAnswers[dk] = {};
  if (!state.journalAnswers[dk][pillarId]) state.journalAnswers[dk][pillarId] = {};
  state.journalAnswers[dk][pillarId][idx] = val;
  saveState();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCENARIO PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildScenarioPanel() {
  const div = document.createElement('div');
  div.className = 'scenario-panel';
  div.id = 'scenarioPanel';
  renderScenarioPanel(div);
  return div;
}

function renderScenarioPanel(div) {
  const scenarios = state.scenarios || [];
  div.innerHTML = `
    <h3>ğŸ¯ Scenario Training Log</h3>
    <p class="sp-desc">Log every situation you had no answer for. Each one becomes a drill. The best players build drills from their own losses â€” not from guides.</p>
    <div class="scenario-add">
      <input class="scenario-input" id="scenarioInput" placeholder='e.g. "Fox runs at 80%, I shield, he grabs â€” no answer for that grab at that position"' />
      <button class="scenario-btn" onclick="addScenario()">+ ADD</button>
    </div>
    <ul class="scenario-list">
      ${scenarios.length === 0 ? '<li style="font-size:0.62rem;color:var(--text3);padding:10px 0;">No scenarios yet. Add your first situation.</li>'
        : scenarios.map((s,i) => `
          <li class="scenario-item">
            <div class="scenario-check ${s.done?'done':''}" onclick="toggleScenario(${i})">${s.done?'âœ“':''}</div>
            <span class="scenario-text ${s.done?'done-text':''}">${escHtml(s.text)}</span>
            <button class="scenario-del" onclick="deleteScenario(${i})">âœ•</button>
          </li>
        `).join('')}
    </ul>
  `;
  const inp = div.querySelector('#scenarioInput');
  if (inp) inp.addEventListener('keydown', e => { if (e.key === 'Enter') addScenario(); });
}

function addScenario() {
  const inp = document.getElementById('scenarioInput');
  if (!inp || !inp.value.trim()) return;
  if (!state.scenarios) state.scenarios = [];
  state.scenarios.push({ text: inp.value.trim(), done: false });
  saveState(); addXp(10);
  const panel = document.getElementById('scenarioPanel');
  if (panel) renderScenarioPanel(panel);
}

function toggleScenario(i) {
  if (state.scenarios[i]) { state.scenarios[i].done = !state.scenarios[i].done; if (state.scenarios[i].done) addXp(30); saveState(); }
  const panel = document.getElementById('scenarioPanel');
  if (panel) renderScenarioPanel(panel);
}

function deleteScenario(i) {
  state.scenarios.splice(i, 1); saveState();
  const panel = document.getElementById('scenarioPanel');
  if (panel) renderScenarioPanel(panel);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STAT TRACKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STAT_METRICS = [
  { key: 'dmgPerOpening',    label: 'Dmg/Opening',       unit: '',  color: '#c97aff', higherBetter: true  },
  { key: 'openingsPerStock', label: 'Openings/Stock',    unit: '',  color: '#ff3c3c', higherBetter: true  },
  { key: 'disadvStocks',     label: 'Stocks Lost Disadv',unit: '',  color: '#3c8dff', higherBetter: false },
  { key: 'edgeguardPct',     label: 'Edgeguard Conv%',   unit: '%', color: '#2dcc70', higherBetter: true  },
  { key: 'missedConfirms',   label: 'Missed Confirms',   unit: '',  color: '#f5c842', higherBetter: false },
];
let activeStatMetric = 'dmgPerOpening';

function buildStatTracker() {
  const wrap = document.createElement('div');
  wrap.className = 'stat-tracker-panel';
  wrap.id = 'statTrackerPanel';
  wrap.innerHTML = `
    <h3>ğŸ“ˆ Performance Stats Log</h3>
    <p>Log your numbers after each set. The trend lines don't lie.</p>
    <div class="stat-entry-form">
      <div class="stat-field"><label>Set Label</label><input class="stat-input" id="statLabel" placeholder='e.g. "vs Tyler Day 12"' /></div>
      ${STAT_METRICS.map(m => `<div class="stat-field"><label>${m.label}</label><input class="stat-input" id="statIn_${m.key}" type="number" step="0.01" placeholder="â€”" /></div>`).join('')}
      <button class="stat-submit-btn" onclick="addStatEntry()">+ LOG SET</button>
    </div>
    <div>
      <div class="stat-chart-selector" id="statChartSelector">
        ${STAT_METRICS.map(m => `<button class="chart-metric-btn ${m.key===activeStatMetric?'active':''}" data-key="${m.key}" onclick="setActiveStatMetric('${m.key}')">${m.label}</button>`).join('')}
      </div>
      <div class="stat-canvas-wrap" id="statCanvasWrap"><canvas id="statChart"></canvas></div>
      <table class="stat-log-table" id="statLogTable"></table>
    </div>
  `;
  setTimeout(() => { renderStatChart(); renderStatTable(); }, 100);
  return wrap;
}

function setActiveStatMetric(key) {
  activeStatMetric = key;
  document.querySelectorAll('.chart-metric-btn').forEach(b => b.classList.toggle('active', b.dataset.key === key));
  renderStatChart();
}

function addStatEntry() {
  const label = (document.getElementById('statLabel')?.value.trim()) || ('Set ' + (state.statLogs.length + 1));
  const entry = { label, day: currentDay };
  STAT_METRICS.forEach(m => { const v = document.getElementById('statIn_'+m.key)?.value; entry[m.key] = v !== '' && v != null ? parseFloat(v) : null; });
  state.statLogs.push(entry); saveState();
  document.getElementById('statLabel') && (document.getElementById('statLabel').value = '');
  STAT_METRICS.forEach(m => { const el = document.getElementById('statIn_'+m.key); if(el) el.value = ''; });
  renderStatChart(); renderStatTable();
  addXp(30);
}

function deleteStatEntry(i) { state.statLogs.splice(i,1); saveState(); renderStatChart(); renderStatTable(); }

function renderStatChart() {
  const canvas = document.getElementById('statChart'); if (!canvas) return;
  const wrap = document.getElementById('statCanvasWrap');
  const W = wrap.offsetWidth || 600, H = 160;
  canvas.width = W; canvas.height = H;
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  const metric = STAT_METRICS.find(m => m.key === activeStatMetric);
  const logs = state.statLogs.filter(e => e[activeStatMetric] != null);
  if (logs.length < 2) {
    ctx.fillStyle = '#333'; ctx.font = '10px DM Mono, monospace'; ctx.textAlign = 'center';
    ctx.fillText(logs.length === 0 ? 'Log at least 2 sets to see your trend' : 'Log one more set to see trend', W/2, H/2);
    return;
  }
  const vals = logs.map(e => e[activeStatMetric]);
  const minV = Math.min(...vals), maxV = Math.max(...vals), range = maxV - minV || 1;
  const pad = { t:20, b:28, l:44, r:14 };
  const cW = W-pad.l-pad.r, cH = H-pad.t-pad.b;
  ctx.strokeStyle='#1c1c30'; ctx.lineWidth=1;
  for(let i=0;i<=4;i++){const y=pad.t+(cH/4)*i; ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();ctx.fillStyle='#5a5a72';ctx.font='9px DM Mono';ctx.textAlign='right';ctx.fillText((maxV-(range/4)*i).toFixed(1)+metric.unit,pad.l-4,y+3);}
  ctx.fillStyle='#5a5a72'; ctx.font='8px DM Mono'; ctx.textAlign='center';
  logs.forEach((e,i)=>{const x=pad.l+(cW/(logs.length-1))*i;ctx.fillText(e.label.substring(0,9),x,H-5);});
  const grad=ctx.createLinearGradient(0,pad.t,0,H-pad.b);grad.addColorStop(0,metric.color+'55');grad.addColorStop(1,metric.color+'00');
  ctx.beginPath();logs.forEach((e,i)=>{const x=pad.l+(cW/(logs.length-1))*i;const y=pad.t+cH-((e[activeStatMetric]-minV)/range)*cH;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.lineTo(pad.l+cW,H-pad.b);ctx.lineTo(pad.l,H-pad.b);ctx.closePath();ctx.fillStyle=grad;ctx.fill();
  ctx.beginPath();ctx.strokeStyle=metric.color;ctx.lineWidth=2;ctx.lineJoin='round';
  logs.forEach((e,i)=>{const x=pad.l+(cW/(logs.length-1))*i;const y=pad.t+cH-((e[activeStatMetric]-minV)/range)*cH;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});ctx.stroke();
  logs.forEach((e,i)=>{const x=pad.l+(cW/(logs.length-1))*i;const y=pad.t+cH-((e[activeStatMetric]-minV)/range)*cH;ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2);ctx.fillStyle=metric.color;ctx.fill();if(i>0){const prev=logs[i-1][activeStatMetric],curr=e[activeStatMetric];const imp=metric.higherBetter?curr>prev:curr<prev;const wrs=metric.higherBetter?curr<prev:curr>prev;ctx.font='9px sans-serif';ctx.textAlign='center';ctx.fillStyle=imp?'#2dcc70':wrs?'#ff3c3c':'#5a5a72';ctx.fillText(imp?'â–²':wrs?'â–¼':'â€“',x,y-7);}});
}

function renderStatTable() {
  const table = document.getElementById('statLogTable'); if(!table||state.statLogs.length===0){if(table)table.innerHTML='';return;}
  table.innerHTML=`<thead><tr><th>Set</th><th>Day</th>${STAT_METRICS.map(m=>`<th>${m.label}</th>`).join('')}<th></th></tr></thead><tbody>${state.statLogs.slice().reverse().map((e,ri)=>{const i=state.statLogs.length-1-ri;const prev=state.statLogs[i-1];return`<tr><td>${escHtml(e.label)}</td><td>Day ${e.day}</td>${STAT_METRICS.map(m=>{const val=e[m.key];if(val==null)return'<td style="color:var(--text3)">â€”</td>';let cls='';if(prev&&prev[m.key]!=null){const b=m.higherBetter?val>prev[m.key]:val<prev[m.key];const w=m.higherBetter?val<prev[m.key]:val>prev[m.key];cls=b?'stat-trend-up':w?'stat-trend-down':'';}return`<td class="${cls}">${val}${m.unit}</td>`;}).join('')}<td><button class="stat-del-row" onclick="deleteStatEntry(${i})">âœ•</button></td></tr>`;}).join('')}</tbody>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOOL SECTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildVodStatsTool() {
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.id = 'sec_tool_vodstats';
  sec.innerHTML = `
    <div class="tool-header">
      <div class="tool-icon-big">ğŸ“Š</div>
      <div class="tool-title-block">
        <h2>VOD Stat Tracking & Performance Charts</h2>
        <p>Track your improvement over time. Complete VOD quests every 3 days to build your performance history. Data = Growth.</p>
      </div>
    </div>
    <button class="add-form-btn" onclick="openVODStatModal()" style="margin-bottom:24px;width:auto;padding:14px 32px;">
      + NEW VOD SESSION
    </button>
    <div id="vodChartsContainer"></div>
  `;
  const container = sec.querySelector('#vodChartsContainer');
  container.innerHTML = renderVODCharts();
  initVODCharts();
  return sec;
}

function buildMatchupsTool() {
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.id = 'sec_tool_matchups';
  sec.innerHTML = `
    <div class="tool-header">
      <div class="tool-icon-big">âš”ï¸</div>
      <div class="tool-title-block">
        <h2>Matchup Anchors</h2>
        <p>Your personal matchup bible. One card per character. Know their game plan, your game plan, and your punish window. Fill this out before you play someone â€” update it after.</p>
      </div>
    </div>
    <div class="add-form">
      <h4>+ Add Matchup</h4>
      <div class="add-form-row">
        <input class="add-form-input" id="matchupCharIn" placeholder="Character (e.g. Pikachu)" />
        <button class="add-form-btn" onclick="addMatchupCard()">ADD MATCHUP</button>
      </div>
    </div>
    <div class="matchup-grid" id="matchupGrid"></div>
  `;
  renderMatchupGrid(sec.querySelector('#matchupGrid'));
  return sec;
}

function renderMatchupGrid(grid) {
  const cards = state.matchupCards || [];
  if (!grid) return;
  if (cards.length === 0) {
    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--text3);font-family:\'Crimson Pro\',serif;font-style:italic;">No matchup cards yet. Add every character in your local scene.</div>';
    return;
  }
  grid.innerHTML = '';
  cards.forEach((c, i) => {
    const card = document.createElement('div');
    card.className = 'matchup-card';
    const fields = [
      { key: 'myWin', label: 'My Win Condition', ph: 'What needs to be true for you to win?' },
      { key: 'theirWin', label: 'Their Win Condition', ph: 'What does their optimal game plan look like?' },
      { key: 'neutralGoal', label: 'Neutral Goal', ph: 'What are you specifically trying to accomplish in neutral?' },
      { key: 'punishFocus', label: 'Punish Focus', ph: 'What move or position gives your best punish?' },
      { key: 'notes', label: 'Post-Match Notes', ph: 'What did you learn the last time you played this matchup?' },
    ];
    card.innerHTML = `
      <div class="matchup-card-hdr">
        <div class="matchup-char-name">vs ${escHtml(c.char)}</div>
        <button class="matchup-del" onclick="deleteMatchupCard(${i})">âœ•</button>
      </div>
      <div class="matchup-card-body">
        ${fields.map(f => `
          <div class="matchup-field">
            <div class="matchup-field-label">${f.label}</div>
            <textarea class="matchup-textarea" placeholder="${f.ph}" onblur="saveMatchupField(${i},'${f.key}',this.value)">${escHtml(c[f.key]||'')}</textarea>
          </div>
        `).join('')}
      </div>
    `;
    grid.appendChild(card);
  });
}

function addMatchupCard() {
  const char = document.getElementById('matchupCharIn')?.value.trim(); if (!char) return;
  if (!state.matchupCards) state.matchupCards = [];
  state.matchupCards.push({ char, myWin:'', theirWin:'', neutralGoal:'', punishFocus:'', notes:'' });
  saveState();
  document.getElementById('matchupCharIn').value = '';
  renderMatchupGrid(document.getElementById('matchupGrid'));
}

function deleteMatchupCard(i) {
  if (!confirm('Remove this matchup card?')) return;
  state.matchupCards.splice(i,1); saveState();
  renderMatchupGrid(document.getElementById('matchupGrid'));
}

function saveMatchupField(i, field, val) {
  if (state.matchupCards[i]) { state.matchupCards[i][field] = val; saveState(); }
}

function buildVodTool() {
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.id = 'sec_tool_vod';
  sec.innerHTML = `
    <div class="tool-header">
      <div class="tool-icon-big">ğŸ“¹</div>
      <div class="tool-title-block">
        <h2>VOD Review Log</h2>
        <p>Every session worth reviewing gets an entry here. The notes you write after watching are the most valuable data in this whole system.</p>
      </div>
    </div>
    <div class="add-form">
      <h4>+ Log a VOD Review</h4>
      <div class="add-form-row">
        <input class="add-form-input" id="vodLabelIn" placeholder='Label (e.g. "vs Tyler â€” Day 12 online")' />
        <button class="add-form-btn" onclick="addVodEntry()">+ LOG</button>
      </div>
    </div>
    <div class="vod-review-list" id="vodList"></div>
  `;
  renderVodList(sec.querySelector('#vodList'));
  return sec;
}

function renderVodList(list) {
  const reviews = state.vodReviews || [];
  if (!list) return;
  if (reviews.length === 0) {
    list.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text3);font-family:\'Crimson Pro\',serif;font-style:italic;">No VOD reviews yet. Log your first session.</div>';
    return;
  }
  list.innerHTML = '';
  reviews.slice().reverse().forEach((v, ri) => {
    const i = reviews.length - 1 - ri;
    const entry = document.createElement('div');
    entry.className = 'vod-entry';
    const vodFields = [
      { key: 'neutral', label: 'Neutral Mistakes', ph: 'What neutral interactions did you lose and why?' },
      { key: 'advantage', label: 'Advantage Drops', ph: 'What conversions did you drop? What combos were missed?' },
      { key: 'disadvantage', label: 'Disadvantage Damage', ph: 'How much damage did you take while in disadvantage? Avoidable?' },
      { key: 'mental', label: 'Mental/Patterns', ph: 'What habits are your opponents reading? What are you doing on autopilot?' },
      { key: 'drill', label: 'Drill to Build', ph: 'What is the ONE drill you build from this footage?' },
    ];
    entry.innerHTML = `
      <div class="vod-entry-hdr">
        <span class="vod-day-tag">Day ${v.day}</span>
        <span class="vod-label">${escHtml(v.label)}</span>
        <button class="vod-del" onclick="deleteVodEntry(${i})">âœ•</button>
      </div>
      <div class="vod-entry-body">
        ${vodFields.map(f => `
          <div class="vod-field">
            <label>${f.label}</label>
            <textarea class="vod-textarea" placeholder="${f.ph}" onblur="saveVodField(${i},'${f.key}',this.value)">${escHtml(v[f.key]||'')}</textarea>
          </div>
        `).join('')}
      </div>
    `;
    list.appendChild(entry);
  });
}

function addVodEntry() {
  const label = document.getElementById('vodLabelIn')?.value.trim(); if (!label) return;
  if (!state.vodReviews) state.vodReviews = [];
  state.vodReviews.push({ label, day: currentDay, neutral:'', advantage:'', disadvantage:'', mental:'', drill:'' });
  saveState(); document.getElementById('vodLabelIn').value = '';
  renderVodList(document.getElementById('vodList'));
  addXp(40);
}

function deleteVodEntry(i) {
  state.vodReviews.splice(i,1); saveState();
  renderVodList(document.getElementById('vodList'));
}

function saveVodField(i, field, val) {
  if (state.vodReviews[i]) { state.vodReviews[i][field] = val; saveState(); }
}

function buildLocalsTool() {
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.id = 'sec_tool_locals';
  sec.innerHTML = `
    <div class="tool-header">
      <div class="tool-icon-big">ğŸ•µï¸</div>
      <div class="tool-title-block">
        <h2>Local Scene Scouting</h2>
        <p>One full scouting report per player. Answer every question honestly. You should know these players better than they know themselves â€” that's how you beat them in bracket.</p>
      </div>
    </div>
    <div class="add-form">
      <h4>+ Add Player to Scout</h4>
      <div class="add-form-row">
        <input class="add-form-input" id="lpNameIn" placeholder="Player tag (e.g. Dom)" />
        <input class="add-form-input" id="lpCharIn" placeholder="Their main (e.g. Snake)" />
        <button class="add-form-btn" onclick="addLocalPlayer()">+ ADD</button>
      </div>
    </div>
    <div class="local-player-grid" id="localPlayerGrid"></div>
  `;
  renderLocalPlayerGrid(sec.querySelector('#localPlayerGrid'));
  return sec;
}

// â”€â”€ Scouting question definitions â”€â”€
const SCOUT_SECTIONS = [
  {
    id: 'neutral',
    icon: 'âš”ï¸',
    title: 'Neutral Game',
    questions: [
      { key: 'n1', q: 'What is their #1 most used approach option? What do they throw out first when they walk up to you?', ph: 'e.g. dash in Ftilt, empty hop into grab...' },
      { key: 'n2', q: 'What move do they throw out most in neutral when they feel safe? Their "comfort poke"?', ph: 'e.g. spaced Bair, retreating Nair, walk up jab...' },
      { key: 'n3', q: 'How do they open you up for the first hit? What actually lands on you?', ph: 'e.g. always gets me with a dash grab after I airdodge...' },
      { key: 'n4', q: 'What range do they prefer to play at â€” close, mid, or max range? Do they rush in or sit back?', ph: '' },
      { key: 'n5', q: 'What do they do when YOU approach them? How do they react to pressure?', ph: 'e.g. panic spotdodge, roll away, shield immediately...' },
      { key: 'n6', q: 'Do they double jump early or late? What does their aerial movement look like?', ph: '' },
      { key: 'n7', q: 'What neutral option have they hit you with more than once that you haven\'t solved?', ph: '' },
    ]
  },
  {
    id: 'advantage',
    icon: 'ğŸ”¥',
    title: 'Their Advantage State',
    questions: [
      { key: 'a1', q: 'What move do you get killed by most often? What percent and what position on stage?', ph: 'e.g. Uair into Usmash around 90% near top platform...' },
      { key: 'a2', q: 'What is their combo starter? What move do they use to start a sequence on you?', ph: 'e.g. grabs into Dthrow at low percent, Nair into regrab...' },
      { key: 'a3', q: 'When they have you in the air, what do they chase with? How do they extend combos?', ph: '' },
      { key: 'a4', q: 'What is their kill setup? What sequence or position leads to you dying?', ph: 'e.g. bait airdodge â†’ Fsmash, get grab near ledge â†’ Bthrow...' },
      { key: 'a5', q: 'What do they do when you\'re at kill percent that\'s different from earlier in the stock?', ph: 'e.g. stops rushing in, starts fishing for reads, camps more...' },
      { key: 'a6', q: 'What move do they throw out when you\'re offstage trying to recover?', ph: 'e.g. Bair at ledge, Fair spike below stage, walk off Dair...' },
      { key: 'a7', q: 'What stage position do they love to have you in? Where do they try to push you?', ph: 'e.g. always trying to get me to the corner, loves center stage control...' },
    ]
  },
  {
    id: 'disadvantage',
    icon: 'ğŸ›¡ï¸',
    title: 'Their Disadvantage State',
    questions: [
      { key: 'dis1', q: 'What is their most common getup option from the ledge? What do they default to?', ph: 'e.g. almost always getup attack, rarely jumps, occasionally rolls in...' },
      { key: 'dis2', q: 'Do they have a second or third ledge option they mix in? When do they use it?', ph: 'e.g. does ledge jump when you stand close, rolls in when you\'re far...' },
      { key: 'dis3', q: 'What do they do when they\'re launched horizontally offstage? Drift in high, low, or mix?', ph: '' },
      { key: 'dis4', q: 'What is their recovery? What move do they use and from what angle do they usually come in?', ph: 'e.g. always recovers high with up-B, never goes under stage...' },
      { key: 'dis5', q: 'What do they do when you get them off the top? Do they DI to the side or straight up?', ph: '' },
      { key: 'dis6', q: 'How do they handle being on the ground in disadvantage? What is their escape option â€” spotdodge, roll, jump out?', ph: '' },
      { key: 'dis7', q: 'What defensive option have you not punished enough that they keep getting away with?', ph: '' },
    ]
  },
  {
    id: 'shield',
    icon: 'ğŸ”°',
    title: 'Shield & Pressure',
    questions: [
      { key: 'sh1', q: 'What do they do out of shield most often â€” grab, Nair OOS, roll, spotdodge?', ph: 'e.g. almost always grabs OOS when I land near them...' },
      { key: 'sh2', q: 'What move do they press when you\'re on their shield? What\'s their shield pressure pattern?', ph: '' },
      { key: 'sh3', q: 'Do they have a tendency to drop shield early? Or do they hold it too long and get shield stabbed?', ph: '' },
      { key: 'sh4', q: 'What is their most common OOS punish on YOUR pressure? What do you get hit by when you try to pressure them?', ph: '' },
    ]
  },
  {
    id: 'mental',
    icon: 'ğŸ§ ',
    title: 'Mental & Habits',
    questions: [
      { key: 'men1', q: 'What do they do when they\'re losing? How does their gameplan change when they\'re down a stock?', ph: 'e.g. goes reckless and rushes in, or gets super defensive and camps...' },
      { key: 'men2', q: 'Do they have a panic option â€” something they throw out when they don\'t know what to do?', ph: 'e.g. random Dsmash, panic roll back, random up-B...' },
      { key: 'men3', q: 'Do they adapt between games? If you do something twice, do they adjust in game 2?', ph: '' },
      { key: 'men4', q: 'What tilts them or throws them off their gameplan?', ph: 'e.g. getting grabbed a lot, losing their first stock early, getting cheesed...' },
      { key: 'men5', q: 'What do they do at the very start of a stock â€” aggressive, patient, or do they feel you out first?', ph: '' },
      { key: 'men6', q: 'Do they have a pattern in the first 10 seconds of every stock? What do they always do first?', ph: 'e.g. always runs to center immediately, always does a full hop to check my response...' },
    ]
  },
  {
    id: 'gameplan',
    icon: 'ğŸ“‹',
    title: 'Your Game Plan vs Them',
    questions: [
      { key: 'gp1', q: 'What is your win condition in this matchup? What needs to be true for you to win?', ph: 'e.g. land grabs consistently, get them to ledge and cover all options...' },
      { key: 'gp2', q: 'What neutral option beats their approach? What do you throw out when they walk up?', ph: '' },
      { key: 'gp3', q: 'What is your combo starter on them? How do you get your first hit and what do you do with it?', ph: '' },
      { key: 'gp4', q: 'What do you do when they\'re on the ledge? What option covers the most of their getup habits?', ph: '' },
      { key: 'gp5', q: 'What is the one thing you need to stop doing vs them? Your biggest mistake in this matchup?', ph: 'e.g. keep airdodging into their Uair, keep getting grabbed at ledge...' },
      { key: 'gp6', q: 'What percent do they die at? What is your kill confirm route on them specifically?', ph: 'e.g. Uair at 95% near top blast, Bthrow at ledge at 120%...' },
      { key: 'gp7', q: 'What adjustment worked the last time you beat them or took a game off them?', ph: '' },
      { key: 'gp8', q: 'In one sentence: what is the core gameplan you\'re running next time you play them?', ph: 'e.g. Bait and punish their approach, never contest aerial, always cover ledge getup attack...' },
    ]
  },
  {
    id: 'history',
    icon: 'ğŸ“œ',
    title: 'Match History & Notes',
    questions: [
      { key: 'his1', q: 'What was the last set score vs them and what happened?', ph: 'e.g. lost 0-2, got combo\'d out at high %, died to Bthrow both games...' },
      { key: 'his2', q: 'What is the general trend â€” are you getting closer to beating them or further?', ph: '' },
      { key: 'his3', q: 'Have you ever beaten them or taken a game? What did you do differently that time?', ph: '' },
      { key: 'his4', q: 'What stage do you win on vs them if any? What stage do you lose on most?', ph: '' },
      { key: 'his5', q: 'What is the one thing you want to try next time that you haven\'t yet?', ph: '' },
    ]
  }
];

function getScoutData(lp, sectionId, key) {
  return (lp.scout && lp.scout[sectionId] && lp.scout[sectionId][key]) || '';
}

function countScoutAnswers(lp) {
  let total = 0, answered = 0;
  SCOUT_SECTIONS.forEach(sec => {
    sec.questions.forEach(q => {
      total++;
      if (getScoutData(lp, sec.id, q.key).trim().length > 2) answered++;
    });
  });
  return { total, answered };
}

function renderLocalPlayerGrid(grid) {
  const players = state.localPlayers || [];
  if (!grid) return;
  if (players.length === 0) {
    grid.innerHTML = '<div style="text-align:center;padding:60px 20px;color:var(--text3);font-family:\'Crimson Pro\',serif;font-style:italic;font-size:0.9rem;">No players scouted yet.<br>Add everyone who stands between you and winning your local.</div>';
    return;
  }
  grid.innerHTML = '';
  players.forEach((lp, i) => {
    grid.appendChild(buildPlayerScoutCard(lp, i));
  });
}

function buildPlayerScoutCard(lp, i) {
  const { total, answered } = countScoutAnswers(lp);
  const pct = Math.round((answered / total) * 100);
  // Auto-calculate scout depth from answer completion
  const danger = pct >= 95 ? 5 : pct >= 70 ? 4 : pct >= 45 ? 3 : pct >= 20 ? 2 : answered > 0 ? 1 : 0;
  const dangerLabels = ['Not started', 'Just getting started', 'Getting there', 'Solid read', 'Know them well', 'ğŸ’€ Full scout'];

  const card = document.createElement('div');
  card.className = 'local-player-card';
  card.dataset.playerIndex = i;

  // Build depth indicators (read-only)
  const starsHtml = [1,2,3,4,5].map(n =>
    `<span class="lp-danger-star${danger >= n ? ' lit' : ''}">${danger >= n ? 'ğŸ”¥' : 'â—‹'}</span>`
  ).join('');

  card.innerHTML = `
    <div class="lp-card-hdr" onclick="togglePlayerCard(${i})">
      <div class="lp-hdr-left">
        <div class="lp-name">${escHtml(lp.name)}</div>
        <span class="lp-char-tag">vs ${escHtml(lp.char || '?')}</span>
      </div>
      <div class="lp-hdr-right">
        <div class="lp-record-block">
          <div class="lp-record-label">Record</div>
          <div class="lp-record-nums">
            <input class="lp-record-input" type="number" min="0" value="${lp.wins||0}" onclick="event.stopPropagation()" onchange="saveLocalField(${i},'wins',this.value)" title="Wins" />
            <span class="lp-record-sep">â€“</span>
            <input class="lp-record-input" type="number" min="0" value="${lp.losses||0}" onclick="event.stopPropagation()" onchange="saveLocalField(${i},'losses',this.value)" title="Losses" />
          </div>
        </div>
        <div class="lp-completion-ring" id="lpRing_${i}" style="background:conic-gradient(var(--${pct===100?'green':'accent'}) ${pct*3.6}deg, var(--border) 0deg)">
          <span class="lp-completion-pct">${pct}%</span>
        </div>
        <button class="lp-del" onclick="event.stopPropagation();deleteLocalPlayer(${i})" title="Remove player">âœ•</button>
        <span class="lp-expand-arrow${lp._open ? ' open' : ''}" id="lpArrow_${i}">â–¼</span>
      </div>
    </div>
    <div class="lp-danger">
      <span class="lp-danger-label">Scout depth</span>
      <div class="lp-danger-stars">${starsHtml}</div>
      <span class="lp-priority-note">${answered}/${total} questions Â· ${dangerLabels[danger]}</span>
    </div>
    <div class="lp-scout-body${lp._open ? ' open' : ''}" id="lpBody_${i}">
      ${SCOUT_SECTIONS.map(sec => buildScoutSection(lp, i, sec)).join('')}
    </div>
  `;
  return card;
}

function buildScoutSection(lp, playerIdx, sec) {
  const answered = sec.questions.filter(q => getScoutData(lp, sec.id, q.key).trim().length > 2).length;
  const complete = answered === sec.questions.length;
  const isOpen = lp[`_sec_${sec.id}`] || false;

  return `
    <div class="lp-section">
      <div class="lp-section-hdr" onclick="toggleScoutSection(${playerIdx},'${sec.id}')">
        <span class="lp-section-icon">${sec.icon}</span>
        <span class="lp-section-title">${sec.title}</span>
        <span class="lp-section-filled${complete ? ' complete' : ''}">${answered}/${sec.questions.length}</span>
        <span class="lp-section-chevron${isOpen ? ' open' : ''}" id="lpSecChev_${playerIdx}_${sec.id}">â–¼</span>
      </div>
      <div class="lp-questions${isOpen ? ' open' : ''}" id="lpSec_${playerIdx}_${sec.id}">
        ${sec.questions.map((q, qi) => {
          const val = getScoutData(lp, sec.id, q.key);
          const hasAnswer = val.trim().length > 2;
          return `
            <div class="lp-q">
              <div class="lp-q-label">
                <span class="lq-num${hasAnswer ? ' answered' : ''}">${qi + 1}</span>
                ${escHtml(q.q)}
              </div>
              <textarea
                placeholder="${escHtml(q.ph || 'Your answer...')}"
                rows="2"
                class="${hasAnswer ? 'answered' : ''}"
                onblur="saveScoutField(${playerIdx},'${sec.id}','${q.key}',this.value)"
                oninput="markScoutAnswered(${playerIdx},'${sec.id}','${q.key}',this)"
              >${escHtml(val)}</textarea>
            </div>
          `;
        }).join('')}
      </div>
    </div>
  `;
}

function togglePlayerCard(i) {
  const players = state.localPlayers || [];
  if (!players[i]) return;
  players[i]._open = !players[i]._open;
  // Don't save _open to state, just re-render
  renderLocalPlayerGrid(document.getElementById('localPlayerGrid'));
}

function toggleScoutSection(playerIdx, secId) {
  const players = state.localPlayers || [];
  if (!players[playerIdx]) return;
  players[playerIdx][`_sec_${secId}`] = !players[playerIdx][`_sec_${secId}`];
  renderLocalPlayerGrid(document.getElementById('localPlayerGrid'));
}

function markScoutAnswered(playerIdx, secId, key, el) {
  const hasAnswer = el.value.trim().length > 2;
  el.classList.toggle('answered', hasAnswer);
  // Update the number badge
  const qDiv = el.closest('.lp-q');
  if (qDiv) {
    const badge = qDiv.querySelector('.lq-num');
    if (badge) badge.classList.toggle('answered', hasAnswer);
  }
}

function saveScoutField(playerIdx, secId, key, val) {
  const players = state.localPlayers || [];
  if (!players[playerIdx]) return;
  if (!players[playerIdx].scout) players[playerIdx].scout = {};
  if (!players[playerIdx].scout[secId]) players[playerIdx].scout[secId] = {};
  players[playerIdx].scout[secId][key] = val;
  saveState();
  // Update completion ring and count without full re-render
  const { total, answered } = countScoutAnswers(players[playerIdx]);
  const pct = Math.round((answered / total) * 100);
  const newDanger = pct >= 95 ? 5 : pct >= 70 ? 4 : pct >= 45 ? 3 : pct >= 20 ? 2 : answered > 0 ? 1 : 0;
  const dangerLabels = ['Not started', 'Just getting started', 'Getting there', 'Solid read', 'Know them well', 'ğŸ’€ Full scout'];
  const ring = document.getElementById(`lpRing_${playerIdx}`);
  if (ring) {
    const col = pct === 100 ? 'var(--green)' : 'var(--accent)';
    ring.style.background = `conic-gradient(${col} ${pct * 3.6}deg, var(--border) 0deg)`;
    const pctEl = ring.querySelector('.lp-completion-pct');
    if (pctEl) pctEl.textContent = `${pct}%`;
  }
  // Update depth stars
  const card = document.querySelector(`[data-player-index="${playerIdx}"]`);
  if (card) {
    card.querySelectorAll('.lp-danger-star').forEach((star, idx) => {
      const lit = newDanger >= idx + 1;
      star.classList.toggle('lit', lit);
      star.textContent = lit ? 'ğŸ”¥' : 'â—‹';
    });
    const note = card.querySelector('.lp-priority-note');
    if (note) note.textContent = `${answered}/${total} questions Â· ${dangerLabels[newDanger]}`;
  }
  // Update section counter
  const sec = SCOUT_SECTIONS.find(s => s.id === secId);
}

function addLocalPlayer() {
  const name = document.getElementById('lpNameIn')?.value.trim();
  const ch = document.getElementById('lpCharIn')?.value.trim();
  if (!name) return;
  if (!state.localPlayers) state.localPlayers = [];
  state.localPlayers.push({ name, char: ch||'?', wins:0, losses:0, danger:0, scout:{}, _open: true });
  saveState();
  document.getElementById('lpNameIn').value = '';
  document.getElementById('lpCharIn').value = '';
  renderLocalPlayerGrid(document.getElementById('localPlayerGrid'));
}

function deleteLocalPlayer(i) {
  if (!confirm(`Remove scouting report for ${state.localPlayers[i]?.name}? This can't be undone.`)) return;
  state.localPlayers.splice(i,1);
  saveState();
  renderLocalPlayerGrid(document.getElementById('localPlayerGrid'));
}

function saveLocalField(i, field, val) {
  if (state.localPlayers[i]) {
    state.localPlayers[i][field] = field==='wins'||field==='losses' ? parseInt(val)||0 : val;
    saveState();
  }
}

function buildMilestonesTool() {
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.id = 'sec_tool_milestones';
  sec.innerHTML = `
    <div class="tool-header">
      <div class="tool-icon-big">ğŸ…</div>
      <div class="tool-title-block">
        <h2>Milestones</h2>
        <p>Log every meaningful breakthrough â€” a new skill locked in, a matchup figured out, a mental hurdle cleared. These are the moments that stack into a top player.</p>
      </div>
    </div>
    <div class="add-milestone-form">
      <h4>+ Log a Milestone</h4>
      <div class="milestone-form-row">
        <select class="milestone-form-select" id="msCat">
          <option value="tech">Technical</option>
          <option value="neutral">Neutral</option>
          <option value="advantage">Advantage</option>
          <option value="mental">Mental</option>
          <option value="competitive">Competitive</option>
          <option value="other">Other</option>
        </select>
      </div>
      <textarea class="milestone-form-textarea" id="msText" placeholder="What happened? What did you figure out or achieve?"></textarea>
      <div class="milestone-form-row" style="margin-top:8px;">
        <button class="add-milestone-btn" onclick="addMilestone()">+ LOG MILESTONE</button>
      </div>
    </div>
    <div id="milestoneTimeline"></div>
  `;
  renderMilestoneTimeline(sec.querySelector('#milestoneTimeline'));
  return sec;
}

function renderMilestoneTimeline(container) {
  if (!container) return;
  const milestones = state.milestones || [];
  if (milestones.length === 0) {
    container.innerHTML = `<div class="milestones-empty"><div class="me-icon">ğŸ…</div><p>No milestones yet. Your first one is waiting to be earned.</p></div>`;
    return;
  }
  const tl = document.createElement('div');
  tl.className = 'milestone-timeline';
  milestones.slice().reverse().forEach((m, ri) => {
    const i = milestones.length - 1 - ri;
    const entry = document.createElement('div');
    entry.className = 'milestone-entry';
    entry.innerHTML = `
      <div class="milestone-dot"></div>
      <div class="milestone-meta">
        <span class="milestone-day-tag">Day ${m.day}</span>
        <span class="milestone-cat-tag">${m.cat}</span>
        <button class="milestone-del" onclick="deleteMilestone(${i})">âœ•</button>
      </div>
      <div class="milestone-text">${escHtml(m.text)}</div>
    `;
    tl.appendChild(entry);
  });
  container.innerHTML = '';
  container.appendChild(tl);
}

function addMilestone() {
  const text = document.getElementById('msText')?.value.trim(); if (!text) return;
  const cat = document.getElementById('msCat')?.value || 'other';
  if (!state.milestones) state.milestones = [];
  state.milestones.push({ text, cat, day: currentDay }); saveState();
  document.getElementById('msText').value = '';
  renderMilestoneTimeline(document.getElementById('milestoneTimeline'));
  addXp(50); showToast('Milestone logged! +50 XP ğŸ…', 'gold');
}

function deleteMilestone(i) { state.milestones.splice(i,1); saveState(); renderMilestoneTimeline(document.getElementById('milestoneTimeline')); }

function buildSquadSection() {
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.id = 'sec_tool_squad';

  const squadCode = state.squadCode || generateSquadCode();
  if (!state.squadCode) { state.squadCode = squadCode; saveState(); }

  sec.innerHTML = `
    <div class="tool-header">
      <div class="tool-icon-big">ğŸ¤</div>
      <div class="tool-title-block">
        <h2>Squad</h2>
        <p>Share your squad code with your training partners. To enable real-time sync, connect Firebase below.</p>
      </div>
    </div>
    <div class="squad-panel">
      <h3>Your Squad</h3>
      <p>Share this code with your training partners so they can see your progress (requires Firebase).</p>
      <div class="squad-code-row">
        <div class="squad-code">${squadCode}</div>
        <div class="squad-code-label">Your squad code</div>
        <button onclick="copySquadCode('${squadCode}')" style="background:var(--green-dim);border:1px solid rgba(45,204,112,0.3);color:var(--green);padding:6px 14px;border-radius:4px;cursor:pointer;font-family:'DM Mono',monospace;font-size:0.6rem;letter-spacing:0.1em;">COPY</button>
      </div>
      <div class="squad-members" id="squadMembersWrap">
        <div style="font-family:'Crimson Pro',serif;font-style:italic;color:var(--text3);font-size:0.82rem;padding:8px 0;">Connect Firebase to see squad members in real time.</div>
      </div>
    </div>
    <div class="firebase-panel">
      <h4>ğŸ”¥ Firebase Setup (Real-Time Squad Sync)</h4>
      <p>To sync with your squad, create a free Firebase project at console.firebase.google.com, create a Realtime Database, then paste your database URL below.</p>
      <input class="firebase-input" id="fbUrlIn" placeholder="https://your-project-default-rtdb.firebaseio.com/" value="${state.firebaseConfig?.databaseURL||''}"/>
      <button class="firebase-connect-btn" onclick="connectFirebase()">CONNECT FIREBASE</button>
      <p style="margin-top:10px;font-size:0.58rem;color:var(--text3);">Firebase is optional. The app works fully offline with localStorage â€” it just won't sync across devices.</p>
    </div>
  `;
  return sec;
}

function buildResetTool() {
  var sec = document.createElement('div');
  sec.className = 'section';
  sec.id = 'sec_tool_reset';
  sec.innerHTML = `
    <div class="tool-header">
      <div class="tool-icon-big">âš ï¸</div>
      <div class="tool-title-block">
        <h2>Reset All Data</h2>
        <p>Wipe everything and start the 60-day program fresh. Use this when you're ready to begin for real.</p>
      </div>
    </div>
    <div style="background:rgba(255,60,60,0.05);border:1px solid rgba(255,60,60,0.2);border-radius:12px;padding:32px;max-width:560px;">
      <div id="resetStep1">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:0.1em;color:var(--accent);margin-bottom:12px;">âš ï¸ THIS CANNOT BE UNDONE</div>
        <p style="font-family:'Crimson Pro',serif;font-style:italic;color:var(--text2);font-size:0.95rem;line-height:1.7;margin-bottom:20px;">
          Resetting will permanently delete all your progress â€” every completed quest, XP, streak, VOD review, scout report, journal entry, and milestone rep. Your 60-day clock will reset to today.
        </p>
        <div style="background:var(--card);border:1px solid var(--border2);border-radius:8px;padding:16px 18px;margin-bottom:24px;font-size:0.65rem;line-height:1.9;color:var(--text2);">
          <div>âœ— &nbsp;All quest completions deleted</div>
          <div>âœ— &nbsp;All XP and rank reset to 0</div>
          <div>âœ— &nbsp;Streak reset to 0</div>
          <div>âœ— &nbsp;All VOD reviews and stats wiped</div>
          <div>âœ— &nbsp;All scout reports and matchup cards deleted</div>
          <div>âœ— &nbsp;All journal entries deleted</div>
          <div>âœ— &nbsp;All milestone progress reset</div>
          <div>âœ— &nbsp;Start date reset to today</div>
        </div>
        <button onclick="showResetConfirm()" style="background:rgba(255,60,60,0.12);border:2px solid rgba(255,60,60,0.4);color:var(--accent);padding:14px 28px;border-radius:8px;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:0.15em;cursor:pointer;width:100%;transition:all 0.2s;">
          I UNDERSTAND â€” SHOW CONFIRMATION
        </button>
      </div>
      <div id="resetStep2" style="display:none;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:0.1em;color:var(--accent);margin-bottom:12px;">ARE YOU ABSOLUTELY SURE?</div>
        <p style="font-family:'Crimson Pro',serif;font-style:italic;color:var(--text2);font-size:0.95rem;line-height:1.7;margin-bottom:20px;">
          Type <strong style="color:var(--accent);font-style:normal;">RESET</strong> in the box below and click the button. There is no undo.
        </p>
        <input type="text" id="resetConfirmInput" placeholder="Type RESET to confirm"
          style="width:100%;background:#090910;border:2px solid rgba(255,60,60,0.3);border-radius:6px;color:var(--text);font-family:'DM Mono',monospace;font-size:0.8rem;padding:12px 14px;outline:none;margin-bottom:14px;letter-spacing:0.08em;"
          oninput="checkResetInput()" />
        <button id="resetFinalBtn" onclick="executeFullReset()" disabled
          style="background:var(--border);border:2px solid var(--border2);color:var(--text3);padding:14px 28px;border-radius:8px;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:0.15em;cursor:not-allowed;width:100%;transition:all 0.2s;margin-bottom:10px;">
          WIPE EVERYTHING &amp; START FRESH
        </button>
        <button onclick="cancelReset()" style="background:none;border:none;color:var(--text2);font-family:'DM Mono',monospace;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;width:100%;padding:6px;">
          â† cancel, keep my data
        </button>
      </div>
    </div>
  `;
  return sec;
}

function showResetConfirm() {
  document.getElementById('resetStep1').style.display = 'none';
  document.getElementById('resetStep2').style.display = 'block';
  document.getElementById('resetConfirmInput').focus();
}

function cancelReset() {
  document.getElementById('resetStep2').style.display = 'none';
  document.getElementById('resetStep1').style.display = 'block';
  document.getElementById('resetConfirmInput').value = '';
}

function checkResetInput() {
  var val = document.getElementById('resetConfirmInput').value;
  var btn = document.getElementById('resetFinalBtn');
  if (val === 'RESET') {
    btn.disabled = false;
    btn.style.background = 'var(--accent)';
    btn.style.borderColor = 'var(--accent)';
    btn.style.color = '#fff';
    btn.style.cursor = 'pointer';
  } else {
    btn.disabled = true;
    btn.style.background = 'var(--border)';
    btn.style.borderColor = 'var(--border2)';
    btn.style.color = 'var(--text3)';
    btn.style.cursor = 'not-allowed';
  }
}

function executeFullReset() {
  try { localStorage.removeItem(STORAGE_KEY); } catch(e) {}
  state = defaultState();
  state.startDate = new Date().toISOString().split('T')[0];
  state.streak = 1;
  state.lastLogin = new Date().toDateString();
  saveState();
  window.location.reload();
}

function generateSquadCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = '';
  for (let i = 0; i < 8; i++) { if (i === 4) code += '-'; code += chars[Math.floor(Math.random() * chars.length)]; }
  return code;
}

function copySquadCode(code) {
  navigator.clipboard?.writeText(code).then(() => showToast('Squad code copied!', 'success')).catch(() => showToast(code));
}

function connectFirebase() {
  var url = document.getElementById('fbUrlIn') ? document.getElementById('fbUrlIn').value.trim() : '';
  if (!url) return;
  state.firebaseConfig = { databaseURL: url };
  saveState();
  loadFirebase(function() { showToast('Firebase connected. Sync active!', 'success'); });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HEADER UPDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateHeader() {
  const block = getBlock(currentDay);
  const badge = document.getElementById('hdrBlockBadge');
  if (badge) { badge.textContent = block.badgeLabel; badge.className = `hdr-block-badge ${block.cls}`; }
  const dn = document.getElementById('hdrDayNum'); if (dn) dn.textContent = currentDay;
  const dd = document.getElementById('hdrDayDate'); if (dd) dd.textContent = getDayDate(currentDay);
  const st = document.getElementById('hdrStreak'); if (st) st.textContent = state.streak || 0;
  const lvl = getXpLevel(state.xp);
  const prog = getXpProgress(state.xp);
  const xl = document.getElementById('hdrXpLabel'); if (xl) xl.textContent = lvl.name;
  const xv = document.getElementById('hdrXpVal'); if (xv) xv.textContent = `${state.xp} XP`;
  const xb = document.getElementById('hdrXpBar'); if (xb) xb.style.width = prog + '%';

  // Rank badge
  const rb = document.getElementById('hdrRankBadge');
  if (rb) {
    const rd = getRankData();
    const cur = rd.find(r => r.name === lvl.name) || rd[0];
    rb.querySelector('.hdr-rank-icon').textContent = cur.icon;
    rb.querySelector('.hdr-rank-name').textContent = lvl.name.toUpperCase();
    rb.querySelector('.hdr-rank-xp').textContent = `${state.xp.toLocaleString()} XP Â· ${prog}% to next`;
  }
}

function updateGlobal() {
  // Use milestone-based global progress
  const pct = getGlobalPct();
  const gb = document.getElementById('globalBar'); if (gb) gb.style.width = pct + '%';
  buildNav();
  // Re-render active pillar section so milestone cards update live
  const activePillar = PILLARS.find(p => p.id === activeSection);
  if (activePillar) {
    const oldSec = document.getElementById('sec_' + activePillar.id);
    if (oldSec) {
      const newSec = buildPillarSection(activePillar);
      newSec.classList.add('active');
      oldSec.replaceWith(newSec);
    }
  }
  // Update pillar grid on home screen
  const pgrid = document.querySelector('.pillar-grid');
  if (pgrid && activeSection === 'today') {
    const sec = document.getElementById('sec_today');
    if (sec) {
      const newSec = buildTodaySectionEnhanced();
      newSec.classList.add('active');
      sec.replaceWith(newSec);
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CELEBRATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showCelebration(day, xp) {
  const isBossDay = day % 7 === 0;
  document.getElementById('celIcon').textContent = isBossDay ? 'âš”ï¸' : 'ğŸ”¥';
  document.getElementById('celTitle').textContent = isBossDay ? 'BOSS DAY COMPLETE' : 'SESSION COMPLETE';
  document.getElementById('celMsg').textContent = isBossDay
    ? `Week ${Math.ceil(day/7)} done. You put in the work. The gap is closing.`
    : `Day ${day} in the books. Another session, another step. The reps don't lie.`;
  document.getElementById('celXp').textContent = `+${xp} XP EARNED`;
  document.getElementById('celebrationOverlay').classList.add('show');
}

function hideCelebration() {
  document.getElementById('celebrationOverlay').classList.remove('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg, type = '') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast' + (type ? ' ' + type : '');
  t.classList.add('show');
  clearTimeout(t._timeout);
  t._timeout = setTimeout(() => t.classList.remove('show'), 3200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getAllAtoms(p) {
  const atoms = [];
  p.subsections.forEach(sub => sub.tasks.forEach(cat => cat.atoms.forEach(a => atoms.push(a))));
  return atoms;
}

function getSubAtoms(p, sub) {
  const atoms = [];
  sub.tasks.forEach(cat => cat.atoms.forEach(a => atoms.push(a)));
  return atoms;
}

function findAtom(uid) {
  for (const p of PILLARS)
    for (const sub of p.subsections)
      for (const cat of sub.tasks)
        for (const atom of cat.atoms)
          if (atom.uid === uid) return atom;
  return null;
}

function escHtml(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTICLE SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const pCanvas = document.getElementById('particleCanvas');
const pCtx = pCanvas.getContext('2d');
let particles = [];

function resizeParticleCanvas() {
  pCanvas.width = window.innerWidth;
  pCanvas.height = window.innerHeight;
}
resizeParticleCanvas();
window.addEventListener('resize', resizeParticleCanvas);

function spawnParticles(x, y, color = '#ff3c3c', count = 20) {
  for (let i = 0; i < count; i++) {
    const angle = Math.random() * Math.PI * 2;
    const speed = 2 + Math.random() * 5;
    particles.push({
      x, y,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed - 2,
      life: 1,
      decay: 0.02 + Math.random() * 0.03,
      size: 3 + Math.random() * 5,
      color,
    });
  }
}

function animateParticles() {
  pCtx.clearRect(0, 0, pCanvas.width, pCanvas.height);
  particles = particles.filter(p => p.life > 0);
  for (const p of particles) {
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.15;
    p.life -= p.decay;
    pCtx.globalAlpha = p.life;
    pCtx.fillStyle = p.color;
    pCtx.beginPath();
    pCtx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
    pCtx.fill();
  }
  pCtx.globalAlpha = 1;
  requestAnimationFrame(animateParticles);
}
animateParticles();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// XP FLOAT ANIMATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showXpFloat(amount, x, y) {
  const el = document.createElement('div');
  el.className = 'xp-float';
  el.textContent = `+${amount} XP`;
  el.style.left = (x || window.innerWidth/2) + 'px';
  el.style.top = (y || window.innerHeight/2) + 'px';
  document.body.appendChild(el);
  el.addEventListener('animationend', () => el.remove());
}

// Patch addXp to also show float
const _origAddXp = addXp;
// We override toggleQuestDone's xp call via the advancement â€” the float happens on card click
document.addEventListener('click', function(e) {
  const qCheck = e.target.closest('.qc-check');
  if (qCheck && !qCheck.classList.contains('done')) {
    // About to become done â€” spawn particles and XP float
    setTimeout(() => {
      if (qCheck.classList.contains('done')) {
        spawnParticles(e.clientX, e.clientY, '#f5c842', 25);
        showXpFloat(100, e.clientX, e.clientY - 20);
      }
    }, 50);
  }
  const atomCheck = e.target.closest('.atom-check');
  if (atomCheck && !atomCheck.classList.contains('done')) {
    setTimeout(() => {
      if (atomCheck.classList.contains('done')) {
        spawnParticles(e.clientX, e.clientY, '#2dcc70', 12);
        showXpFloat(15, e.clientX, e.clientY - 20);
      }
    }, 50);
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DAILY CHALLENGE SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DAILY_CHALLENGES = [
  { icon: 'âš”ï¸', title: 'NO MISS DRILL', challenge: 'Complete your tech warmup without a single error. If you mess up, restart from the beginning. Count how many attempts it takes. Your score is your attempts â€” aim to beat it tomorrow.', xp: 200 },
  { icon: 'ğŸ¯', title: 'FOCUS LOCK', challenge: 'Play your next 3 ranked sets with ONE conscious objective only. No thinking about score, only executing that one thing. After each game, rate yourself 1-10 on that objective.', xp: 175 },
  { icon: 'ğŸ“¹', title: 'VOD BOSS MODE', challenge: 'Watch your last loss on video. Every single neutral interaction you lost â€” pause it, write what you should have done instead. Minimum 5 annotations before you close the video.', xp: 225 },
  { icon: 'ğŸ§ ', title: 'SHADOW SESH', challenge: 'Sit in training mode for 15 minutes with no CPU. No inputs. Just move your character and shadow box every situation your opponent will put you in today. Visualize winning each one.', xp: 150 },
  { icon: 'ğŸ’€', title: 'GRIND BLOCK', challenge: 'Set a timer for 20 minutes. Do nothing but your most-hated drill the entire time. No breaks, no stopping, no excuses. Top players are built in the moments other players quit.', xp: 250 },
  { icon: 'ğŸ†', title: 'BOSS BATTLE', challenge: 'Text your best training partner right now. Play a full Bo5 set. Tournament rules â€” no pausing, no rematches mid-set. Winner calls the next character. Report the score in your journal.', xp: 300 },
  { icon: 'ğŸ®', title: 'BLIND SPOT', challenge: 'Play 5 games where you\'re NOT allowed to approach first. Wait, bait, and punish only. This forces you to find your defensive game. Note how your opponent adapts.', xp: 175 },
  { icon: 'ğŸ“Š', title: 'STAT AUDIT', challenge: 'After your session today, log EVERY metric in the stat tracker. Honestly. If your numbers are bad, that\'s the data you need. You can\'t fix what you don\'t measure.', xp: 150 },
  { icon: 'ğŸ”¥', title: 'STREAK TEST', challenge: 'Execute your #1 hardest combo 10 times in a row with no drops. If you drop it, the counter resets to 0. Timer starts now. Don\'t leave training mode until the count hits 10.', xp: 200 },
  { icon: 'ğŸ¤', title: 'RIVAL STUDY', challenge: 'Watch your hardest local matchup character for 20 minutes â€” top level play only. Write down one pattern you\'ve never countered properly. Build a single drill around it before sleep.', xp: 175 },
];

let currentChallenge = null;

function showDailyChallenge() {
  const dayKey = `challenge_${currentDay}`;
  if (state.dayCompletions[dayKey + '_shown']) return; // already shown today
  state.dayCompletions[dayKey + '_shown'] = true;
  saveState();

  const idx = (currentDay - 1) % DAILY_CHALLENGES.length;
  currentChallenge = DAILY_CHALLENGES[idx];
  currentChallenge.bonusXp = currentChallenge.xp;

  document.getElementById('dcIcon').textContent = currentChallenge.icon;
  document.getElementById('dcTitle').textContent = currentChallenge.title;
  document.getElementById('dcChallenge').textContent = currentChallenge.challenge;
  document.getElementById('dcXpReward').textContent = `+${currentChallenge.xp} BONUS XP`;

  const modal = document.getElementById('dailyChallengeModal');
  modal.classList.remove('hidden');
}

function acceptChallenge() {
  const modal = document.getElementById('dailyChallengeModal');
  modal.classList.add('hidden');
  if (currentChallenge) {
    const dayKey = `challenge_${currentDay}`;
    state.dayCompletions[dayKey + '_accepted'] = true;
    saveState();
    addXp(currentChallenge.bonusXp);
    spawnParticles(window.innerWidth/2, window.innerHeight/2, '#f5c842', 40);
    showToast(`âš”ï¸ Challenge accepted! Complete it for +${currentChallenge.bonusXp} XP`, 'gold');
    // Add challenge as a visible quest note in today section
    setTimeout(() => {
      const sec = document.getElementById('sec_today');
      if (sec) {
        const banner = document.createElement('div');
        banner.className = 'weekly-checkin';
        banner.style.border = '1px solid rgba(245,200,66,0.4)';
        banner.innerHTML = `<h3>${currentChallenge.icon} DAILY CHALLENGE: ${currentChallenge.title}</h3><p style="font-family:'DM Mono',monospace;font-size:0.65rem;color:var(--text);line-height:1.7;margin-top:8px;">${currentChallenge.challenge}</p>`;
        const qsec = sec.querySelector('.quest-section-title');
        if (qsec) qsec.before(banner);
      }
    }, 300);
  }
}

function skipChallenge() {
  document.getElementById('dailyChallengeModal').classList.add('hidden');
  showToast('Challenge skipped. It\'ll be here tomorrow.', '');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PILLAR PILLS IN TODAY SECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildPillarPills() {
  const wrap = document.createElement('div');
  wrap.className = 'pillar-pills';
  PILLARS.filter(p => !isPillarLocked(p)).forEach(p => {
    const pct = getPillarPct(p);
    const pill = document.createElement('div');
    pill.className = 'pillar-pill';
    pill.onclick = () => showSection(p.id);
    pill.innerHTML = `
      <span class="pp-icon">${p.icon}</span>
      <span>${p.name}</span>
      <div class="pp-bar"><div class="pp-fill" style="width:${pct}%"></div></div>
      <span class="pp-pct">${pct}%</span>
    `;
    wrap.appendChild(pill);
  });
  return wrap;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENHANCED TODAY SECTION (pillar grid now built into base section)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildTodaySectionEnhanced() {
  return buildTodaySectionBase();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUESTION WHEEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const WHEEL_QUESTIONS = [
  { cat: 'NEUTRAL', q: 'What\'s the one neutral habit your opponents punish you for most? Be specific.' },
  { cat: 'MENTAL', q: 'When you feel yourself tilting mid-set, what\'s the first thing that changes in your gameplay?' },
  { cat: 'TECH', q: 'Which tech do you execute clean in training but drop under pressure? What\'s different?' },
  { cat: 'READS', q: 'What\'s the most predictable thing about how YOU play right now?' },
  { cat: 'WINS', q: 'Think of your last win. What specifically made you better than your opponent that set?' },
  { cat: 'LOSS', q: 'Think of your last tough loss. What was the exact interaction that flipped the match?' },
  { cat: 'MATCHUP', q: 'Which character in your local scene gives you the most trouble and WHY â€” be tactical.' },
  { cat: 'GROWTH', q: 'What skill would make the biggest difference to your results if you mastered it this week?' },
  { cat: 'HABITS', q: 'What do you do in the first 5 minutes of a session? Is it actually optimal?' },
  { cat: 'IDENTITY', q: 'In one sentence: what kind of player are you becoming through this program?' },
  { cat: 'PRESSURE', q: 'How does your playstyle change on the last stock vs early stocks? Should it?' },
  { cat: 'COACHING', q: 'If you could watch 30 seconds of your play right now, what would you tell yourself?' },
];
const WHEEL_COLORS = ['#ff3c3c','#f5c842','#2dcc70','#3c8dff','#a855f7','#ff8c00','#ff3c3c','#f5c842','#2dcc70','#3c8dff','#a855f7','#ff8c00'];

let wheelAngle = 0;
let wheelSpinning = false;
let currentWheelQ = null;

function showQuestionWheel() {
  document.getElementById('wheelModal').classList.remove('hidden');
  drawWheel(wheelAngle);
}
function closeWheel() { document.getElementById('wheelModal').classList.add('hidden'); }

function drawWheel(rotation) {
  const canvas = document.getElementById('wheelCanvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = 200, H = 200, R = 96, cx = W/2, cy = H/2;
  ctx.clearRect(0, 0, W, H);
  const n = WHEEL_QUESTIONS.length;
  const sliceAngle = (Math.PI * 2) / n;
  WHEEL_QUESTIONS.forEach((q, i) => {
    const start = rotation + i * sliceAngle;
    const end = start + sliceAngle;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, R, start, end);
    ctx.closePath();
    ctx.fillStyle = WHEEL_COLORS[i];
    ctx.fill();
    ctx.strokeStyle = '#080810';
    ctx.lineWidth = 2;
    ctx.stroke();
    // Label
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(start + sliceAngle/2);
    ctx.textAlign = 'right';
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 9px DM Mono, monospace';
    ctx.fillText(q.cat, R - 8, 3);
    ctx.restore();
  });
  // Center circle
  ctx.beginPath();
  ctx.arc(cx, cy, 18, 0, Math.PI * 2);
  ctx.fillStyle = '#080810';
  ctx.fill();
  ctx.strokeStyle = '#242438';
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.fillStyle = '#e8e8f0';
  ctx.font = 'bold 9px DM Mono';
  ctx.textAlign = 'center';
  ctx.fillText('SPIN', cx, cy + 3);
}

function spinWheel() {
  if (wheelSpinning) return;
  wheelSpinning = true;
  const btn = document.getElementById('wheelSpinBtn');
  btn.disabled = true;
  btn.textContent = 'â³ SPINNING...';
  document.getElementById('wheelQuestion').textContent = 'Spinning...';
  document.getElementById('wheelAnswer').value = '';

  const totalSpin = (Math.PI * 2) * (5 + Math.random() * 5);
  const targetAngle = wheelAngle + totalSpin;
  const duration = 3000;
  const start = performance.now();
  const startAngle = wheelAngle;

  function animate(now) {
    const elapsed = now - start;
    const progress = Math.min(elapsed / duration, 1);
    const ease = 1 - Math.pow(1 - progress, 4); // ease out quart
    wheelAngle = startAngle + totalSpin * ease;
    drawWheel(wheelAngle);
    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      wheelSpinning = false;
      btn.disabled = false;
      btn.textContent = 'ğŸ² SPIN AGAIN';
      // Figure out which slice is at the top (pointer)
      const n = WHEEL_QUESTIONS.length;
      const sliceAngle = (Math.PI * 2) / n;
      const normalizedAngle = (((-wheelAngle - Math.PI/2) % (Math.PI*2)) + Math.PI*2) % (Math.PI*2);
      const idx = Math.floor(normalizedAngle / sliceAngle) % n;
      currentWheelQ = WHEEL_QUESTIONS[idx];
      document.getElementById('wheelQuestion').textContent = currentWheelQ.q;
    }
  }
  requestAnimationFrame(animate);
}

function saveWheelAnswer() {
  const answer = document.getElementById('wheelAnswer').value.trim();
  if (!answer || !currentWheelQ) { showToast('Write your answer first!', ''); return; }
  const dk = String(currentDay);
  if (!state.journalAnswers[dk]) state.journalAnswers[dk] = {};
  if (!state.journalAnswers[dk]['wheel']) state.journalAnswers[dk]['wheel'] = [];
  state.journalAnswers[dk]['wheel'].push({ q: currentWheelQ.q, a: answer, ts: Date.now() });
  saveState();
  addXp(50);
  showToast('Answer saved! +50 XP ğŸ¯', 'success');
  spawnParticles(window.innerWidth/2, window.innerHeight/2, '#f5c842', 25);
  closeWheel();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SESSION JOURNAL PROMPT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SESSION_PROMPTS = [
  'Rate today\'s session 1â€“10 for FOCUS (not results). What would have made it a 10?',
  'What was the one moment in today\'s session where you KNEW you were improving?',
  'What\'s the one technical thing you need to drill harder tomorrow based on today?',
  'Did you play to win or play to improve today? What\'s the difference you noticed?',
  'Write one sentence about the player you\'re becoming. Make it specific and true.',
  'What did you avoid working on today that you know you need to fix? Why did you avoid it?',
  'What\'s one read you made today that you\'re proud of? What told you it was right?',
  'If your best training partner watched your session today, what would they say to fix first?',
];

function showSessionJournalPrompt() {
  const dk = String(currentDay);
  if (state.journalAnswers[dk] && state.journalAnswers[dk]['session_done']) return;
  const idx = (currentDay - 1) % SESSION_PROMPTS.length;
  document.getElementById('sjPrompt').textContent = SESSION_PROMPTS[idx];
  document.getElementById('sjAnswer').value = '';
  document.getElementById('sessionJournalModal').classList.remove('hidden');
}

function saveSessionJournal() {
  const answer = document.getElementById('sjAnswer').value.trim();
  const dk = String(currentDay);
  if (!state.journalAnswers[dk]) state.journalAnswers[dk] = {};
  if (answer) {
    const idx = (currentDay - 1) % SESSION_PROMPTS.length;
    state.journalAnswers[dk]['session'] = { q: SESSION_PROMPTS[idx], a: answer };
    addXp(40);
    showToast('Session journal saved! +40 XP', 'success');
  }
  state.journalAnswers[dk]['session_done'] = true;
  saveState();
  document.getElementById('sessionJournalModal').classList.add('hidden');
}

function skipSessionJournal() {
  const dk = String(currentDay);
  if (!state.journalAnswers[dk]) state.journalAnswers[dk] = {};
  state.journalAnswers[dk]['session_done'] = true;
  saveState();
  document.getElementById('sessionJournalModal').classList.add('hidden');
}

// Show daily challenge after app launches (small delay for UX)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANK SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getRankData() {
  return [
    { name: 'Recruit',    min: 0,     icon: 'âšª', color: '#8888a8' },
    { name: 'Contender',  min: 500,   icon: 'ğŸŸ¤', color: '#b87333' },
    { name: 'Threat',     min: 1500,  icon: 'âš”ï¸',  color: '#a0a0a0' },
    { name: 'Competitor', min: 3000,  icon: 'ğŸ”µ', color: '#3c8dff' },
    { name: 'Local King', min: 6000,  icon: 'ğŸŸ¡', color: '#f5c842' },
    { name: 'Regional',   min: 10000, icon: 'ğŸ”´', color: '#ff3c3c' },
    { name: 'Top Player', min: 15000, icon: 'ğŸ‘‘', color: '#a855f7' },
  ];
}

function showRankModal() {
  const modal = document.getElementById('rankModal');
  modal.classList.remove('hidden');
  const ladder = document.getElementById('rankLadderContent');
  ladder.innerHTML = '';
  const ranks = getRankData();
  const lvl = getXpLevel(state.xp);

  ranks.forEach((r, i) => {
    const isActive = r.name === lvl.name;
    const isAchieved = state.xp >= r.min && !isActive;
    const isLocked = state.xp < r.min;
    const nextMin = ranks[i+1] ? ranks[i+1].min : r.min;
    const fillPct = isAchieved ? 100 : isActive ? Math.round(getXpProgress(state.xp)) : 0;
    const xpNeeded = r.min > state.xp ? r.min - state.xp : 0;
    const xpRange = nextMin - r.min;

    const rung = document.createElement('div');
    rung.className = 'rank-rung' + (isActive ? ' active' : isAchieved ? ' achieved' : ' locked');
    rung.innerHTML = `
      <div class="rank-rung-fill" style="width:${fillPct}%"></div>
      <div class="rank-rung-icon">${r.icon}</div>
      <div class="rank-rung-info">
        <div class="rank-rung-name">${r.name.toUpperCase()}</div>
        <div class="rank-rung-xp">${r.min.toLocaleString()} XP${isActive ? ` Â· ${state.xp.toLocaleString()} current` : ''}</div>
      </div>
      ${isActive ? `<div class="rank-rung-status cur">CURRENT</div>` : isAchieved ? `<div class="rank-rung-status done">âœ“ CLEARED</div>` : `<div class="rank-rung-status next">${xpNeeded.toLocaleString()} XP away</div>`}
      ${isActive && ranks[i+1] ? `<div class="rank-rung-progress-text">${(nextMin - state.xp).toLocaleString()} to ${ranks[i+1].name}</div>` : ''}
    `;
    ladder.appendChild(rung);
  });
}

function closeRankModal() {
  document.getElementById('rankModal').classList.add('hidden');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MATCH SESSION SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let activeMatchSession = null;
let sessionTimerInterval = null;
let sessionRating = null;
let sessionDurationMinutes = 0;

function openPreMatchModal() {
  document.getElementById('preMatchModal').classList.remove('hidden');
  document.getElementById('pmOpponent').value = '';
  document.getElementById('pmFocus').value = '';
  // Reset time selection
  document.querySelectorAll('.pm-time-opt').forEach(o => o.classList.remove('selected'));
  selectedMatchTime = null;
}

function closePreMatchModal() {
  document.getElementById('preMatchModal').classList.add('hidden');
}

let selectedMatchTime = null;
function selectMatchTime(t, el) {
  selectedMatchTime = t;
  document.querySelectorAll('.pm-time-opt').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
}

function startMatchSession() {
  const opponent = document.getElementById('pmOpponent').value.trim() || 'Unknown';
  const focus = document.getElementById('pmFocus').value.trim() || 'Open session';
  const time = selectedMatchTime || '1h';
  activeMatchSession = {
    opponent, focus, time,
    startTs: Date.now(),
    notes: {}
  };
  document.getElementById('preMatchModal').classList.add('hidden');
  document.getElementById('activeSessionPanel').classList.remove('hidden');

  document.getElementById('aspVs').textContent = 'vs ' + opponent;
  document.getElementById('aspFocus').textContent = 'Focus: ' + focus;

  // Clear notes
  ['Vulnerabilities','Neutral','Tech','Mental','Matchup','Adjustments'].forEach(k => {
    const el = document.getElementById('aspNote' + k);
    if (el) el.value = '';
  });

  // Start timer
  sessionTimerInterval = setInterval(updateSessionTimer, 1000);
  updateSessionTimer();
}

function updateSessionTimer() {
  if (!activeMatchSession) return;
  const elapsed = Math.floor((Date.now() - activeMatchSession.startTs) / 1000);
  const m = Math.floor(elapsed / 60);
  const s = elapsed % 60;
  sessionDurationMinutes = m;
  const el = document.getElementById('aspTimerDisplay');
  if (el) el.textContent = String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
}

function endMatchSession() {
  clearInterval(sessionTimerInterval);

  // Collect notes
  if (activeMatchSession) {
    activeMatchSession.notes = {
      vulnerabilities: document.getElementById('aspNoteVulnerabilities')?.value || '',
      neutral: document.getElementById('aspNoteNeutral')?.value || '',
      tech: document.getElementById('aspNoteTech')?.value || '',
      mental: document.getElementById('aspNoteMental')?.value || '',
      matchup: document.getElementById('aspNoteMatchup')?.value || '',
      adjustments: document.getElementById('aspNoteAdjustments')?.value || '',
    };
    activeMatchSession.durationMinutes = sessionDurationMinutes;
  }

  document.getElementById('activeSessionPanel').classList.add('hidden');
  document.getElementById('postSessionModal').classList.remove('hidden');

  // Show duration in post modal
  const h = Math.floor(sessionDurationMinutes / 60);
  const m = sessionDurationMinutes % 60;
  const durStr = h > 0 ? `${h}h ${m}m` : `${m}m`;
  document.getElementById('pstDuration').textContent = `Duration: ${durStr} Â· vs ${activeMatchSession?.opponent || 'â€”'}`;
  document.getElementById('pstTakeaway').value = '';
  document.getElementById('pstWorkOn').value = '';
  sessionRating = null;
  document.querySelectorAll('.pst-rating-btn').forEach(b => b.classList.remove('selected'));
}

function selectSessionRating(n, el) {
  sessionRating = n;
  document.querySelectorAll('.pst-rating-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
}

function saveMatchSession() {
  if (!activeMatchSession) { document.getElementById('postSessionModal').classList.add('hidden'); return; }
  const takeaway = document.getElementById('pstTakeaway').value.trim();
  const workOn = document.getElementById('pstWorkOn').value.trim();
  const rating = sessionRating || 5;

  const session = {
    id: Date.now(),
    day: currentDay,
    date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
    opponent: activeMatchSession.opponent,
    focus: activeMatchSession.focus,
    time: activeMatchSession.time,
    durationMinutes: activeMatchSession.durationMinutes,
    notes: activeMatchSession.notes,
    takeaway,
    workOn,
    rating,
  };

  if (!state.matchSessions) state.matchSessions = [];
  state.matchSessions.push(session);
  saveState();
  addXp(75);
  showToast('Session saved! +75 XP ğŸ®', 'success');
  spawnParticles(window.innerWidth/2, window.innerHeight/2, '#2dcc70', 30);

  document.getElementById('postSessionModal').classList.add('hidden');
  activeMatchSession = null;

  // Re-render past sessions if visible
  const ps = document.getElementById('sec_tool_pastsessions');
  if (ps) {
    const newSec = buildPastSessionsTool();
    newSec.id = 'sec_tool_pastsessions';
    newSec.className = ps.className;
    ps.replaceWith(newSec);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAST SESSIONS TOOL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildPastSessionsTool() {
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.id = 'sec_tool_pastsessions';

  const sessions = (state.matchSessions || []).slice().reverse();
  const totalSessions = sessions.length;
  const totalMinutes = sessions.reduce((s, r) => s + (r.durationMinutes || 0), 0);
  const avgRating = totalSessions ? (sessions.reduce((s, r) => s + (r.rating || 0), 0) / totalSessions).toFixed(1) : 'â€”';

  const hdrHTML = `
    <div class="tool-header">
      <div class="tool-icon-big">ğŸ“‹</div>
      <div class="tool-title-block">
        <h2>Past Sessions</h2>
        <p>Every match session you've logged. The patterns across sessions are where the real growth shows up â€” look for what repeats.</p>
      </div>
    </div>
    <div class="ps-stats-bar">
      <div class="ps-stat-chip"><div class="sc-num">${totalSessions}</div><div class="sc-label">Sessions</div></div>
      <div class="ps-stat-chip"><div class="sc-num">${totalMinutes}</div><div class="sc-label">Total Min</div></div>
      <div class="ps-stat-chip"><div class="sc-num">${avgRating}</div><div class="sc-label">Avg Rating</div></div>
    </div>
  `;
  sec.innerHTML = hdrHTML;

  const list = document.createElement('div');
  list.className = 'past-sessions-list';

  if (sessions.length === 0) {
    list.innerHTML = `<div class="ps-empty">No sessions logged yet.<br>Hit "Start Match Session" on the Today tab before your next set.</div>`;
  } else {
    sessions.forEach((s, i) => {
      const realIdx = sessions.length - 1 - i;
      const ratingClass = s.rating >= 8 ? 'rating-high' : s.rating >= 5 ? 'rating-mid' : 'rating-low';
      const dur = s.durationMinutes >= 60 ? `${Math.floor(s.durationMinutes/60)}h ${s.durationMinutes%60}m` : `${s.durationMinutes || 0}m`;
      const card = document.createElement('div');
      card.className = 'ps-card';
      card.id = `pscard_${s.id}`;
      card.innerHTML = `
        <div class="ps-card-hdr" onclick="togglePsCard('${s.id}')">
          <span class="ps-date-tag">Day ${s.day} Â· ${s.date}</span>
          <div class="ps-vs">vs ${escHtml(s.opponent)}</div>
          <div class="ps-meta-pills">
            <span class="ps-meta-pill duration">â± ${dur}</span>
            <span class="ps-meta-pill ${ratingClass}">â˜… ${s.rating}/10</span>
          </div>
          <button class="ps-expand-btn">â–¼</button>
        </div>
        <div class="ps-card-body">
          <div style="font-size:0.52rem;letter-spacing:0.12em;color:var(--text2);margin-bottom:14px;text-transform:uppercase;">Focus: <span style="color:var(--text);font-style:italic;text-transform:none;">${escHtml(s.focus)}</span></div>
          <div class="ps-body-grid">
            ${renderPsNote('What Was Working Against Me', s.notes?.vulnerabilities)}
            ${renderPsNote('Neutral Observations', s.notes?.neutral)}
            ${renderPsNote('Tech & Execution', s.notes?.tech)}
            ${renderPsNote('Mental & Composure', s.notes?.mental)}
            ${renderPsNote('Matchup Notes', s.notes?.matchup)}
            ${renderPsNote('Mid-Session Adjustments', s.notes?.adjustments)}
          </div>
          ${s.takeaway ? `<div class="ps-takeaway-block"><div class="ps-takeaway-label">ğŸ’¡ Key Takeaway</div><div class="ps-takeaway-text">${escHtml(s.takeaway)}</div></div>` : ''}
          ${s.workOn ? `<div class="ps-work-on-block"><div class="ps-work-on-label">ğŸ¯ Work on Next Time</div><div class="ps-work-on-text">${escHtml(s.workOn)}</div></div>` : ''}
          <button class="ps-del-btn" onclick="deleteMatchSession(${realIdx})">Delete session</button>
        </div>
      `;
      list.appendChild(card);
    });
  }

  sec.appendChild(list);
  return sec;
}

function renderPsNote(label, text) {
  if (!text || !text.trim()) return '';
  return `<div class="ps-note-block"><div class="ps-note-label">${label}</div><div class="ps-note-text">${escHtml(text)}</div></div>`;
}

function togglePsCard(id) {
  const card = document.getElementById(`pscard_${id}`);
  if (card) card.classList.toggle('open');
}

function deleteMatchSession(idx) {
  if (!confirm('Delete this session?')) return;
  state.matchSessions.splice(idx, 1);
  saveState();
  const ps = document.getElementById('sec_tool_pastsessions');
  if (ps) {
    const newSec = buildPastSessionsTool();
    newSec.className = ps.className;
    ps.replaceWith(newSec);
  }
}

function launchAppEnhanced() {
  launchAppBase();
  setTimeout(showDailyChallenge, 1500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if (state.startDate) {
  launchAppEnhanced();
} else {
  updateObDots();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VOD STAT TRACKING SYSTEM  
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function openVODStatModal() {
  document.getElementById('vodStatModal').classList.remove('hidden');
}

function closeVODStatModal() {
  document.getElementById('vodStatModal').classList.add('hidden');
  document.getElementById('vodSessionName').value = '';
  document.getElementById('vodAvgDamage').value = '';
  document.getElementById('vodOpeningsPerStock').value = '';
  document.getElementById('vodAvgKillPercent').value = '';
  document.getElementById('vodDroppedCombo').value = '';
  document.getElementById('vodDroppedEdgeguard').value = '';
  document.getElementById('vodNotes').value = '';
  document.querySelectorAll('.calc-input').forEach(inp => inp.value = '');
}

function calculateAvgKillPercent() {
  const inputs = document.querySelectorAll('.calc-input');
  let sum = 0, count = 0;
  inputs.forEach(input => {
    const val = parseFloat(input.value);
    if (!isNaN(val) && val > 0) { sum += val; count++; }
  });
  if (count > 0) {
    const avg = Math.round(sum / count);
    document.getElementById('vodAvgKillPercent').value = avg;
    showToast(`âœ“ Average: ${avg}%`, 'info');
  }
}

function saveVODEntry() {
  const sessionName = document.getElementById('vodSessionName').value.trim();
  if (!sessionName) { showToast('Enter session name', 'warning'); return; }
  
  const entry = {
    id: 'vod_' + Date.now(),
    date: new Date().toISOString(),
    day: currentDay,
    sessionName,
    avgDamagePerOpening: parseFloat(document.getElementById('vodAvgDamage').value) || 0,
    openingsPerStock: parseFloat(document.getElementById('vodOpeningsPerStock').value) || 0,
    avgKillPercent: parseFloat(document.getElementById('vodAvgKillPercent').value) || 0,
    droppedComboRate: parseFloat(document.getElementById('vodDroppedCombo').value) || 0,
    droppedEdgeguardRate: parseFloat(document.getElementById('vodDroppedEdgeguard').value) || 0,
    notes: document.getElementById('vodNotes').value.trim()
  };
  
  state.vodEntries.push(entry);
  saveState();
  
  const todayQuests = generateTodayQuests(currentDay);
  const vodQuest = todayQuests.find(q => q.milestone === 'comp_vod');
  if (vodQuest && !state.dayCompletions[`quest_${currentDay}_${vodQuest.id}`]) {
    toggleQuestDone(vodQuest.id, vodQuest.xp);
  }
  
  closeVODStatModal();
  showToast('ğŸ“Š VOD stats saved!', 'success');
  if (activeSection && activeSection.includes('tool')) showSection(activeSection);
}

function renderVODCharts() {
  if (!state.vodEntries || state.vodEntries.length === 0) {
    return `<div style="text-align:center;padding:60px 20px;color:var(--text3);">
      <div style="font-size:2.5rem;margin-bottom:12px;">ğŸ“Š</div>
      <div style="font-size:0.8rem;margin-bottom:8px;">No VOD data yet</div>
      <div style="font-size:0.65rem;">Complete a VOD tracking quest to start building your performance history</div>
    </div>`;
  }
  
  const entries = state.vodEntries;
  return `
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px;margin-bottom:24px;">
      <div class="vod-chart-card">
        <div class="vod-chart-title">Avg Damage Per Opening</div>
        <div class="vod-chart-subtitle">Higher = better punish game</div>
        <canvas id="vodChartDamage" style="height:200px;"></canvas>
      </div>
      <div class="vod-chart-card">
        <div class="vod-chart-title">Openings Per Stock</div>
        <div class="vod-chart-subtitle">Lower = more efficient</div>
        <canvas id="vodChartOpenings" style="height:200px;"></canvas>
      </div>
      <div class="vod-chart-card">
        <div class="vod-chart-title">Average Kill Percent</div>
        <div class="vod-chart-subtitle">Consistency tracker</div>
        <canvas id="vodChartKillPercent" style="height:200px;"></canvas>
      </div>
      <div class="vod-chart-card">
        <div class="vod-chart-title">Dropped Combo Rate</div>
        <div class="vod-chart-subtitle">Lower = better execution</div>
        <canvas id="vodChartDroppedCombo" style="height:200px;"></canvas>
      </div>
      <div class="vod-chart-card">
        <div class="vod-chart-title">Dropped Edgeguard Rate</div>
        <div class="vod-chart-subtitle">Lower = better edgeguards</div>
        <canvas id="vodChartDroppedEdgeguard" style="height:200px;"></canvas>
      </div>
    </div>
    <div class="vod-history-section">
      <div class="vod-history-title">ğŸ“‹ Session History</div>
      ${entries.slice().reverse().map(e => `
        <div class="vod-history-card">
          <div class="vod-history-header">
            <div class="vod-history-name">${escHtml(e.sessionName)}</div>
            <div class="vod-history-date">Day ${e.day} â€¢ ${new Date(e.date).toLocaleDateString()}</div>
          </div>
          <div class="vod-history-stats">
            <div class="vod-stat-item"><div class="vod-stat-value">${e.avgDamagePerOpening}%</div><div class="vod-stat-label">Dmg/Opening</div></div>
            <div class="vod-stat-item"><div class="vod-stat-value">${e.openingsPerStock}</div><div class="vod-stat-label">Opens/Stock</div></div>
            <div class="vod-stat-item"><div class="vod-stat-value">${e.avgKillPercent}%</div><div class="vod-stat-label">Kill %</div></div>
            <div class="vod-stat-item"><div class="vod-stat-value">${e.droppedComboRate}%</div><div class="vod-stat-label">Drop Combo</div></div>
            <div class="vod-stat-item"><div class="vod-stat-value">${e.droppedEdgeguardRate}%</div><div class="vod-stat-label">Drop EG</div></div>
          </div>
          ${e.notes ? `<div class="vod-history-notes">${escHtml(e.notes)}</div>` : ''}
        </div>
      `).join('')}
    </div>
  `;
}

function initVODCharts() {
  if (!state.vodEntries || state.vodEntries.length === 0) return;
  const entries = state.vodEntries;
  const labels = entries.map((e, i) => `S${i+1}`);
  setTimeout(() => {
    renderChart('vodChartDamage', labels, entries.map(e => e.avgDamagePerOpening), 'Damage %', 'rgb(168,85,247)');
    renderChart('vodChartOpenings', labels, entries.map(e => e.openingsPerStock), 'Openings', 'rgb(60,141,255)');
    renderChart('vodChartKillPercent', labels, entries.map(e => e.avgKillPercent), 'Kill %', 'rgb(45,204,112)');
    renderChart('vodChartDroppedCombo', labels, entries.map(e => e.droppedComboRate), 'Drop %', 'rgb(255,60,60)');
    renderChart('vodChartDroppedEdgeguard', labels, entries.map(e => e.droppedEdgeguardRate), 'Drop %', 'rgb(255,140,0)');
  }, 100);
}

function renderChart(canvasId, labels, data, label, color) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  if (window[canvasId + 'Instance']) window[canvasId + 'Instance'].destroy();
  window[canvasId + 'Instance'] = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: label,
        data: data,
        borderColor: color,
        backgroundColor: color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
        tension: 0.3,
        fill: true,
        borderWidth: 2,
        pointRadius: 4,
        pointHoverRadius: 6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: { backgroundColor: 'rgba(0,0,0,0.8)', padding: 12, borderColor: color, borderWidth: 1 }
      },
      scales: {
        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: 'rgba(255,255,255,0.4)' } },
        x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: 'rgba(255,255,255,0.4)' } }
      }
    }
  });
}

function getCurrentTournamentWeek() { return Math.ceil(currentDay / 7); }
function isTournamentComplete(week) { return state.weeklyTournaments[`week${week}`]?.complete || false; }
function getTournamentChampion(week) { return state.weeklyTournaments[`week${week}`]?.champion || null; }

function renderTournamentButton() {
  const week = getCurrentTournamentWeek();
  const complete = isTournamentComplete(week);
  const champion = getTournamentChampion(week);
  if (complete) {
    return `<div class="tournament-btn tournament-btn-complete" onclick="openTournamentModal(${week})">
      <div class="tournament-btn-icon">ğŸ†</div>
      <div class="tournament-btn-content">
        <div class="tournament-btn-title">WEEKLY SQUAD TOURNAMENT</div>
        <div class="tournament-btn-champion">Week ${week} Champion: ${champion}</div>
        <div class="tournament-btn-subtitle">Click to view bracket</div>
      </div>
    </div>`;
  } else {
    return `<div class="tournament-btn tournament-btn-incomplete" onclick="openTournamentModal(${week})">
      <div class="tournament-btn-arrow">ğŸ‘‰</div>
      <div class="tournament-btn-content">
        <div class="tournament-btn-title">WEEKLY SQUAD TOURNAMENT</div>
        <div class="tournament-btn-callout">COMPLETE YOUR BRACKET</div>
        <div class="tournament-btn-subtitle">Double Elim â€¢ Bo5 â€¢ Benny, Dom, Peter, Evan</div>
      </div>
      <div class="tournament-btn-arrow">ğŸ‘ˆ</div>
    </div>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOURNAMENT MODAL SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let tmCurrentWeek = 1;

function openTournamentModal(week) {
  tmCurrentWeek = week || getCurrentTournamentWeek();
  document.getElementById('tournamentModal').classList.remove('hidden');
  loadTournamentWeek(tmCurrentWeek);
}

function closeTournamentModal() {
  document.getElementById('tournamentModal').classList.add('hidden');
}

function switchTmTab(tab, btn) {
  document.querySelectorAll('.tm-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('tmTabBracket').classList.toggle('hidden', tab !== 'bracket');
  document.getElementById('tmTabHistory').classList.toggle('hidden', tab !== 'history');
  if (tab === 'history') renderTournamentHistory();
}

function changeTmWeek(delta) {
  const maxWeek = Math.ceil(60 / 7);
  tmCurrentWeek = Math.max(1, Math.min(maxWeek, tmCurrentWeek + delta));
  loadTournamentWeek(tmCurrentWeek);
}

function loadTournamentWeek(week) {
  document.getElementById('tmTitle').textContent = `WEEK ${week} BRACKET`;
  document.getElementById('tmWeekLabel').textContent = `Week ${week}`;

  const data = state.weeklyTournaments[`week${week}`] || {};
  const defaultSeeds = ['Benny', 'Dom', 'Peter', 'Evan'];
  const seeds = data.seeds || defaultSeeds;
  for (let i = 1; i <= 4; i++) {
    const el = document.getElementById(`seed${i}`);
    if (el) el.value = seeds[i-1] || '';
  }

  const scores = data.scores || {};
  ['wSF1','wSF2','wF','lR1','lF','gF'].forEach(mid => {
    ['p1','p2'].forEach(p => {
      const el = document.getElementById(`score-${mid}-${p}`);
      if (el) el.value = scores[`${mid}-${p}`] !== undefined ? scores[`${mid}-${p}`] : '';
    });
  });

  updateBracket();
}

function getSeeds() {
  return [1,2,3,4].map(i => document.getElementById(`seed${i}`)?.value || `Player ${i}`);
}

function getScore(matchId, player) {
  const el = document.getElementById(`score-${matchId}-${player}`);
  return el ? parseInt(el.value) || 0 : 0;
}

function setSlot(slotId, name, seed, isWinner, isLoser) {
  const el = document.getElementById(slotId);
  if (!el) return;
  el.querySelector('.tm-slot-seed').textContent = seed || '';
  el.querySelector('.tm-slot-name').textContent = name || 'TBD';
  el.classList.toggle('winner', !!isWinner);
  el.classList.toggle('loser', !!isLoser);
}

function getMatchWinner(matchId) {
  const s1 = getScore(matchId, 'p1');
  const s2 = getScore(matchId, 'p2');
  if (s1 === 0 && s2 === 0) return null;
  if (s1 > s2) return 'p1';
  if (s2 > s1) return 'p2';
  return null;
}

function updateBracket() {
  const seeds = getSeeds();

  document.querySelectorAll('.tm-slot').forEach(el => el.classList.remove('winner', 'loser'));

  setSlot('slot-wSF1-p1', seeds[0], '1');
  setSlot('slot-wSF1-p2', seeds[3], '4');
  setSlot('slot-wSF2-p1', seeds[1], '2');
  setSlot('slot-wSF2-p2', seeds[2], '3');

  const wSF1w = getMatchWinner('wSF1');
  const wSF2w = getMatchWinner('wSF2');
  const wSF1winner = wSF1w ? seeds[wSF1w === 'p1' ? 0 : 3] : null;
  const wSF2winner = wSF2w ? seeds[wSF2w === 'p1' ? 1 : 2] : null;
  const wSF1loser = wSF1w ? seeds[wSF1w === 'p1' ? 3 : 0] : null;
  const wSF2loser = wSF2w ? seeds[wSF2w === 'p1' ? 2 : 1] : null;

  if (wSF1w) { document.getElementById(`slot-wSF1-${wSF1w}`)?.classList.add('winner'); document.getElementById(`slot-wSF1-${wSF1w==='p1'?'p2':'p1'}`)?.classList.add('loser'); }
  if (wSF2w) { document.getElementById(`slot-wSF2-${wSF2w}`)?.classList.add('winner'); document.getElementById(`slot-wSF2-${wSF2w==='p1'?'p2':'p1'}`)?.classList.add('loser'); }

  setSlot('slot-wF-p1', wSF1winner || 'TBD', '');
  setSlot('slot-wF-p2', wSF2winner || 'TBD', '');
  const wFw = getMatchWinner('wF');
  const wFwinner = wFw ? (wFw === 'p1' ? wSF1winner : wSF2winner) : null;
  const wFloser = wFw ? (wFw === 'p1' ? wSF2winner : wSF1winner) : null;
  if (wFw) { document.getElementById(`slot-wF-${wFw}`)?.classList.add('winner'); document.getElementById(`slot-wF-${wFw==='p1'?'p2':'p1'}`)?.classList.add('loser'); }

  setSlot('slot-lR1-p1', wSF1loser || 'TBD', '');
  setSlot('slot-lR1-p2', wSF2loser || 'TBD', '');
  const lR1w = getMatchWinner('lR1');
  const lR1winner = lR1w ? (lR1w === 'p1' ? wSF1loser : wSF2loser) : null;
  if (lR1w) { document.getElementById(`slot-lR1-${lR1w}`)?.classList.add('winner'); document.getElementById(`slot-lR1-${lR1w==='p1'?'p2':'p1'}`)?.classList.add('loser'); }

  setSlot('slot-lF-p1', lR1winner || 'TBD', '');
  setSlot('slot-lF-p2', wFloser || 'TBD', '');
  const lFw = getMatchWinner('lF');
  const lFwinner = lFw ? (lFw === 'p1' ? lR1winner : wFloser) : null;
  if (lFw) { document.getElementById(`slot-lF-${lFw}`)?.classList.add('winner'); document.getElementById(`slot-lF-${lFw==='p1'?'p2':'p1'}`)?.classList.add('loser'); }

  setSlot('slot-gF-p1', wFwinner || 'TBD', 'W');
  setSlot('slot-gF-p2', lFwinner || 'TBD', 'L');
  const gFw = getMatchWinner('gF');
  const champion = gFw ? (gFw === 'p1' ? wFwinner : lFwinner) : null;
  if (gFw) { document.getElementById(`slot-gF-${gFw}`)?.classList.add('winner'); document.getElementById(`slot-gF-${gFw==='p1'?'p2':'p1'}`)?.classList.add('loser'); }

  const banner = document.getElementById('tmChampionBanner');
  if (champion && banner) {
    banner.classList.remove('hidden');
    document.getElementById('tmChampionName').textContent = champion;
  } else if (banner) {
    banner.classList.add('hidden');
  }
}

function saveTournamentBracket() {
  const week = tmCurrentWeek;
  const seeds = getSeeds();
  const scores = {};
  ['wSF1','wSF2','wF','lR1','lF','gF'].forEach(mid => {
    scores[`${mid}-p1`] = getScore(mid, 'p1');
    scores[`${mid}-p2`] = getScore(mid, 'p2');
  });

  const champion = document.getElementById('tmChampionName')?.textContent || null;
  const complete = !!champion;

  if (!state.weeklyTournaments) state.weeklyTournaments = {};
  state.weeklyTournaments[`week${week}`] = { seeds, scores, champion, complete, savedAt: Date.now() };
  saveState();
  showToast(complete ? `ğŸ† Week ${week} saved â€” ${champion} wins!` : `ğŸ’¾ Week ${week} bracket saved`);
}

function resetTournamentBracket() {
  if (!confirm(`Reset Week ${tmCurrentWeek} bracket?`)) return;
  if (state.weeklyTournaments) delete state.weeklyTournaments[`week${tmCurrentWeek}`];
  saveState();
  loadTournamentWeek(tmCurrentWeek);
  showToast('Bracket reset');
}

function renderTournamentHistory() {
  const container = document.getElementById('tmHistoryContent');
  if (!container) return;
  const entries = Object.entries(state.weeklyTournaments || {}).sort((a, b) =>
    parseInt(b[0].replace('week','')) - parseInt(a[0].replace('week',''))
  );

  if (entries.length === 0) {
    container.innerHTML = `<div class="tm-empty-history">No saved tournaments yet.<br>Save your first bracket to see history here.</div>`;
    return;
  }

  container.innerHTML = entries.map(([key, data]) => {
    const weekNum = key.replace('week','');
    return `<div class="tm-history-card">
      <div class="tm-history-header">
        <div class="tm-history-week">WEEK ${weekNum}</div>
        <div class="tm-history-champion">${data.champion ? `ğŸ† ${data.champion}` : 'â³ In Progress'}</div>
      </div>
      <div class="tm-history-results">
        ${(data.seeds || []).map((s,i) => `<div class="tm-history-result">Seed ${i+1}: ${s}</div>`).join('')}
        ${data.champion ? `<div class="tm-history-result" style="color:var(--gold)">ğŸ‘‘ Champion: ${data.champion}</div>` : ''}
      </div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP UPGRADES â€” PWA / MOBILE / DRAWER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ Mobile Drawer â”€â”€
function openDrawer() {
  const drawer = document.getElementById('mobileDrawer');
  drawer.classList.add('open');
  // Populate drawer nav (mirrors sidebar)
  const drawerNav = document.getElementById('drawerNav');
  const sidebarNav = document.getElementById('sidebarNav');
  if (sidebarNav) {
    drawerNav.innerHTML = sidebarNav.innerHTML;
    // Re-attach click handlers
    drawerNav.querySelectorAll('.nav-item').forEach(item => {
      const sidebarItem = Array.from(sidebarNav.querySelectorAll('.nav-item'))
        .find(si => si.innerHTML === item.innerHTML);
      if (sidebarItem) {
        item.onclick = () => { sidebarItem.click(); closeDrawer(); };
      }
    });
  }
}

function closeDrawer() {
  document.getElementById('mobileDrawer').classList.remove('open');
}

// â”€â”€ Bottom Nav Tab Logic â”€â”€
const BOTTOM_NAV_MAP = {
  'today': 'today',
  'quests': null,   // will pick first unlocked pillar
  'progress': 'tool_vodstats',
  'stats': 'tool_milestones',
};

function bottomNavClick(tab) {
  let sectionId;
  if (tab === 'today') {
    sectionId = 'today';
  } else if (tab === 'quests') {
    // Show first available pillar
    const firstPillar = typeof PILLARS !== 'undefined' && PILLARS[0];
    sectionId = firstPillar ? firstPillar.id : 'today';
  } else if (tab === 'progress') {
    sectionId = 'tool_vodstats';
  } else if (tab === 'stats') {
    sectionId = 'tool_milestones';
  }
  if (sectionId) showSection(sectionId);
  updateBottomNav(sectionId);
}

function updateBottomNav(activeId) {
  // Map section IDs to bottom nav tab IDs
  const tabMap = {
    'today': 'bnToday',
    'tool_vodstats': 'bnProgress',
    'tool_milestones': 'bnStats',
  };
  // Pillars map to quests tab
  if (typeof PILLARS !== 'undefined') {
    PILLARS.forEach(p => { tabMap[p.id] = 'bnQuests'; });
  }
  // Tools map to more tab
  ['tool_matchups','tool_vod','tool_locals','tool_squad','tool_pastsessions','tool_reset'].forEach(t => {
    tabMap[t] = 'bnMore';
  });

  document.querySelectorAll('.bn-tab').forEach(t => t.classList.remove('active'));
  const activeBn = tabMap[activeId];
  if (activeBn) {
    const el = document.getElementById(activeBn);
    if (el) el.classList.add('active');
  }
}

// Patch showSection to also update bottom nav
const _origShowSection = showSection;
// We override after definition so we need to wrap it
window._showSectionPatched = false;

// Hook into section changes to update bottom nav
const _origBuildNav = typeof buildNav === 'function' ? buildNav : null;

// After app initializes, patch showSection
document.addEventListener('DOMContentLoaded', () => {
  const originalShow = window.showSection;
  if (originalShow) {
    window.showSection = function(id) {
      originalShow(id);
      updateBottomNav(id);
    };
  }
  // Set initial bottom nav state
  setTimeout(() => updateBottomNav('today'), 500);
});


// â”€â”€ Swipe to open/close drawer â”€â”€
let _touchStartX = 0;
let _touchStartY = 0;
document.addEventListener('touchstart', (e) => {
  _touchStartX = e.touches[0].clientX;
  _touchStartY = e.touches[0].clientY;
}, { passive: true });
document.addEventListener('touchend', (e) => {
  const dx = e.changedTouches[0].clientX - _touchStartX;
  const dy = Math.abs(e.changedTouches[0].clientY - _touchStartY);
  if (dy > 60) return; // mostly vertical swipe
  // Swipe right from left edge to open drawer
  if (_touchStartX < 24 && dx > 60) openDrawer();
  // Swipe left while drawer open to close
  if (document.getElementById('mobileDrawer').classList.contains('open') && dx < -60) closeDrawer();
}, { passive: true });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PWA â€” SERVICE WORKER REGISTRATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Inline service worker as a Blob URL so no separate file is needed
var SW_VERSION = 'tpb-v1';
var SW_CACHE_URLS = [
  'https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500;600&family=Crimson+Pro:ital,wght@0,400;0,600;1,400&display=swap',
  'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js'
];

if ('serviceWorker' in navigator) {
  var swCode = `
    var CACHE = '${SW_VERSION}';
    var URLS = ${JSON.stringify(SW_CACHE_URLS)};

    self.addEventListener('install', function(e) {
      e.waitUntil(
        caches.open(CACHE).then(function(cache) {
          return Promise.allSettled(URLS.map(function(url) {
            return cache.add(url).catch(function(err) {
              console.warn('SW: failed to cache', url, err);
            });
          }));
        }).then(function() { return self.skipWaiting(); })
      );
    });

    self.addEventListener('activate', function(e) {
      e.waitUntil(
        caches.keys().then(function(keys) {
          return Promise.all(keys.filter(function(k) { return k !== CACHE; }).map(function(k) { return caches.delete(k); }));
        }).then(function() { return self.clients.claim(); })
      );
    });

    self.addEventListener('fetch', function(e) {
      // Network first for same-origin (the HTML file itself)
      // Cache first for external CDN resources
      var url = e.request.url;
      var isExternal = url.startsWith('https://fonts.') || url.startsWith('https://cdn.') || url.startsWith('https://www.gstatic.');
      if (isExternal) {
        e.respondWith(
          caches.match(e.request).then(function(cached) {
            if (cached) return cached;
            return fetch(e.request).then(function(response) {
              if (response && response.status === 200) {
                var clone = response.clone();
                caches.open(CACHE).then(function(cache) { cache.put(e.request, clone); });
              }
              return response;
            }).catch(function() { return cached; });
          })
        );
      }
      // For same-origin requests (HTML), just fetch normally
    });
  `;

  var blob = new Blob([swCode], { type: 'application/javascript' });
  var swUrl = URL.createObjectURL(blob);

  navigator.serviceWorker.register(swUrl, { scope: './' })
    .then(function(reg) {
      console.log('SW registered:', reg.scope);
      // Check for updates periodically
      setInterval(function() { reg.update(); }, 60 * 60 * 1000);
    })
    .catch(function(err) {
      console.warn('SW registration failed (PWA offline mode unavailable):', err);
    });
}

// â”€â”€ PWA Install Prompt â”€â”€
var _deferredInstallPrompt = null;

window.addEventListener('beforeinstallprompt', function(e) {
  e.preventDefault();
  _deferredInstallPrompt = e;
  // Show install banner after a short delay (only if not already installed)
  setTimeout(showInstallBanner, 3000);
});

window.addEventListener('appinstalled', function() {
  _deferredInstallPrompt = null;
  var banner = document.getElementById('pwaInstallBanner');
  if (banner) banner.remove();
  showToast('Top Player Blueprint installed! \uD83C\uDF89', 'success');
});

function showInstallBanner() {
  if (!_deferredInstallPrompt) return;
  if (document.getElementById('pwaInstallBanner')) return;
  var banner = document.createElement('div');
  banner.id = 'pwaInstallBanner';
  banner.style.cssText = 'position:fixed;bottom:70px;left:50%;transform:translateX(-50%);z-index:9999;background:#14142a;border:1px solid rgba(245,200,66,0.4);border-radius:12px;padding:14px 18px;display:flex;align-items:center;gap:14px;box-shadow:0 8px 32px rgba(0,0,0,0.6);max-width:360px;width:calc(100% - 32px);animation:obIn 0.3s ease;';
  banner.innerHTML = '<div style="font-size:1.6rem;">\uD83D\uDCF2</div><div style="flex:1;"><div style="font-family:\'Bebas Neue\',sans-serif;font-size:0.9rem;letter-spacing:0.1em;color:#f5c842;">INSTALL TOP PLAYER</div><div style="font-size:0.58rem;color:#8888a8;margin-top:2px;">Add to home screen for the full app experience</div></div><button onclick="triggerInstall()" style="background:#f5c842;border:none;color:#080810;padding:8px 14px;border-radius:6px;font-family:\'Bebas Neue\',sans-serif;font-size:0.8rem;letter-spacing:0.1em;cursor:pointer;white-space:nowrap;">INSTALL</button><button onclick="dismissInstallBanner()" style="background:none;border:none;color:#3a3a50;cursor:pointer;font-size:1rem;padding:4px;">\u2715</button>';
  document.body.appendChild(banner);
}

function triggerInstall() {
  if (!_deferredInstallPrompt) return;
  _deferredInstallPrompt.prompt();
  _deferredInstallPrompt.userChoice.then(function(result) {
    _deferredInstallPrompt = null;
    var banner = document.getElementById('pwaInstallBanner');
    if (banner) banner.remove();
  });
}

function dismissInstallBanner() {
  var banner = document.getElementById('pwaInstallBanner');
  if (banner) banner.style.animation = 'fadeOut 0.3s ease forwards';
  setTimeout(function() { if (banner) banner.remove(); }, 300);
}

// iOS: show manual install instructions (Safari doesn't support beforeinstallprompt)
function isIOS() {
  return /iphone|ipad|ipod/i.test(navigator.userAgent) && !window.MSStream;
}
function isInStandaloneMode() {
  return window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches;
}

if (isIOS() && !isInStandaloneMode()) {
  setTimeout(function() {
    if (document.getElementById('pwaInstallBanner')) return;
    var banner = document.createElement('div');
    banner.id = 'pwaInstallBanner';
    banner.style.cssText = 'position:fixed;bottom:70px;left:50%;transform:translateX(-50%);z-index:9999;background:#14142a;border:1px solid rgba(245,200,66,0.4);border-radius:12px;padding:14px 18px;display:flex;align-items:center;gap:12px;box-shadow:0 8px 32px rgba(0,0,0,0.6);max-width:360px;width:calc(100% - 32px);animation:obIn 0.3s ease;';
    banner.innerHTML = '<div style="font-size:1.4rem;">\uD83D\uDCF1</div><div style="flex:1;"><div style="font-family:\'Bebas Neue\',sans-serif;font-size:0.85rem;letter-spacing:0.1em;color:#f5c842;">ADD TO HOME SCREEN</div><div style="font-size:0.58rem;color:#8888a8;margin-top:3px;line-height:1.5;">Tap <strong style="color:#e8e8f0;">Share \u2191</strong> then <strong style="color:#e8e8f0;">Add to Home Screen</strong> for the full app experience</div></div><button onclick="dismissInstallBanner()" style="background:none;border:none;color:#3a3a50;cursor:pointer;font-size:1rem;padding:4px;flex-shrink:0;">\u2715</button>';
    document.body.appendChild(banner);
  }, 4000);
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// R.O.B. TUTORIAL SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var robTutorial = (function() {

  var STEPS = [
    {
      title: "HEY! NICE TO MEET YOU, FUTURE CHAMP!",
      body: "I'm R.O.B. â€” your Robotic Operating Buddy! I've been spinning gyros since 1985, and NOW I'm here to spin you up into a TOP PLAYER! Let me show you everything. Trust me â€” I'm a robot!",
      sel: null, pos: "center", nav: null
    },
    {
      title: "YOUR HERO DASHBOARD",
      body: "That big ring shows your Day count and 60-day progress. Rank, streak, quest count â€” all right here. This is home base!",
      sel: ".home-hero", pos: "bottom", nav: "today"
    },
    {
      title: "TODAY'S QUESTS â€” YOUR DAILY WORK",
      body: "These refresh every day. Check them off as you crush them â€” each one earns XP and gets you closer to being the player everyone is scared to face. You got this!",
      sel: ".quest-list", pos: "top", nav: "today"
    },
    {
      title: "XP AND RANKS â€” LEVEL UP FOR REAL!",
      body: "Every quest earns XP, and enough XP means a RANK UP! Start as a Recruit, climb to TOP PLAYER. Tap the badge anytime to see the full ladder!",
      sel: ".hdr-rank-block", pos: "bottom", nav: "today"
    },
    {
      title: "THE 10 PILLARS OF MASTERY",
      body: "Over here in the sidebar â€” 10 Pillars. Tech, Neutral, Mental, Advantage, and more. Train ALL of them. Yes, even the ones you've been avoiding. Especially those. Sorry. Not sorry.",
      sel: ".sidebar", pos: "right", nav: "today"
    },
    {
      title: "MILESTONES â€” THE REAL DRILLS",
      body: "Inside each Pillar are Milestones â€” real drills and habits. Expand any one to see tasks. Every checkmark is a tiny version of you getting harder to beat!",
      sel: ".subsection", pos: "bottom", nav: "tech"
    },
    {
      title: "MATCHUP ANCHORS â€” SPY TIME",
      body: "Build a scouting report on every character you face. Their patterns, tendencies, what beats them. Knowledge is power, and power is winning neutral, and winning neutral is winning.",
      sel: ".tool-header", pos: "bottom", nav: "tool_matchups"
    },
    {
      title: "VOD STATS â€” DATA NEVER LIES",
      body: "Log your stats after VOD sessions â€” damage per opening, kill percents, dropped combos. Watch yourself literally get better on a chart. It's incredibly satisfying.",
      sel: ".tool-header", pos: "bottom", nav: "tool_vodstats"
    },
    {
      title: "VOD REVIEW â€” WATCH YOURSELF",
      body: "Watching losses hurts. But top players LOVE losses â€” they're free coaching! Structured questions guide you to the patterns you'd never catch otherwise. Game changer.",
      sel: ".tool-header", pos: "bottom", nav: "tool_vod"
    },
    {
      title: "MILESTONES JOURNAL â€” YOUR TROPHY CASE",
      body: "Record your breakthrough moments here. Finally hit that combo? WRITE IT DOWN. On bad days, come back and see how far you've come. Future you will thank past you.",
      sel: ".tool-header", pos: "bottom", nav: "tool_milestones"
    },
    {
      title: "LOCAL SCENE â€” KNOW YOUR RIVALS",
      body: "Add every player from your local scene. Character, habits, threat level, your record vs them. The more details, the more prepared you'll be in bracket. That's gonna be you!",
      sel: ".tool-header", pos: "bottom", nav: "tool_locals"
    },
    {
      title: "SQUAD MODE â€” BETTER TOGETHER",
      body: "Share your Squad Code with training partners and see each other's progress in real time. Nothing motivates like knowing your crew is watching. Who's gonna let their squad down? NOT YOU!",
      sel: ".squad-panel", pos: "bottom", nav: "tool_squad"
    },
    {
      title: "YOU'RE ALL SET, CHAMP!",
      body: "60 days, 10 Pillars, one goal. Hit R.O.B. Tutorial in the sidebar anytime for a refresher. Now stop reading tutorials and go START! The bracket is waiting â€” and so is your best self. LET'S GOOO!!",
      sel: null, pos: "center", nav: "today"
    }
  ];

  var step = 0;
  var overlay, spotBox, card;

  function injectStyles() {
    if (document.getElementById('robStyles')) return;
    var s = document.createElement('style');
    s.id = 'robStyles';
    s.textContent = [
      '@keyframes robFloat{0%,100%{transform:translateY(0) rotate(-1.5deg)}50%{transform:translateY(-9px) rotate(1.5deg)}}',
      '@keyframes robGlow{0%,100%{filter:drop-shadow(0 0 6px rgba(255,60,60,.7))}50%{filter:drop-shadow(0 0 16px rgba(255,60,60,1))}}',
      '@keyframes robIn{from{opacity:0;transform:scale(.9) translateY(16px)}to{opacity:1;transform:scale(1) translateY(0)}}',
      '@keyframes robPulse{0%,100%{box-shadow:0 0 0 3px rgba(255,200,60,.4),0 0 0 7px rgba(255,200,60,.1)}50%{box-shadow:0 0 0 5px rgba(255,200,60,.6),0 0 0 10px rgba(255,200,60,.15)}}',
      '#robOverlay{position:fixed;inset:0;z-index:10000;background:rgba(4,4,14,.82);pointer-events:none;}',
      '#robSpot{position:fixed;z-index:10001;border-radius:10px;pointer-events:none;animation:robPulse 2s ease-in-out infinite;display:none;}',
      '#robCard{position:fixed;z-index:10002;background:#0e0e1a;border:1px solid #2a2a42;border-radius:14px;overflow:hidden;',
        'max-width:380px;width:calc(100vw - 32px);box-shadow:0 0 60px rgba(255,60,60,.12),0 20px 60px rgba(0,0,0,.85);',
        'animation:robIn .3s cubic-bezier(.34,1.56,.64,1);pointer-events:all;}',
      '#robCard .rob-bar{height:3px;background:linear-gradient(90deg,#ff3c3c,#f5c842,#ff3c3c);}',
      '#robCard .rob-body-wrap{padding:16px 18px 12px;display:flex;gap:12px;align-items:flex-end;}',
      '#robCard .rob-ava{width:64px;height:64px;object-fit:contain;flex-shrink:0;',
        'animation:robFloat 3s ease-in-out infinite,robGlow 2s ease-in-out infinite;image-rendering:pixelated;}',
      '#robCard .rob-bubble{flex:1;background:#111122;border:1px solid #1e1e34;border-radius:10px 10px 10px 4px;padding:10px 13px;position:relative;}',
      '#robCard .rob-bubble::before{content:"";position:absolute;left:-8px;bottom:12px;border:7px solid transparent;border-right-color:#1e1e34;}',
      '#robCard .rob-bubble::after{content:"";position:absolute;left:-6px;bottom:13px;border:6px solid transparent;border-right-color:#111122;}',
      '#robCard .rob-tag{font-size:.4rem;letter-spacing:.22em;text-transform:uppercase;color:#ff3c3c;margin-bottom:3px;font-family:"DM Mono",monospace;}',
      '#robCard .rob-title{font-family:"Bebas Neue",sans-serif;font-size:1rem;letter-spacing:.1em;color:#fff;line-height:1.1;margin-bottom:5px;}',
      '#robCard .rob-txt{font-family:"Crimson Pro",serif;font-style:italic;font-size:.86rem;color:#9090b0;line-height:1.6;}',
      '#robCard .rob-foot{display:flex;align-items:center;justify-content:space-between;padding:9px 18px 14px;border-top:1px solid #14141e;}',
      '#robCard .rob-dots{display:flex;gap:5px;}',
      '#robCard .rob-dot{width:6px;height:6px;border-radius:50%;background:#1e1e34;transition:all .2s;}',
      '#robCard .rob-dot.done{background:#2dcc70;}',
      '#robCard .rob-dot.active{background:#ff3c3c;transform:scale(1.4);}',
      '#robCard .rob-btns{display:flex;gap:6px;}',
      '#robCard button{cursor:pointer;border-radius:5px;font-family:"DM Mono",monospace;font-size:.58rem;letter-spacing:.08em;text-transform:uppercase;transition:all .15s;}',
      '#robCard .rb-skip{background:none;border:none;color:#3a3a50;padding:4px 6px;}',
      '#robCard .rb-skip:hover{color:#8888a8;}',
      '#robCard .rb-back{background:#14142a;border:1px solid #2a2a42;color:#8888a8;padding:6px 12px;}',
      '#robCard .rb-back:hover{border-color:#3a3a58;color:#e8e8f0;}',
      '#robCard .rb-next{background:#ff3c3c;border:1px solid #ff3c3c;color:#fff;font-family:"Bebas Neue",sans-serif;font-size:.8rem;letter-spacing:.12em;padding:7px 16px;}',
      '#robCard .rb-next:hover{background:#ff5555;}'
    ].join('');
    document.head.appendChild(s);
  }

  function build() {
    injectStyles();

    overlay = document.createElement('div');
    overlay.id = 'robOverlay';
    document.body.appendChild(overlay);

    spotBox = document.createElement('div');
    spotBox.id = 'robSpot';
    document.body.appendChild(spotBox);

    card = document.createElement('div');
    card.id = 'robCard';
    card.innerHTML = '<div class="rob-bar"></div>' +
      '<div class="rob-body-wrap">' +
        '<img class="rob-ava" id="robAva" src="rob.png" onerror="this.src=\'data:image/svg+xml,%3Csvg xmlns=\\\'http://www.w3.org/2000/svg\\\' viewBox=\\\'0 0 100 100\\\'%3E%3Ctext y=\\\'.9em\\\' font-size=\\\'80\\\'%3EğŸ¤–%3C/text%3E%3C/svg%3E\'" alt="ROB">' +
        '<div class="rob-bubble">' +
          '<div class="rob-tag">R.O.B. â€” TUTORIAL GUIDE</div>' +
          '<div class="rob-title" id="robTitle"></div>' +
          '<div class="rob-txt" id="robTxt"></div>' +
        '</div>' +
      '</div>' +
      '<div class="rob-foot">' +
        '<button class="rb-skip" id="robSkip">Skip</button>' +
        '<div class="rob-dots" id="robDots"></div>' +
        '<div class="rob-btns">' +
          '<button class="rb-back" id="robBack">Back</button>' +
          '<button class="rb-next" id="robNext">Next</button>' +
        '</div>' +
      '</div>';
    document.body.appendChild(card);

    document.getElementById('robSkip').onclick = close;
    document.getElementById('robBack').onclick = function() { if (step > 0) { step--; render(); } };
    document.getElementById('robNext').onclick = function() {
      if (step < STEPS.length - 1) { step++; render(); } else { close(); }
    };

    var dotsEl = document.getElementById('robDots');
    STEPS.forEach(function(_, i) {
      var d = document.createElement('div');
      d.className = 'rob-dot';
      d.id = 'rd' + i;
      dotsEl.appendChild(d);
    });
  }

  function position(s) {
    var vw = window.innerWidth, vh = window.innerHeight;
    var cw = Math.min(380, vw - 32);
    var ch = card.offsetHeight || 200;
    var PAD = 14;

    if (!s.sel) {
      // center
      overlay.style.clipPath = 'none';
      spotBox.style.display = 'none';
      card.style.left = Math.round((vw - cw) / 2) + 'px';
      card.style.top  = Math.round((vh - ch) / 2) + 'px';
      return;
    }

    var el = document.querySelector(s.sel);
    if (!el) {
      overlay.style.clipPath = 'none';
      spotBox.style.display = 'none';
      card.style.left = Math.round((vw - cw) / 2) + 'px';
      card.style.top  = Math.round((vh - ch) / 2) + 'px';
      return;
    }

    var r = el.getBoundingClientRect();
    var px = 8;
    var ox = r.left - px, oy = r.top - px, ow = r.width + px*2, oh = r.height + px*2;

    // punch hole in overlay
    overlay.style.clipPath = 'polygon(0% 0%,100% 0%,100% 100%,0% 100%,0% 0%,' +
      ox+'px '+oy+'px,'+ox+'px '+(oy+oh)+'px,'+(ox+ow)+'px '+(oy+oh)+'px,'+(ox+ow)+'px '+oy+'px,'+ox+'px '+oy+'px)';

    spotBox.style.display = 'block';
    spotBox.style.top    = oy + 'px';
    spotBox.style.left   = ox + 'px';
    spotBox.style.width  = ow + 'px';
    spotBox.style.height = oh + 'px';

    // place card
    var cx, cy;
    if (s.pos === 'bottom') {
      cy = Math.min(r.bottom + px + PAD, vh - ch - PAD);
      cx = Math.max(PAD, Math.min(r.left, vw - cw - PAD));
    } else if (s.pos === 'top') {
      cy = Math.max(PAD, r.top - ch - PAD - px);
      cx = Math.max(PAD, Math.min(r.left, vw - cw - PAD));
    } else if (s.pos === 'right') {
      cy = Math.max(PAD, Math.min(r.top, vh - ch - PAD));
      cx = Math.min(r.right + px + PAD, vw - cw - PAD);
    } else {
      cy = Math.round((vh - ch) / 2);
      cx = Math.round((vw - cw) / 2);
    }
    cx = Math.max(PAD, Math.min(cx, vw - cw - PAD));
    cy = Math.max(PAD, Math.min(cy, vh - ch - PAD));
    card.style.left = cx + 'px';
    card.style.top  = cy + 'px';
  }

  function render() {
    var s = STEPS[step];
    var isLast = step === STEPS.length - 1;

    if (s.nav && typeof showSection === 'function') showSection(s.nav);

    document.getElementById('robTitle').textContent = s.title;
    document.getElementById('robTxt').textContent   = s.body;
    document.getElementById('robNext').textContent  = isLast ? 'GO!' : 'Next';
    document.getElementById('robBack').style.display = step === 0 ? 'none' : '';
    document.getElementById('robSkip').textContent  = isLast ? 'Done' : 'Skip';

    STEPS.forEach(function(_, i) {
      var d = document.getElementById('rd' + i);
      d.className = 'rob-dot' + (i < step ? ' done' : i === step ? ' active' : '');
    });

    var delay = s.nav ? 180 : 60;
    setTimeout(function() {
      var el = s.sel ? document.querySelector(s.sel) : null;
      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      setTimeout(function() { position(s); }, el ? 350 : 0);
    }, delay);
  }

  function close() {
    [overlay, spotBox, card].forEach(function(el) {
      if (!el || !el.parentNode) return;
      el.style.transition = 'opacity .25s';
      el.style.opacity = '0';
      setTimeout(function() { if (el.parentNode) el.parentNode.removeChild(el); }, 260);
    });
    overlay = spotBox = card = null;
    try { localStorage.setItem('tpb_rob_done', '1'); } catch(e) {}
    if (typeof showSection === 'function') showSection('today');
  }

  function start() {
    try { if (localStorage.getItem('tpb_rob_done')) return; } catch(e) {}
    // Only show if user has completed onboarding
    if (!state || !state.startDate) return;
    step = 0;
    build();
    render();
  }

  function reset() {
    // Remove any existing elements
    ['robOverlay','robSpot','robCard'].forEach(function(id) {
      var el = document.getElementById(id);
      if (el && el.parentNode) el.parentNode.removeChild(el);
    });
    overlay = spotBox = card = null;
    try { localStorage.removeItem('tpb_rob_done'); } catch(e) {}
    step = 0;
    build();
    render();
  }

  // Auto-trigger after onboarding
  var _origFinish = window.finishOnboarding;
  if (typeof finishOnboarding === 'function') {
    window.finishOnboarding = function() {
      _origFinish.apply(this, arguments);
      setTimeout(start, 2000);
    };
  }

  // Auto-trigger for returning users who haven't seen it
  setTimeout(function() {
    if (typeof state !== 'undefined' && state.startDate) {
      start();
    }
  }, 2500);

  window.addEventListener('resize', function() {
    if (card && card.parentNode) {
      var s = STEPS[step];
      position(s);
    }
  });

  return { start: start, reset: reset };
})();
</script>
</body>
</html>
